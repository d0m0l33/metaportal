/*
 Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
  Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
 Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
  (https://github.com/101arrowz/fflate) for use in Troika text rendering. 
  Original licenses apply: 
  - fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
  - woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/
'use strict';(function(C,y){"object"===typeof exports&&"undefined"!==typeof module?y(exports,require("three"),require("troika-worker-utils"),require("bidi-js"),require("troika-three-utils")):"function"===typeof define&&define.amd?define(["exports","three","troika-worker-utils","bidi-js","troika-three-utils"],y):(C="undefined"!==typeof globalThis?globalThis:C||self,y(C.troika_three_text={},C.THREE,C.troika_worker_utils,C.bidi_js,C.troika_three_utils))})(this,function(C,y,N,P,fa){function qa(l){function g(g,
b,a,c,d,e,f){let h=1-f;return{x:h*h*g+2*h*f*a+f*f*d,y:h*h*b+2*h*f*c+f*f*e}}function v(g,b,a,c,d,e,f,h,k){let p=1-k;return{x:p*p*p*g+3*p*p*k*a+3*p*k*k*d+k*k*k*f,y:p*p*p*b+3*p*p*k*c+3*p*k*k*e+k*k*k*h}}return function(u,b,a,c,d,e=1){let f=(self.performance||Date).now(),h=new Uint8Array(u*b),k=c[2]-c[0],p=c[3]-c[1],q=l(c);var w=/([MLQCZ])([^MLQCZ]*)/g,m,t,n;let r,G;for(;m=w.exec(a);){let a=m[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(a=>parseFloat(a));switch(m[1]){case "M":r=t=a[0];G=n=a[1];break;
case "L":a[0]===r&&a[1]===G||q.addLineSegment(r,G,r=a[0],G=a[1]);break;case "Q":m={x:r,y:G};for(var x=1;16>x;x++){var F=g(r,G,a[0],a[1],a[2],a[3],x/15);q.addLineSegment(m.x,m.y,F.x,F.y);m=F}r=a[2];G=a[3];break;case "C":m={x:r,y:G};for(x=1;16>x;x++)F=v(r,G,a[0],a[1],a[2],a[3],a[4],a[5],x/15),q.addLineSegment(m.x,m.y,F.x,F.y),m=F;r=a[4];G=a[5];break;case "Z":r===t&&G===n||q.addLineSegment(r,G,t,n)}}for(a=0;a<u;a++)for(w=0;w<b;w++)t=q.findNearestSignedDistance(c[0]+k*(a+.5)/u,c[1]+p*(w+.5)/b,d),n=Math.pow(1-
Math.abs(t)/d,e)/2,0>t&&(n=1-n),n=Math.max(0,Math.min(255,Math.round(255*n))),h[w*u+a]=n;return{textureData:h,timing:(self.performance||Date).now()-f}}}function ra(l){function g(){v&&(u.sort(function(b,a){return b.maxX-a.maxX}),v=!1)}let v=!1,u=[];return{addLineSegment:function(b,a,c,d){u.push({x0:b,y0:a,x1:c,y1:d,minX:Math.min(b,c),minY:Math.min(a,d),maxX:Math.max(b,c),maxY:Math.max(a,d)});v=!0},findNearestSignedDistance:function(b,a){g();var c=Infinity;let d=Infinity;for(var e=u.length;e--;){var f=
u[e];if(f.maxX+d<=b)break;if(b+d>f.minX&&a-d<f.maxY&&a+d>f.minY){{var h=f.x0;var k=f.y0;let c=f.x1-h;f=f.y1-k;var p=c*c+f*f;p=p?Math.max(0,Math.min(1,((b-h)*c+(a-k)*f)/p)):0;h=b-(h+p*c);k=a-(k+p*f);k=h*h+k*k}k<c&&(c=k,d=Math.sqrt(c))}}g();c=!1;for(e=u.length;e--;){k=u[e];if(k.maxX<=b)break;k.minY<a&&k.maxY>a&&k.y0>a!==k.y1>a&&b<(k.x1-k.x0)*(a-k.y0)/(k.y1-k.y0)+k.x0&&(c=!c)}(b=c)&&(d=-d);return d}}}function Q(){return(self.performance||Date).now()}function ha(l,g){ka=!0;l=la({},l);let v=Q();l.font=
sa(l.font||W.defaultFontURL);l.text=""+l.text;l.sdfGlyphSize=l.sdfGlyphSize||W.sdfGlyphSize;if(null!=l.colorRanges){var u={};for(let a in l.colorRanges)if(l.colorRanges.hasOwnProperty(a)){let b=l.colorRanges[a];"number"!==typeof b&&(b=ta.set(b).getHex());u[a]=b}l.colorRanges=u}Object.freeze(l);let {textureWidth:b,sdfExponent:a}=W,{sdfGlyphSize:c}=l;u=`${l.font}@${c}`;let d=X[u];d||(d=X[u]={count:0,glyphs:new Map,sdfTexture:new y.DataTexture(new Uint8Array(c*b*4),b,c,y.RGBAFormat,void 0,void 0,void 0,
void 0,y.LinearFilter,y.LinearFilter)},d.sdfTexture.font=l.font);ua(l).then(b=>{let {glyphIds:e,glyphPositions:h,fontSize:k,unitsPerEm:p,timings:q}=b,w=[],m=new Float32Array(4*e.length),t=k/p,n=0,r=0,G=Q();e.forEach((a,f)=>{var g=d.glyphs.get(a);if(!g){let {path:e,pathBounds:f}=b.glyphData[a];g=Math.max(f[2]-f[0],f[3]-f[1])/c*(W.sdfMargin*c+.5);var k=d.count++;d.glyphs.set(a,g={path:e,atlasIndex:k,sdfViewBox:[f[0]-g,f[1]-g,f[2]+g,f[3]+g]});w.push(g)}({sdfViewBox:a}=g);k=h[r++];let p=h[r++];m[n++]=
k+a[0]*t;m[n++]=p+a[1]*t;m[n++]=k+a[2]*t;m[n++]=p+a[3]*t;e[f]=g.atlasIndex});q.quads=(q.quads||0)+(Q()-G);let x=Q();q.sdf={};N.Thenable.all(w.map(({path:a,atlasIndex:b,sdfViewBox:d})=>wa(c,c,a,d,Math.max(d[2]-d[0],d[3]-d[1]),W.sdfExponent).then(({textureData:a,timing:c})=>{q.sdf[b]=c;return{atlasIndex:b,textureData:a,timing:c}}))).then(f=>{f.length&&(f.forEach(({atlasIndex:a,textureData:b})=>{let e=d.sdfTexture.image;for(;e.data.length<(a+1)*c*c;){var f=new Uint8Array(2*e.data.length);f.set(e.data);
e.data=f;e.height*=2}f=Math.floor(a/4);var g=e.width/c;a=Math.floor(f/g)*e.width*c*4+f%g*c*4+a%4;for(f=0;f<c;f++){g=f*c;let d=a+f*e.width*4;for(let a=0;a<c;a++)e.data[d+4*a]=b[g+a]}}),d.sdfTexture.needsUpdate=!0);q.sdfTotal=Q()-x;q.total=Q()-v;g(Object.freeze({parameters:l,sdfTexture:d.sdfTexture,sdfGlyphSize:c,sdfExponent:a,glyphBounds:m,glyphAtlasIndices:e,glyphColors:b.glyphColors,caretPositions:b.caretPositions,caretHeight:b.caretHeight,chunkedBounds:b.chunkedBounds,ascender:b.ascender,descender:b.descender,
lineHeight:b.lineHeight,topBaseline:b.topBaseline,blockBounds:b.blockBounds,visibleBounds:b.visibleBounds,timings:b.timings,get totalBounds(){console.log("totalBounds deprecated, use blockBounds instead");return b.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");let [a,c,d,e]=b.blockBounds;return[d-a,e-c]}}))})})}function la(l,g){for(let v in g)g.hasOwnProperty(v)&&(l[v]=g[v]);return l}function sa(l){Y||(Y="undefined"===typeof document?{}:document.createElement("a"));
Y.href=l;return Y.href}function ma(l){l=fa.createDerivedMaterial(l,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new y.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new y.Vector4(0,0,0,0)},uTroikaClipRect:{value:new y.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new y.Vector2},uTroikaCurveRadius:{value:0},
uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new y.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new y.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of encoding in SDFGenerator.js\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat distance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(distance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  distance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",
customRewriter({vertexShader:g,fragmentShader:l}){let u=/\buniform\s+vec3\s+diffuse\b/;u.test(l)&&(l=l.replace(u,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),u.test(g)||(g=g.replace(fa.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));return{vertexShader:g,fragmentShader:l}}});l.transparent=!0;Object.defineProperties(l,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},
set(){}}});return l}function xa(l){let g=na.get(l);if(!g){let {caretPositions:v,caretHeight:u}=l;g=new Map;for(let b=0;b<v.length;b+=3){let a=v[b+2],c=g.get(a);c||g.set(a,c=[]);c.push({x:v[b],y:a,height:u,charIndex:b/3});b+3>=v.length&&c.push({x:v[b+1],y:a,height:u,charIndex:b/3+1})}}na.set(l,g);return g}P=P&&"object"===typeof P&&"default"in P?P:{"default":P};var Z=N.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(l){var g=
{parse:function(b){var a=g._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var d=a.readUint(b,c);c+=4;for(var e=[],f=0;f<d;f++){var h=a.readUint(b,c);c+=4;e.push(g._readFont(b,h))}return e}return[g._readFont(b,0)]},_readFont:function(b,a){var c=g._bin,d=a;c.readFixed(b,a);a+=4;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var f="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");
d={_data:b,_offset:d};for(var h={},k=0;k<e;k++){var p=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var q=c.readUint(b,a);a+=4;var w=c.readUint(b,a);a+=4;h[p]={offset:q,length:w}}for(k=0;k<f.length;k++)a=f[k],h[a]&&(d[a.trim()]=g[a.trim()].parse(b,h[a].offset,h[a].length,d));return d},_tabOffset:function(b,a,c){var d=g._bin,e=d.readUshort(b,c+4);c+=12;for(var f=0;f<e;f++){var h=d.readASCII(b,c,4);c+=4;d.readUint(b,c);c+=4;var k=d.readUint(b,c);if(c+=4,d.readUint(b,c),c+=4,h==a)return k}return 0}};
g._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return g._bin.readShort(b,a)/16384},readInt:function(b,a){var c=g._bin.t.uint8;return c[0]=b[a+3],c[1]=b[a+2],c[2]=b[a+1],c[3]=b[a],g._bin.t.int32[0]},readInt8:function(b,a){return g._bin.t.uint8[0]=b[a],g._bin.t.int8[0]},readShort:function(b,a){var c=g._bin.t.uint8;return c[1]=b[a],c[0]=b[a+1],g._bin.t.int16[0]},readUshort:function(b,a){return b[a]<<8|b[a+1]},readUshorts:function(b,a,c){for(var d=
[],e=0;e<c;e++)d.push(g._bin.readUshort(b,a+2*e));return d},readUint:function(b,a){var c=g._bin.t.uint8;return c[3]=b[a],c[2]=b[a+1],c[1]=b[a+2],c[0]=b[a+3],g._bin.t.uint32[0]},readUint64:function(b,a){return 4294967296*g._bin.readUint(b,a)+g._bin.readUint(b,a+4)},readASCII:function(b,a,c){for(var d="",e=0;e<c;e++)d+=String.fromCharCode(b[a+e]);return d},readUnicode:function(b,a,c){for(var d="",e=0;e<c;e++){var f=b[a++]<<8|b[a++];d+=String.fromCharCode(f)}return d},_tdec:"undefined"!=typeof window&&
window.TextDecoder?new window.TextDecoder:null,readUTF8:function(b,a,c){var d=g._bin._tdec;return d&&0==a&&c==b.length?d.decode(b):g._bin.readASCII(b,a,c)},readBytes:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(b[a+e]);return d},readASCIIArray:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(String.fromCharCode(b[a+e]));return d}};g._bin.t={buff:new ArrayBuffer(8)};g._bin.t.int8=new Int8Array(g._bin.t.buff);g._bin.t.uint8=new Uint8Array(g._bin.t.buff);g._bin.t.int16=new Int16Array(g._bin.t.buff);
g._bin.t.uint16=new Uint16Array(g._bin.t.buff);g._bin.t.int32=new Int32Array(g._bin.t.buff);g._bin.t.uint32=new Uint32Array(g._bin.t.buff);g._lctf={};g._lctf.parse=function(b,a,c,d,e){var f=g._bin;c={};d=a;f.readFixed(b,a);a+=4;var h=f.readUshort(b,a);a+=2;var k=f.readUshort(b,a);a=f.readUshort(b,a+2);return c.scriptList=g._lctf.readScriptList(b,d+h),c.featureList=g._lctf.readFeatureList(b,d+k),c.lookupList=g._lctf.readLookupList(b,d+a,e),c};g._lctf.readLookupList=function(b,a,c){var d=g._bin,e=a,
f=[],h=d.readUshort(b,a);a+=2;for(var k=0;k<h;k++){var p=d.readUshort(b,a);a+=2;p=g._lctf.readLookupTable(b,e+p,c);f.push(p)}return f};g._lctf.readLookupTable=function(b,a,c){var d=g._bin,e=a,f={tabs:[]};f.ltype=d.readUshort(b,a);a+=2;f.flag=d.readUshort(b,a);a+=2;var h=d.readUshort(b,a);a+=2;for(var k=f.ltype,p=0;p<h;p++){var q=d.readUshort(b,a);a+=2;q=c(b,k,e+q,f);f.tabs.push(q)}return f};g._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};g._lctf.readClassDef=function(b,
a){var c=g._bin,d=[],e=c.readUshort(b,a);if(a+=2,1==e){var f=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;for(var k=0;k<h;k++)d.push(f+k),d.push(f+k),d.push(c.readUshort(b,a)),a+=2}if(2==e)for(e=c.readUshort(b,a),a+=2,k=0;k<e;k++)d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2;return d};g._lctf.getInterval=function(b,a){for(var c=0;c<b.length;c+=3){var d=b[c],e=b[c+1];if(b[c+2],d<=a&&a<=e)return c}return-1};g._lctf.readCoverage=function(b,a){var c=
g._bin,d={};d.fmt=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);return a+=2,1==d.fmt&&(d.tab=c.readUshorts(b,a,e)),2==d.fmt&&(d.tab=c.readUshorts(b,a,3*e)),d};g._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==b.fmt?c.indexOf(a):2==b.fmt&&(b=g._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};g._lctf.readFeatureList=function(b,a){var c=g._bin,d=a,e=[],f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readASCII(b,a,4);a+=4;var p=c.readUshort(b,a);a+=2;p=g._lctf.readFeatureTable(b,d+p);
p.tag=k.trim();e.push(p)}return e};g._lctf.readFeatureTable=function(b,a){var c=g._bin,d=a,e={},f=c.readUshort(b,a);a+=2;0<f&&(e.featureParams=d+f);d=c.readUshort(b,a);a+=2;e.tab=[];for(f=0;f<d;f++)e.tab.push(c.readUshort(b,a+2*f));return e};g._lctf.readScriptList=function(b,a){var c=g._bin,d=a,e={},f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readASCII(b,a,4);a+=4;var p=c.readUshort(b,a);a+=2;e[k.trim()]=g._lctf.readScriptTable(b,d+p)}return e};g._lctf.readScriptTable=function(b,a){var c=
g._bin,d=a,e={},f=c.readUshort(b,a);a+=2;e.default=g._lctf.readLangSysTable(b,d+f);f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readASCII(b,a,4);a+=4;var p=c.readUshort(b,a);a+=2;e[k.trim()]=g._lctf.readLangSysTable(b,d+p)}return e};g._lctf.readLangSysTable=function(b,a){var c=g._bin,d={};c.readUshort(b,a);a+=2;d.reqFeature=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);return a+=2,d.features=c.readUshorts(b,a,e),d};g.CFF={};g.CFF.parse=function(b,a,c){var d=g._bin;(b=new Uint8Array(b.buffer,
a,c))[a=0];b[++a];b[++a];b[++a];a++;var e=[];a=g.CFF.readIndex(b,a,e);var f=[];for(c=0;c<e.length-1;c++)f.push(d.readASCII(b,a+e[c],e[c+1]-e[c]));a+=e[e.length-1];e=[];a=g.CFF.readIndex(b,a,e);f=[];for(c=0;c<e.length-1;c++)f.push(g.CFF.readDict(b,a+e[c],a+e[c+1]));a+=e[e.length-1];e=f[0];var h=[];a=g.CFF.readIndex(b,a,h);f=[];for(c=0;c<h.length-1;c++)f.push(d.readASCII(b,a+h[c],h[c+1]-h[c]));if(a+=h[h.length-1],g.CFF.readSubrs(b,a,e),e.CharStrings){a=e.CharStrings;h=[];a=g.CFF.readIndex(b,a,h);var k=
[];for(c=0;c<h.length-1;c++)k.push(d.readBytes(b,a+h[c],h[c+1]-h[c]));e.CharStrings=k}if(e.ROS){a=e.FDArray;h=[];a=g.CFF.readIndex(b,a,h);e.FDArray=[];for(c=0;c<h.length-1;c++)k=g.CFF.readDict(b,a+h[c],a+h[c+1]),g.CFF._readFDict(b,k,f),e.FDArray.push(k);a=e.FDSelect;e.FDSelect=[];c=b[a];if(a++,3!=c)throw c;h=d.readUshort(b,a);a+=2;for(c=0;c<h+1;c++)e.FDSelect.push(d.readUshort(b,a),b[a+2]),a+=3}return e.Encoding&&(e.Encoding=g.CFF.readEncoding(b,e.Encoding,e.CharStrings.length)),e.charset&&(e.charset=
g.CFF.readCharset(b,e.charset,e.CharStrings.length)),g.CFF._readFDict(b,e,f),e};g.CFF._readFDict=function(b,a,c){var d,e;for(e in a.Private&&(d=a.Private[1],a.Private=g.CFF.readDict(b,d,d+a.Private[0]),a.Private.Subrs&&g.CFF.readSubrs(b,d+a.Private.Subrs,a.Private)),a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(e)&&(a[e]=c[a[e]-426+35])};g.CFF.readSubrs=function(b,a,c){var d=g._bin,e=[];a=g.CFF.readIndex(b,a,e);var f=e.length;c.Bias=1240>f?107:33900>f?1131:32768;
c.Subrs=[];for(f=0;f<e.length-1;f++)c.Subrs.push(d.readBytes(b,a+e[f],e[f+1]-e[f]))};g.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];g.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;return-1};g.CFF.glyphBySE=function(b,a){return 0>a||255<a?-1:g.CFF.glyphByUnicode(b,g.CFF.tableSE[a])};
g.CFF.readEncoding=function(b,a,c){g._bin;c=[".notdef"];var d=b[a];if(a++,0!=d)throw"error: unknown encoding format: "+d;d=b[a];a++;for(var e=0;e<d;e++)c.push(b[a+e]);return c};g.CFF.readCharset=function(b,a,c){var d=g._bin,e=[".notdef"],f=b[a];if(a++,0==f)for(var h=0;h<c;h++){var k=d.readUshort(b,a);a+=2;e.push(k)}else{if(1!=f&&2!=f)throw"error: format: "+f;for(;e.length<c;){k=d.readUshort(b,a);a+=2;var p=0;1==f?(p=b[a],a++):(p=d.readUshort(b,a),a+=2);for(h=0;h<=p;h++)e.push(k),k++}}return e};g.CFF.readIndex=
function(b,a,c){var d=g._bin,e=d.readUshort(b,a)+1,f=b[a+=2];if(a++,1==f)for(var h=0;h<e;h++)c.push(b[a+h]);else if(2==f)for(h=0;h<e;h++)c.push(d.readUshort(b,a+2*h));else if(3==f)for(h=0;h<e;h++)c.push(16777215&d.readUint(b,a+3*h-1));else if(1!=e)throw"unsupported offset size: "+f+", count: "+e;return a+e*f-1};g.CFF.getCharString=function(b,a,c){var d=g._bin,e=b[a],f=b[a+1];b[a+2];b[a+3];b[a+4];var h=1,k=null,p=null;20>=e&&(k=e,h=1);12==e&&(k=100*e+f,h=2);21<=e&&27>=e&&(k=e,h=1);28==e&&(p=d.readShort(b,
a+1),h=3);29<=e&&31>=e&&(k=e,h=1);32<=e&&246>=e&&(p=e-139,h=1);247<=e&&250>=e&&(p=256*(e-247)+f+108,h=2);251<=e&&254>=e&&(p=256*-(e-251)-f-108,h=2);255==e&&(p=d.readInt(b,a+1)/65535,h=5);c.val=null!=p?p:"o"+k;c.size=h};g.CFF.readCharString=function(b,a,c){c=a+c;for(var d=g._bin,e=[];a<c;){var f=b[a],h=b[a+1];b[a+2];b[a+3];b[a+4];var k=1,p=null,q=null;20>=f&&(p=f,k=1);12==f&&(p=100*f+h,k=2);19!=f&&20!=f||(p=f,k=2);21<=f&&27>=f&&(p=f,k=1);28==f&&(q=d.readShort(b,a+1),k=3);29<=f&&31>=f&&(p=f,k=1);32<=
f&&246>=f&&(q=f-139,k=1);247<=f&&250>=f&&(q=256*(f-247)+h+108,k=2);251<=f&&254>=f&&(q=256*-(f-251)-h-108,k=2);255==f&&(q=d.readInt(b,a+1)/65535,k=5);e.push(null!=q?q:"o"+p);a+=k}return e};g.CFF.readDict=function(b,a,c){for(var d=g._bin,e={},f=[];a<c;){var h=b[a],k=b[a+1];b[a+2];b[a+3];b[a+4];var p=1,q=null,w=null;if(28==h&&(w=d.readShort(b,a+1),p=3),29==h&&(w=d.readInt(b,a+1),p=5),32<=h&&246>=h&&(w=h-139,p=1),247<=h&&250>=h&&(w=256*(h-247)+k+108,p=2),251<=h&&254>=h&&(w=256*-(h-251)-k-108,p=2),255==
h)throw d.readInt(b,a+1),"unknown number";if(30==h){w=[];for(p=1;;){var m=b[a+p];p++;var t=m>>4;m&=15;if(15!=t&&w.push(t),15!=m&&w.push(m),15==m)break}t="";m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var n=0;n<w.length;n++)t+=m[w[n]];w=parseFloat(t)}21>=h&&(q="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" ")[h],
p=1,12==h)&&(q=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][k],p=2);null!=q?(e[q]=1==f.length?f[0]:
f,f=[]):f.push(w);a+=p}return e};g.cmap={};g.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=g._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;var f=[];d.tables=[];for(var h=0;h<e;h++){var k=c.readUshort(b,a);a+=2;var p=c.readUshort(b,a);a+=2;var q=c.readUint(b,a);a+=4;var w="p"+k+"e"+p,m=f.indexOf(q);if(-1==m){var t;m=d.tables.length;f.push(q);var n=c.readUshort(b,q);0==n?t=g.cmap.parse0(b,q):4==n?t=g.cmap.parse4(b,q):6==n?t=g.cmap.parse6(b,q):12==n?t=g.cmap.parse12(b,
q):console.debug("unknown format: "+n,k,p,q);d.tables.push(t)}if(null!=d[w])throw"multiple tables for one platform+encoding";d[w]=m}return d};g.cmap.parse0=function(b,a){var c=g._bin,d={};d.format=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;d.map=[];for(c=0;c<e-6;c++)d.map.push(b[a+c]);return d};g.cmap.parse4=function(b,a){var c=g._bin,d=a,e={};e.format=c.readUshort(b,a);a+=2;var f=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;h/=2;e.searchRange=
c.readUshort(b,a);a+=2;e.entrySelector=c.readUshort(b,a);a+=2;e.rangeShift=c.readUshort(b,a);a+=2;e.endCount=c.readUshorts(b,a,h);a=a+2*h+2;e.startCount=c.readUshorts(b,a,h);a+=2*h;e.idDelta=[];for(var k=0;k<h;k++)e.idDelta.push(c.readShort(b,a)),a+=2;e.idRangeOffset=c.readUshorts(b,a,h);a+=2*h;for(e.glyphIdArray=[];a<d+f;)e.glyphIdArray.push(c.readUshort(b,a)),a+=2;return e};g.cmap.parse6=function(b,a){var c=g._bin,d={};d.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=
2;d.firstCode=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;d.glyphIdArray=[];for(var f=0;f<e;f++)d.glyphIdArray.push(c.readUshort(b,a)),a+=2;return d};g.cmap.parse12=function(b,a){var c=g._bin,d={};d.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;var e=c.readUint(b,a);a+=4;d.groups=[];for(var f=0;f<e;f++){var h=a+12*f,k=c.readUint(b,h+0),p=c.readUint(b,h+4);h=c.readUint(b,h+8);d.groups.push([k,p,h])}return d};g.glyf={};g.glyf.parse=function(b,a,c,d){b=[];for(a=0;a<
d.maxp.numGlyphs;a++)b.push(null);return b};g.glyf._parseGlyf=function(b,a){var c=g._bin,d=b._data,e=g._tabOffset(d,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};if(b.noc=c.readShort(d,e),e+=2,b.xMin=c.readShort(d,e),e+=2,b.yMin=c.readShort(d,e),e+=2,b.xMax=c.readShort(d,e),e+=2,b.yMax=c.readShort(d,e),e+=2,b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(d,e)),e+=2;a=c.readUshort(d,e);if(e+=2,d.length-e<a)return null;
b.instructions=c.readBytes(d,e,a);e+=a;var f=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<f;a++){var h=d[e];if(e++,b.flags.push(h),0!=(8&h)){var k=d[e];e++;for(var p=0;p<k;p++)b.flags.push(h),a++}}b.xs=[];for(a=0;a<f;a++)h=0!=(2&b.flags[a]),k=0!=(16&b.flags[a]),h?(b.xs.push(k?d[e]:-d[e]),e++):k?b.xs.push(0):(b.xs.push(c.readShort(d,e)),e+=2);b.ys=[];for(a=0;a<f;a++)h=0!=(4&b.flags[a]),k=0!=(32&b.flags[a]),h?(b.ys.push(k?d[e]:-d[e]),e++):k?b.ys.push(0):(b.ys.push(c.readShort(d,e)),e+=2);for(a=e=d=0;a<
f;a++)d+=b.xs[a],e+=b.ys[a],b.xs[a]=d,b.ys[a]=e}else{b.parts=[];do a=c.readUshort(d,e),e+=2,f={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},(b.parts.push(f),f.glyphIndex=c.readUshort(d,e),e+=2,1&a)?(h=c.readShort(d,e),e+=2,k=c.readShort(d,e),e+=2):(h=c.readInt8(d,e),e++,k=c.readInt8(d,e),e++),2&a?(f.m.tx=h,f.m.ty=k):(f.p1=h,f.p2=k),8&a?(f.m.a=f.m.d=c.readF2dot14(d,e),e+=2):64&a?(f.m.a=c.readF2dot14(d,e),e+=2,f.m.d=c.readF2dot14(d,e),e+=2):128&a&&(f.m.a=c.readF2dot14(d,e),e+=2,f.m.b=c.readF2dot14(d,
e),e+=2,f.m.c=c.readF2dot14(d,e),e+=2,f.m.d=c.readF2dot14(d,e),e+=2);while(32&a);if(256&a)for(c=c.readUshort(d,e),e+=2,b.instr=[],a=0;a<c;a++)b.instr.push(d[e]),e++}return b};g.GPOS={};g.GPOS.parse=function(b,a,c,d){return g._lctf.parse(b,a,c,d,g.GPOS.subt)};g.GPOS.subt=function(b,a,c,d){var e=g._bin,f=c,h={};if(h.fmt=e.readUshort(b,c),c+=2,1==a||2==a||3==a||7==a||8==a&&2>=h.fmt){var k=e.readUshort(b,c);c+=2;h.coverage=g._lctf.readCoverage(b,k+f)}if(1==a&&1==h.fmt)d=e.readUshort(b,c),c+=2,g._lctf.numOfOnes(d),
0!=d&&(h.pos=g.GPOS.readValueRecord(b,c,d));else if(2==a&&1<=h.fmt&&2>=h.fmt){d=e.readUshort(b,c);c+=2;k=e.readUshort(b,c);c+=2;a=g._lctf.numOfOnes(d);var p=g._lctf.numOfOnes(k);if(1==h.fmt){h.pairsets=[];var q=e.readUshort(b,c);c+=2;for(var w=0;w<q;w++){var m=f+e.readUshort(b,c);c+=2;var t=e.readUshort(b,m);m+=2;for(var n=[],r=0;r<t;r++){var l=e.readUshort(b,m);m+=2;0!=d&&(x=g.GPOS.readValueRecord(b,m,d),m+=2*a);0!=k&&(u=g.GPOS.readValueRecord(b,m,k),m+=2*p);n.push({gid2:l,val1:x,val2:u})}h.pairsets.push(n)}}if(2==
h.fmt)for(x=e.readUshort(b,c),c+=2,u=e.readUshort(b,c),c+=2,q=e.readUshort(b,c),c+=2,e=e.readUshort(b,c),c+=2,h.classDef1=g._lctf.readClassDef(b,f+x),h.classDef2=g._lctf.readClassDef(b,f+u),h.matrix=[],w=0;w<q;w++){f=[];for(r=0;r<e;r++){var x=null,u=null;0!=d&&(x=g.GPOS.readValueRecord(b,c,d),c+=2*a);0!=k&&(u=g.GPOS.readValueRecord(b,c,k),c+=2*p);f.push({val1:x,val2:u})}h.matrix.push(f)}}else{if(9==a&&1==h.fmt){h=e.readUshort(b,c);c=e.readUint(b,c+2);if(9==d.ltype)d.ltype=h;else if(d.ltype!=h)throw"invalid extension substitution";
return g.GPOS.subt(b,d.ltype,f+c)}console.debug("unsupported GPOS table LookupType",a,"format",h.fmt)}return h};g.GPOS.readValueRecord=function(b,a,c){var d=g._bin,e=[];return e.push(1&c?d.readShort(b,a):0),a+=1&c?2:0,e.push(2&c?d.readShort(b,a):0),a+=2&c?2:0,e.push(4&c?d.readShort(b,a):0),a+=4&c?2:0,e.push(8&c?d.readShort(b,a):0),e};g.GSUB={};g.GSUB.parse=function(b,a,c,d){return g._lctf.parse(b,a,c,d,g.GSUB.subt)};g.GSUB.subt=function(b,a,c,d){var e=g._bin,f=c,h={};if(h.fmt=e.readUshort(b,c),c+=
2,1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=h.fmt||6==a&&2>=h.fmt){var k=e.readUshort(b,c);c+=2;h.coverage=g._lctf.readCoverage(b,f+k)}if(1==a&&1<=h.fmt&&2>=h.fmt)1==h.fmt?h.delta=e.readShort(b,c):2==h.fmt&&(a=e.readUshort(b,c),h.newg=e.readUshorts(b,c+2,a));else if(4==a)for(h.vals=[],a=e.readUshort(b,c),c+=2,d=0;d<a;d++)k=e.readUshort(b,c),c+=2,h.vals.push(g.GSUB.readLigatureSet(b,f+k));else if(5==a&&2==h.fmt){if(2==h.fmt)for(d=e.readUshort(b,c),c+=2,h.cDef=g._lctf.readClassDef(b,
f+d),h.scset=[],a=e.readUshort(b,c),c+=2,d=0;d<a;d++)k=e.readUshort(b,c),c+=2,h.scset.push(0==k?null:g.GSUB.readSubClassSet(b,f+k))}else if(6==a&&3==h.fmt){if(3==h.fmt){for(d=0;3>d;d++){a=e.readUshort(b,c);c+=2;k=[];for(var p=0;p<a;p++)k.push(g._lctf.readCoverage(b,f+e.readUshort(b,c+2*p)));c+=2*a;0==d&&(h.backCvg=k);1==d&&(h.inptCvg=k);2==d&&(h.ahedCvg=k)}a=e.readUshort(b,c);h.lookupRec=g.GSUB.readSubstLookupRecords(b,c+2,a)}}else{if(7==a&&1==h.fmt){h=e.readUshort(b,c);c=e.readUint(b,c+2);if(9==
d.ltype)d.ltype=h;else if(d.ltype!=h)throw"invalid extension substitution";return g.GSUB.subt(b,d.ltype,f+c)}console.debug("unsupported GSUB table LookupType",a,"format",h.fmt)}return h};g.GSUB.readSubClassSet=function(b,a){var c=g._bin.readUshort,d=a,e=[],f=c(b,a);a+=2;for(var h=0;h<f;h++){var k=c(b,a);a+=2;e.push(g.GSUB.readSubClassRule(b,d+k))}return e};g.GSUB.readSubClassRule=function(b,a){var c=g._bin.readUshort,d={},e=c(b,a),f=c(b,a+=2);a+=2;d.input=[];for(var h=0;h<e-1;h++)d.input.push(c(b,
a)),a+=2;return d.substLookupRecords=g.GSUB.readSubstLookupRecords(b,a,f),d};g.GSUB.readSubstLookupRecords=function(b,a,c){for(var d=g._bin.readUshort,e=[],f=0;f<c;f++)e.push(d(b,a),d(b,a+2)),a+=4;return e};g.GSUB.readChainSubClassSet=function(b,a){var c=g._bin,d=a,e=[],f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readUshort(b,a);a+=2;e.push(g.GSUB.readChainSubClassRule(b,d+k))}return e};g.GSUB.readChainSubClassRule=function(b,a){for(var c=g._bin,d={},e=["backtrack","input","lookahead"],
f=0;f<e.length;f++){var h=c.readUshort(b,a);a+=2;1==f&&h--;d[e[f]]=c.readUshorts(b,a,h);a+=2*d[e[f]].length}h=c.readUshort(b,a);return a+=2,d.subst=c.readUshorts(b,a,2*h),d};g.GSUB.readLigatureSet=function(b,a){var c=g._bin,d=a,e=[],f=c.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=c.readUshort(b,a);a+=2;e.push(g.GSUB.readLigature(b,d+k))}return e};g.GSUB.readLigature=function(b,a){var c=g._bin,d={chain:[]};d.nglyph=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;for(var f=0;f<e-1;f++)d.chain.push(c.readUshort(b,
a)),a+=2;return d};g.head={};g.head.parse=function(b,a,c){c=g._bin;var d={};return c.readFixed(b,a),a+=4,d.fontRevision=c.readFixed(b,a),a+=4,c.readUint(b,a),a+=4,c.readUint(b,a),a+=4,d.flags=c.readUshort(b,a),a+=2,d.unitsPerEm=c.readUshort(b,a),a+=2,d.created=c.readUint64(b,a),a+=8,d.modified=c.readUint64(b,a),a+=8,d.xMin=c.readShort(b,a),a+=2,d.yMin=c.readShort(b,a),a+=2,d.xMax=c.readShort(b,a),a+=2,d.yMax=c.readShort(b,a),a+=2,d.macStyle=c.readUshort(b,a),a+=2,d.lowestRecPPEM=c.readUshort(b,a),
a+=2,d.fontDirectionHint=c.readShort(b,a),a+=2,d.indexToLocFormat=c.readShort(b,a),a+=2,d.glyphDataFormat=c.readShort(b,a),d};g.hhea={};g.hhea.parse=function(b,a,c){c=g._bin;var d={};return c.readFixed(b,a),a+=4,d.ascender=c.readShort(b,a),a+=2,d.descender=c.readShort(b,a),a+=2,d.lineGap=c.readShort(b,a),a+=2,d.advanceWidthMax=c.readUshort(b,a),a+=2,d.minLeftSideBearing=c.readShort(b,a),a+=2,d.minRightSideBearing=c.readShort(b,a),a+=2,d.xMaxExtent=c.readShort(b,a),a+=2,d.caretSlopeRise=c.readShort(b,
a),a+=2,d.caretSlopeRun=c.readShort(b,a),a+=2,d.caretOffset=c.readShort(b,a),a+=2,a+=8,d.metricDataFormat=c.readShort(b,a),a+=2,d.numberOfHMetrics=c.readUshort(b,a),d};g.hmtx={};g.hmtx.parse=function(b,a,c,d){c=g._bin;for(var e={aWidth:[],lsBearing:[]},f=0,h=0,k=0;k<d.maxp.numGlyphs;k++)k<d.hhea.numberOfHMetrics&&(f=c.readUshort(b,a),a+=2,h=c.readShort(b,a),a+=2),e.aWidth.push(f),e.lsBearing.push(h);return e};g.kern={};g.kern.parse=function(b,a,c,d){var e=g._bin,f=e.readUshort(b,a);if(a+=2,1==f)return g.kern.parseV1(b,
a-2,c,d);c=e.readUshort(b,a);a+=2;d={glyph1:[],rval:[]};for(f=0;f<c;f++){a+=2;e.readUshort(b,a);a+=2;var h=e.readUshort(b,a);a+=2;h>>>=8;if(0!=(h&=15))throw"unknown kern table format: "+h;a=g.kern.readFormat0(b,a,d)}return d};g.kern.parseV1=function(b,a,c,d){c=g._bin;c.readFixed(b,a);a+=4;d=c.readUint(b,a);a+=4;for(var e={glyph1:[],rval:[]},f=0;f<d;f++){c.readUint(b,a);a+=4;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;h>>>=8;if(0!=(h&=15))throw"unknown kern table format: "+h;a=g.kern.readFormat0(b,
a,e)}return e};g.kern.readFormat0=function(b,a,c){var d=g._bin,e=-1,f=d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;for(var h=0;h<f;h++){var k=d.readUshort(b,a);a+=2;var p=d.readUshort(b,a);a+=2;var q=d.readShort(b,a);a+=2;k!=e&&(c.glyph1.push(k),c.rval.push({glyph2:[],vals:[]}));e=c.rval[c.rval.length-1];e.glyph2.push(p);e.vals.push(q);e=k}return a};g.loca={};g.loca.parse=function(b,a,c,d){c=g._bin;var e=[],f=d.head.indexToLocFormat;d=d.maxp.numGlyphs+
1;if(0==f)for(var h=0;h<d;h++)e.push(c.readUshort(b,a+(h<<1))<<1);if(1==f)for(h=0;h<d;h++)e.push(c.readUint(b,a+(h<<2)));return e};g.maxp={};g.maxp.parse=function(b,a,c){c=g._bin;var d={},e=c.readUint(b,a);return a+=4,d.numGlyphs=c.readUshort(b,a),a+=2,65536==e&&(d.maxPoints=c.readUshort(b,a),a+=2,d.maxContours=c.readUshort(b,a),a+=2,d.maxCompositePoints=c.readUshort(b,a),a+=2,d.maxCompositeContours=c.readUshort(b,a),a+=2,d.maxZones=c.readUshort(b,a),a+=2,d.maxTwilightPoints=c.readUshort(b,a),a+=
2,d.maxStorage=c.readUshort(b,a),a+=2,d.maxFunctionDefs=c.readUshort(b,a),a+=2,d.maxInstructionDefs=c.readUshort(b,a),a+=2,d.maxStackElements=c.readUshort(b,a),a+=2,d.maxSizeOfInstructions=c.readUshort(b,a),a+=2,d.maxComponentElements=c.readUshort(b,a),a+=2,d.maxComponentDepth=c.readUshort(b,a)),d};g.name={};g.name.parse=function(b,a,c){c=g._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);for(var f,h="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
k=a+=2,p=0;p<e;p++){var q=c.readUshort(b,a);a+=2;var w=c.readUshort(b,a);a+=2;var m=c.readUshort(b,a);a+=2;var t=c.readUshort(b,a);a+=2;var n=c.readUshort(b,a);a+=2;var r=c.readUshort(b,a);a+=2;var l=h[t];r=k+12*e+r;if(0==q)n=c.readUnicode(b,r,n/2);else if(3==q&&0==w)n=c.readUnicode(b,r,n/2);else if(0==w)n=c.readASCII(b,r,n);else if(1==w)n=c.readUnicode(b,r,n/2);else if(3==w)n=c.readUnicode(b,r,n/2);else{if(1!=q)throw"unknown encoding "+w+", platformID: "+q;n=c.readASCII(b,r,n);console.debug("reading unknown MAC encoding "+
w+" as ASCII")}q="p"+q+","+m.toString(16);null==d[q]&&(d[q]={});d[q][void 0!==l?l:t]=n;d[q]._lang=m}for(var x in d)if(null!=d[x].postScriptName&&1033==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName&&0==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName&&3084==d[x]._lang)return d[x];for(x in d)if(null!=d[x].postScriptName)return d[x];for(x in d){f=x;break}return console.debug("returning name table with languageID "+d[f]._lang),d[f]};g["OS/2"]={};g["OS/2"].parse=function(b,
a,c){c=g._bin.readUshort(b,a);a+=2;var d={};if(0==c)g["OS/2"].version0(b,a,d);else if(1==c)g["OS/2"].version1(b,a,d);else if(2==c||3==c||4==c)g["OS/2"].version2(b,a,d);else{if(5!=c)throw"unknown OS/2 table version: "+c;g["OS/2"].version5(b,a,d)}return d};g["OS/2"].version0=function(b,a,c){var d=g._bin;return c.xAvgCharWidth=d.readShort(b,a),a+=2,c.usWeightClass=d.readUshort(b,a),a+=2,c.usWidthClass=d.readUshort(b,a),a+=2,c.fsType=d.readUshort(b,a),a+=2,c.ySubscriptXSize=d.readShort(b,a),a+=2,c.ySubscriptYSize=
d.readShort(b,a),a+=2,c.ySubscriptXOffset=d.readShort(b,a),a+=2,c.ySubscriptYOffset=d.readShort(b,a),a+=2,c.ySuperscriptXSize=d.readShort(b,a),a+=2,c.ySuperscriptYSize=d.readShort(b,a),a+=2,c.ySuperscriptXOffset=d.readShort(b,a),a+=2,c.ySuperscriptYOffset=d.readShort(b,a),a+=2,c.yStrikeoutSize=d.readShort(b,a),a+=2,c.yStrikeoutPosition=d.readShort(b,a),a+=2,c.sFamilyClass=d.readShort(b,a),a+=2,c.panose=d.readBytes(b,a,10),a+=10,c.ulUnicodeRange1=d.readUint(b,a),a+=4,c.ulUnicodeRange2=d.readUint(b,
a),a+=4,c.ulUnicodeRange3=d.readUint(b,a),a+=4,c.ulUnicodeRange4=d.readUint(b,a),a+=4,c.achVendID=[d.readInt8(b,a),d.readInt8(b,a+1),d.readInt8(b,a+2),d.readInt8(b,a+3)],a+=4,c.fsSelection=d.readUshort(b,a),a+=2,c.usFirstCharIndex=d.readUshort(b,a),a+=2,c.usLastCharIndex=d.readUshort(b,a),a+=2,c.sTypoAscender=d.readShort(b,a),a+=2,c.sTypoDescender=d.readShort(b,a),a+=2,c.sTypoLineGap=d.readShort(b,a),a+=2,c.usWinAscent=d.readUshort(b,a),a+=2,c.usWinDescent=d.readUshort(b,a),a+2};g["OS/2"].version1=
function(b,a,c){var d=g._bin;return a=g["OS/2"].version0(b,a,c),c.ulCodePageRange1=d.readUint(b,a),a+=4,c.ulCodePageRange2=d.readUint(b,a),a+4};g["OS/2"].version2=function(b,a,c){var d=g._bin;return a=g["OS/2"].version1(b,a,c),c.sxHeight=d.readShort(b,a),a+=2,c.sCapHeight=d.readShort(b,a),a+=2,c.usDefault=d.readUshort(b,a),a+=2,c.usBreak=d.readUshort(b,a),a+=2,c.usMaxContext=d.readUshort(b,a),a+2};g["OS/2"].version5=function(b,a,c){var d=g._bin;return a=g["OS/2"].version2(b,a,c),c.usLowerOpticalPointSize=
d.readUshort(b,a),a+=2,c.usUpperOpticalPointSize=d.readUshort(b,a),a+2};g.post={};g.post.parse=function(b,a,c){c=g._bin;var d={};return d.version=c.readFixed(b,a),a+=4,d.italicAngle=c.readFixed(b,a),a+=4,d.underlinePosition=c.readShort(b,a),a+=2,d.underlineThickness=c.readShort(b,a),d};null==g&&(g={});null==g.U&&(g.U={});g.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;if(null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3),-1==c)throw"no familiar platform and encoding!";
b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var d=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){d=c;break}return-1==d||b.startCount[d]>a?0:65535&(0!=b.idRangeOffset[d]?b.glyphIdArray[a-b.startCount[d]+(b.idRangeOffset[d]>>1)-(b.idRangeOffset.length-d)]:a+b.idDelta[d])}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(d=b.groups[c],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+
b.format;};g.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var d=b.SVG.entries[a];return null==d?c:("string"==typeof d&&(d=g.SVG.toPath(d),b.SVG.entries[a]=d),d)}if(b.CFF){d={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var e=b.CFF,f=b.CFF.Private;if(e.ROS){for(f=0;e.FDSelect[f+2]<=a;)f+=2;f=e.FDArray[e.FDSelect[f+1]].Private}g.U._drawCFF(b.CFF.CharStrings[a],d,e,f,c)}else b.glyf&&g.U._drawGlyf(a,b,c);return c};
g.U._drawGlyf=function(b,a,c){var d=a.glyf[b];null==d&&(d=a.glyf[b]=g.glyf._parseGlyf(a,b));null!=d&&(-1<d.noc?g.U._simpleGlyph(d,c):g.U._compoGlyph(d,a,c))};g.U._simpleGlyph=function(b,a){for(var c=0;c<b.noc;c++){for(var d=0==c?0:b.endPts[c-1]+1,e=b.endPts[c],f=d;f<=e;f++){var h=f==d?e:f-1,k=f==e?d:f+1,p=1&b.flags[f],q=1&b.flags[h],w=1&b.flags[k],m=b.xs[f],t=b.ys[f];if(f==d)if(p){if(!q){g.U.P.moveTo(a,m,t);continue}g.U.P.moveTo(a,b.xs[h],b.ys[h])}else q?g.U.P.moveTo(a,b.xs[h],b.ys[h]):g.U.P.moveTo(a,
(b.xs[h]+m)/2,(b.ys[h]+t)/2);p?q&&g.U.P.lineTo(a,m,t):w?g.U.P.qcurveTo(a,m,t,b.xs[k],b.ys[k]):g.U.P.qcurveTo(a,m,t,(m+b.xs[k])/2,(t+b.ys[k])/2)}g.U.P.closePath(a)}};g.U._compoGlyph=function(b,a,c){for(var d=0;d<b.parts.length;d++){var e={cmds:[],crds:[]},f=b.parts[d];g.U._drawGlyf(f.glyphIndex,a,e);f=f.m;for(var h=0;h<e.crds.length;h+=2){var k=e.crds[h],p=e.crds[h+1];c.crds.push(k*f.a+p*f.b+f.tx);c.crds.push(k*f.c+p*f.d+f.ty)}for(h=0;h<e.cmds.length;h++)c.cmds.push(e.cmds[h])}};g.U._getGlyphClass=
function(b,a){b=g._lctf.getInterval(a,b);return-1==b?0:a[b+2]};g.U.getPairAdjustment=function(b,a,c){var d=0;if(b.GPOS){var e=b.GPOS,f=e.lookupList;e=e.featureList;for(var h=[],k=0;k<e.length;k++){var p=e[k];if("kern"==p.tag)for(var q=0;q<p.tab.length;q++)if(!h[p.tab[q]]){h[p.tab[q]]=!0;for(var w=f[p.tab[q]],m=0;m<w.tabs.length;m++)if(null!=w.tabs[m]){var t,n=w.tabs[m];if((!n.coverage||-1!=(t=g._lctf.coverageIndex(n.coverage,a)))&&1!=w.ltype&&2==w.ltype){var r;if(1==n.fmt)for(n=n.pairsets[t],k=0;k<
n.length;k++)n[k].gid2==c&&(r=n[k]);else if(2==n.fmt){r=g.U._getGlyphClass(a,n.classDef1);var l=g.U._getGlyphClass(c,n.classDef2);r=n.matrix[r][l]}r&&r.val1&&r.val1[2]&&(d+=r.val1[2]);r&&r.val2&&r.val2[0]&&(d+=r.val2[0])}}}}}b.kern&&(a=b.kern.glyph1.indexOf(a),-1!=a&&(c=b.kern.rval[a].glyph2.indexOf(c),-1!=c&&(d+=b.kern.rval[a].vals[c])));return d};g.U._applySubs=function(b,a,c,d){for(var e=b.length-a-1,f=0;f<c.tabs.length;f++)if(null!=c.tabs[f]){var h,k=c.tabs[f];if(!k.coverage||-1!=(h=g._lctf.coverageIndex(k.coverage,
b[a])))if(1==c.ltype)b[a],1==k.fmt?b[a]+=k.delta:b[a]=k.newg[h];else if(4==c.ltype)for(var p=k.vals[h],q=0;q<p.length;q++){var w=p[q];k=w.chain.length;if(!(k>e)){for(var m=!0,t=0,n=0;n<k;n++){for(;-1==b[a+t+(1+n)];)t++;w.chain[n]!=b[a+t+(1+n)]&&(m=!1)}if(m){b[a]=w.nglyph;for(n=0;n<k+t;n++)b[a+n+1]=-1;break}}}else if(5==c.ltype&&2==k.fmt)for(p=g._lctf.getInterval(k.cDef,b[a]),t=k.scset[k.cDef[p+2]],w=0;w<t.length;w++){q=t[w];var r=q.input;if(!(r.length>e)){m=!0;for(n=0;n<r.length;n++){var l=g._lctf.getInterval(k.cDef,
b[a+1+n]);if(-1==p&&k.cDef[l+2]!=r[n]){m=!1;break}}if(m)for(m=q.substLookupRecords,q=0;q<m.length;q+=2)m[q],m[q+1]}}else if(6==c.ltype&&3==k.fmt&&g.U._glsCovered(b,k.backCvg,a-k.backCvg.length)&&g.U._glsCovered(b,k.inptCvg,a)&&g.U._glsCovered(b,k.ahedCvg,a+k.inptCvg.length))for(m=k.lookupRec,w=0;w<m.length;w+=2)p=m[w],g.U._applySubs(b,a+p,d[m[w+1]],d)}};g.U._glsCovered=function(b,a,c){for(var d=0;d<a.length;d++)if(-1==g._lctf.coverageIndex(a[d],b[c+d]))return!1;return!0};g.U.glyphsToPath=function(b,
a,c){for(var d={cmds:[],crds:[]},e=0,f=0;f<a.length;f++){var h=a[f];if(-1!=h){for(var k=f<a.length-1&&-1!=a[f+1]?a[f+1]:0,p=g.U.glyphToPath(b,h),q=0;q<p.crds.length;q+=2)d.crds.push(p.crds[q]+e),d.crds.push(p.crds[q+1]);c&&d.cmds.push(c);for(q=0;q<p.cmds.length;q++)d.cmds.push(p.cmds[q]);c&&d.cmds.push("X");e+=b.hmtx.aWidth[h];f<a.length-1&&(e+=g.U.getPairAdjustment(b,h,k))}}return d};g.U.P={};g.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,c)};g.U.P.lineTo=function(b,a,c){b.cmds.push("L");
b.crds.push(a,c)};g.U.P.curveTo=function(b,a,c,d,e,f,g){b.cmds.push("C");b.crds.push(a,c,d,e,f,g)};g.U.P.qcurveTo=function(b,a,c,d,e){b.cmds.push("Q");b.crds.push(a,c,d,e)};g.U.P.closePath=function(b){b.cmds.push("Z")};g.U._drawCFF=function(b,a,c,d,e){for(var f=a.stack,h=a.nStems,k=a.haveWidth,p=a.width,q=a.open,w=0,m=a.x,t=a.y,n=0,r=0,l=0,x=0,u=0,K=0,D=0,H=0,E=0,J=0,v={val:0,size:0};w<b.length;){g.CFF.getCharString(b,w,v);var B=v.val;if(w+=v.size,"o1"==B||"o18"==B)0!=f.length%2&&!k&&(p=f.shift()+
d.nominalWidthX),h+=f.length>>1,f.length=0,k=!0;else if("o3"==B||"o23"==B)0!=f.length%2&&!k&&(p=f.shift()+d.nominalWidthX),h+=f.length>>1,f.length=0,k=!0;else if("o4"==B)1<f.length&&!k&&(p=f.shift()+d.nominalWidthX,k=!0),q&&g.U.P.closePath(e),t+=f.pop(),g.U.P.moveTo(e,m,t),q=!0;else if("o5"==B)for(;0<f.length;)m+=f.shift(),t+=f.shift(),g.U.P.lineTo(e,m,t);else if("o6"==B||"o7"==B){var I=f.length,L="o6"==B;for(B=0;B<I;B++){var A=f.shift();L?m+=A:t+=A;L=!L;g.U.P.lineTo(e,m,t)}}else if("o8"==B||"o24"==
B){I=f.length;for(L=0;L+6<=I;)n=m+f.shift(),r=t+f.shift(),l=n+f.shift(),x=r+f.shift(),m=l+f.shift(),t=x+f.shift(),g.U.P.curveTo(e,n,r,l,x,m,t),L+=6;"o24"==B&&(m+=f.shift(),t+=f.shift(),g.U.P.lineTo(e,m,t))}else{if("o11"==B)break;if("o1234"==B||"o1235"==B||"o1236"==B||"o1237"==B)"o1234"==B&&(r=t,l=(n=m+f.shift())+f.shift(),J=x=r+f.shift(),K=x,H=t,m=(D=(u=(E=l+f.shift())+f.shift())+f.shift())+f.shift(),g.U.P.curveTo(e,n,r,l,x,E,J),g.U.P.curveTo(e,u,K,D,H,m,t)),"o1235"==B&&(n=m+f.shift(),r=t+f.shift(),
l=n+f.shift(),x=r+f.shift(),E=l+f.shift(),J=x+f.shift(),u=E+f.shift(),K=J+f.shift(),D=u+f.shift(),H=K+f.shift(),m=D+f.shift(),t=H+f.shift(),f.shift(),g.U.P.curveTo(e,n,r,l,x,E,J),g.U.P.curveTo(e,u,K,D,H,m,t)),"o1236"==B&&(n=m+f.shift(),r=t+f.shift(),l=n+f.shift(),J=x=r+f.shift(),K=x,D=(u=(E=l+f.shift())+f.shift())+f.shift(),H=K+f.shift(),m=D+f.shift(),g.U.P.curveTo(e,n,r,l,x,E,J),g.U.P.curveTo(e,u,K,D,H,m,t)),"o1237"==B&&(n=m+f.shift(),r=t+f.shift(),l=n+f.shift(),x=r+f.shift(),E=l+f.shift(),J=x+f.shift(),
u=E+f.shift(),K=J+f.shift(),D=u+f.shift(),H=K+f.shift(),Math.abs(D-m)>Math.abs(H-t)?m=D+f.shift():t=H+f.shift(),g.U.P.curveTo(e,n,r,l,x,E,J),g.U.P.curveTo(e,u,K,D,H,m,t));else if("o14"==B){if(0<f.length&&!k&&(p=f.shift()+c.nominalWidthX,k=!0),4==f.length)I=f.shift(),L=f.shift(),A=f.shift(),B=f.shift(),A=g.CFF.glyphBySE(c,A),B=g.CFF.glyphBySE(c,B),g.U._drawCFF(c.CharStrings[A],a,c,d,e),a.x=I,a.y=L,g.U._drawCFF(c.CharStrings[B],a,c,d,e);q&&(g.U.P.closePath(e),q=!1)}else if("o19"==B||"o20"==B)0!=f.length%
2&&!k&&(p=f.shift()+d.nominalWidthX),h+=f.length>>1,f.length=0,k=!0,w+=h+7>>3;else if("o21"==B)2<f.length&&!k&&(p=f.shift()+d.nominalWidthX,k=!0),t+=f.pop(),m+=f.pop(),q&&g.U.P.closePath(e),g.U.P.moveTo(e,m,t),q=!0;else if("o22"==B)1<f.length&&!k&&(p=f.shift()+d.nominalWidthX,k=!0),m+=f.pop(),q&&g.U.P.closePath(e),g.U.P.moveTo(e,m,t),q=!0;else if("o25"==B){for(;6<f.length;)m+=f.shift(),t+=f.shift(),g.U.P.lineTo(e,m,t);n=m+f.shift();r=t+f.shift();l=n+f.shift();x=r+f.shift();m=l+f.shift();t=x+f.shift();
g.U.P.curveTo(e,n,r,l,x,m,t)}else if("o26"==B)for(f.length%2&&(m+=f.shift());0<f.length;)n=m,r=t+f.shift(),m=l=n+f.shift(),t=(x=r+f.shift())+f.shift(),g.U.P.curveTo(e,n,r,l,x,m,t);else if("o27"==B)for(f.length%2&&(t+=f.shift());0<f.length;)r=t,l=(n=m+f.shift())+f.shift(),x=r+f.shift(),m=l+f.shift(),t=x,g.U.P.curveTo(e,n,r,l,x,m,t);else if("o10"==B||"o29"==B)I="o10"==B?d:c,0==f.length?console.debug("error: empty stack"):(L=f.pop(),I=I.Subrs[L+I.Bias],a.x=m,a.y=t,a.nStems=h,a.haveWidth=k,a.width=p,
a.open=q,g.U._drawCFF(I,a,c,d,e),m=a.x,t=a.y,h=a.nStems,k=a.haveWidth,p=a.width,q=a.open);else if("o30"==B||"o31"==B)for(I=f.length,B=(L=0,"o31"==B),L+=I-(I&=-3);L<I;)B?(r=t,l=(n=m+f.shift())+f.shift(),t=(x=r+f.shift())+f.shift(),5==I-L?(m=l+f.shift(),L++):m=l,B=!1):(n=m,r=t+f.shift(),l=n+f.shift(),x=r+f.shift(),m=l+f.shift(),5==I-L?(t=x+f.shift(),L++):t=x,B=!0),g.U.P.curveTo(e,n,r,l,x,m,t),L+=4;else{if("o"==(B+"").charAt(0))throw console.debug("Unknown operation: "+B,b),B;f.push(B)}}}a.x=m;a.y=t;
a.nStems=h;a.haveWidth=k;a.width=p;a.open=q};var v=g,u={Typr:v};return l.Typr=v,l.default=u,Object.defineProperty(l,"__esModule",{value:!0}),l}({}).Typr},function(){return function(l){var g=Uint8Array,v=Uint16Array,u=Uint32Array,b=new g([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new g([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new g([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=function(a,b){for(var c=new v(31),d=0;31>d;++d)c[d]=b+=
1<<a[d-1];a=new u(c[30]);for(d=1;30>d;++d)for(b=c[d];b<c[d+1];++b)a[b]=b-c[d]<<5|d;return[c,a]},e=d(b,2),f=e[0];e=e[1];f[28]=258;e[258]=28;var h=d(a,0)[0],k=new v(32768);for(d=0;32768>d;++d)e=(43690&d)>>>1|(21845&d)<<1,e=(61680&(e=(52428&e)>>>2|(13107&e)<<2))>>>4|(3855&e)<<4,k[d]=((65280&e)>>>8|(255&e)<<8)>>>1;var p=function(a,b,c){for(var d=a.length,e=0,f=new v(b);e<d;++e)++f[a[e]-1];var g=new v(b);for(e=0;e<b;++e)g[e]=g[e-1]+f[e-1]<<1;if(c)for(c=new v(1<<b),f=15-b,e=0;e<d;++e){if(a[e]){var h=e<<
4|a[e],m=b-a[e],n=g[a[e]-1]++<<m;for(m=n|(1<<m)-1;n<=m;++n)c[k[n]>>>f]=h}}else for(c=new v(d),e=0;e<d;++e)a[e]&&(c[e]=k[g[a[e]-1]++]>>>15-a[e]);return c};e=new g(288);for(d=0;144>d;++d)e[d]=8;for(d=144;256>d;++d)e[d]=9;for(d=256;280>d;++d)e[d]=7;for(d=280;288>d;++d)e[d]=8;var q=new g(32);for(d=0;32>d;++d)q[d]=5;var w=p(e,9,1),m=p(q,5,1),t=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},n=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(7&b)&c},r=function(a,b){var c=b/
8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(7&b)},G=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],x=function(a,b,c){b=Error(b||G[a]);if(b.code=a,Error.captureStackTrace&&Error.captureStackTrace(b,x),!c)throw b;return b},F=function(d,e,k){var l=d.length;if(!l||k&&!k.l&&5>l)return e||
new g(0);var q=!e||k,G=!k||k.i;k||(k={});e||(e=new g(3*l));var B,H=function(a){var b=e.length;a>b&&(a=new g(Math.max(2*b,a)),a.set(e),e=a)},K=k.f||0,A=k.p||0,D=k.b||0,F=k.l,y=k.d,C=k.m,U=k.n,ia=8*l;do{if(!F){k.f=K=n(d,A,1);var z=n(d,A+1,3);if(A+=3,!z){A=d[(V=((B=A)/8|0)+(7&B&&1)+4)-4]|d[V-3]<<8;z=V+A;if(z>l){G&&x(0);break}q&&H(D+A);e.set(d.subarray(V,z),D);k.b=D+=A;k.p=A=8*z;continue}if(1==z)F=w,y=m,C=9,U=5;else if(2==z){C=n(d,A,31)+257;y=n(d,A+10,15)+4;F=C+n(d,A+5,31)+1;A+=14;U=new g(F);var M=new g(19);
for(z=0;z<y;++z)M[c[z]]=n(d,A+3*z,7);A+=3*y;z=t(M);y=(1<<z)-1;var ja=p(M,z,1);for(z=0;z<F;){var V;V=ja[n(d,A,y)];if(A+=15&V,16>(V>>>=4))U[z++]=V;else{var ba=M=0;for(16==V?(ba=3+n(d,A,3),A+=2,M=U[z-1]):17==V?(ba=3+n(d,A,7),A+=3):18==V&&(ba=11+n(d,A,127),A+=7);ba--;)U[z++]=M}}F=U.subarray(0,C);z=U.subarray(C);C=t(F);U=t(z);F=p(F,C,1);y=p(z,U,1)}else x(1);if(A>ia){G&&x(0);break}}q&&H(D+131072);ja=(1<<C)-1;ba=(1<<U)-1;for(var R=A;;R=A){z=(M=F[r(d,A)&ja])>>>4;if((A+=15&M)>ia){G&&x(0);break}if(M||x(2),
256>z)e[D++]=z;else{if(256==z){R=A;F=null;break}M=z-254;if(264<z){var O=b[z-=257];M=n(d,A,(1<<O)-1)+f[z];A+=O}z=y[r(d,A)&ba];O=z>>>4;z||x(3);A+=15&z;z=h[O];3<O&&(O=a[O],z+=r(d,A)&(1<<O)-1,A+=O);if(A>ia){G&&x(0);break}q&&H(D+131072);for(M=D+M;D<M;D+=4)e[D]=e[D-z],e[D+1]=e[D+1-z],e[D+2]=e[D+2-z],e[D+3]=e[D+3-z];D=M}}k.l=F;k.p=R;k.b=D;F&&(K=1,k.m=C,k.d=y,k.n=U)}while(!K);return D==e.length?e:function(a,b,c){(null==b||0>b)&&(b=0);(null==c||c>a.length)&&(c=a.length);var d=new (a instanceof v?v:a instanceof
u?u:g)(c-b);return d.set(a.subarray(b,c)),d}(e,0,D)};d=new g(0);e="undefined"!=typeof TextDecoder&&new TextDecoder;try{e.decode(d,{stream:!0}),1}catch(K){}return l.convert_streams=function(a){function b(){var a=f.getUint16(g);return g+=2,a}function c(){var a=f.getUint32(g);return g+=4,a}function d(a){u.setUint16(x,a);x+=2}function e(a){u.setUint32(x,a);x+=4}var f=new DataView(a),g=0;c();var h=c();c();var k=b();b();c();b();b();c();c();c();c();c();for(var m=0;Math.pow(2,m)<=k;)m++;m--;for(var n=16*
Math.pow(2,m),t=16*k-n,r=12,p=[],l=0;l<k;l++)p.push({tag:c(),offset:c(),compLength:c(),origLength:c(),origChecksum:c()}),r+=16;var q,w=new Uint8Array(12+16*p.length+p.reduce(function(a,b){return a+b.origLength+4},0));l=w.buffer;var u=new DataView(l),x=0;return e(h),d(k),d(n),d(m),d(t),p.forEach(function(a){e(a.tag);e(a.origChecksum);e(r);e(a.origLength);a.outOffset=r;0!=(r+=a.origLength)%4&&(r+=4-r%4)}),p.forEach(function(b){var c=a.slice(b.offset,b.offset+b.compLength);if(b.compLength!=b.origLength){var d=
new Uint8Array(b.origLength);c=new Uint8Array(c,2);F(c,d)}else d=new Uint8Array(c);w.set(d,b.outOffset);d=0;0!=(r=b.outOffset+b.origLength)%4&&(d=4-r%4);w.set((new Uint8Array(d)).buffer,b.outOffset+b.origLength);q=r+d}),l.slice(0,q)},Object.defineProperty(l,"__esModule",{value:!0}),l}({}).convert_streams},function(l,g){function v(a){if(!d){let a={R:2,L:1,D:4,C:16,U:32,T:8};d=new Map;for(let b in c){let e=0;c[b].split(",").forEach(c=>{let [f,g]=c.split("+");f=parseInt(f,36);g=g?parseInt(g,36):0;d.set(e+=
f,a[b]);for(c=g;c--;)d.set(++e,a[b])})}}return d.get(a)||32}function u(a,b){let c=[];for(let d=0;d<b.length;d++){let e=b.codePointAt(d);65535<e&&d++;c.push(l.U.codeToGlyph(a,e))}if(a=a.GSUB){let {lookupList:d,featureList:f}=a,g,h=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,k=[];f.forEach(a=>{if(h.test(a.tag))for(let h=0;h<a.tab.length;h++){if(k[a.tab[h]])continue;k[a.tab[h]]=!0;let m=d[a.tab[h]],n=/^(isol|init|fina|medi)$/.test(a.tag);if(n&&!g){{var f=b;let a=new Uint8Array(f.length),
c=32,d=1,e=-1;for(let b=0;b<f.length;b++){let g=f.codePointAt(b),h=v(g)|0,k=1;h&8||(c&21?h&22?(k=3,1!==d&&3!==d||a[e]++):h&33&&(2===d||4===d)&&a[e]--:c&34&&(2===d||4===d)&&a[e]--,d=a[b]=k,c=h,e=b,65535<g&&b++)}g=a}}for(f=0;f<c.length;f++)g&&n&&e[g[f]]!==a.tag||l.U._applySubs(c,f,m,d)}})}return c}function b(b){let c=Object.create(null),d={unitsPerEm:b.head.unitsPerEm,ascender:b.hhea.ascender,descender:b.hhea.descender,forEachGlyph(e,f,g,h){let k=0;const m=1/d.unitsPerEm*f;let r=0,p=-1;u(b,e).forEach((d,
n)=>{if(-1!==d){n=c[d];if(!n){const {cmds:e,crds:f}=l.U.glyphToPath(b,d);n="";var t=0;for(let b=0,c=e.length;b<c;b++){var q=a[e[b]];n+=e[b];for(var w=1;w<=q;w++)n+=(1<w?",":"")+f[t++]}let g;if(f.length){t=q=Infinity;w=g=-Infinity;for(let a=0,b=f.length;a<b;a+=2){let b=f[a],c=f[a+1];b<t&&(t=b);c<q&&(q=c);b>w&&(w=b);c>g&&(g=c)}}else t=w=q=g=0;n=c[d]={index:d,advanceWidth:b.hmtx.aWidth[d],xMin:t,yMin:q,xMax:w,yMax:g,path:n,pathCommandCount:e.length}}-1!==p&&(k+=l.U.getPairAdjustment(b,p,d)*m);h.call(null,
n,k,r);n.advanceWidth&&(k+=n.advanceWidth*m);g&&(k+=g*f);p=d}r+=65535<e.codePointAt(r)?2:1});return k}};return d}let a={M:2,L:2,Q:4,C:6,Z:0},c={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",
L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},
d,e=[null,"isol","init","fina","medi"];return function(a){var c=new Uint8Array(a,0,4);c=l._bin.readASCII(c,0,4);if("wOFF"===c)a=g(a);else if("wOF2"===c)throw Error("woff2 fonts not supported");return b(l.parse(a)[0])}}],init(l,g,v){l=l();g=g();return v(l,g)}});let W={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:.0625,sdfExponent:9,textureWidth:2048},ta=new y.Color,ka=!1,X=Object.create(null),Y;P=N.defineWorkerModule({name:"Typesetter",
dependencies:[W,Z,function(l,g,v){function u(a,b){function c(){let d=b=>{console.error(`Failure loading font ${a}${a===f?"":"; trying fallback"}`,b);a!==f&&(a=f,c())};try{let c=new XMLHttpRequest;c.open("get",a,!0);c.responseType="arraybuffer";c.onload=function(){if(400<=c.status)d(Error(c.statusText));else if(0<c.status)try{let a=l(c.response);b(a)}catch(G){d(G)}};c.onerror=d;c.send()}catch(r){d(r)}}c()}function b(a,b){a||(a=f);let c=h[a];c?c.pending?c.pending.push(b):b(c):(h[a]={pending:[b]},u(a,
b=>{let c=h[a].pending;h[a]=b;c.forEach(a=>a(b))}))}function a({text:a="",font:h=f,fontSize:t=1,letterSpacing:n=0,lineHeight:r="normal",maxWidth:l=Infinity,direction:q,textAlign:u="left",textIndent:v=0,whiteSpace:y="normal",overflowWrap:C="normal",anchorX:E=0,anchorY:J=0,includeCaretPositions:P=!1,chunkedBoundsSize:B=8192,colorRanges:I=null},L,A=!1){let f=d(),m={fontLoad:0,typesetting:0};-1<a.indexOf("\r")&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),a=a.replace(/\r\n/g,
"\n").replace(/\r/g,"\n"));t=+t;n=+n;l=+l;r=r||"normal";v=+v;b(h,b=>{let h=isFinite(l),w=null,x=null,G=null,D=null,F=null,H=null,K=null,R=0,O=0,W="nowrap"!==y,{ascender:N,descender:Q,unitsPerEm:X}=b;m.fontLoad=d()-f;let va=d(),S=t/X;"normal"===r&&(r=(N-Q)/X);r*=t;let Y=(r-(N-Q)*S)/2,Z=-(N*S+Y),fa=Math.min(r,(N-Q)*S),ha=(N+Q)/2*S-fa/2,ca=v,T=new e,da=[T];b.forEachGlyph(a,t,n,(b,c,d)=>{let f=a.charAt(d),g=b.advanceWidth*S;var m=T.count;"isEmpty"in b||(b.isWhitespace=!!f&&/\s/.test(f),b.canBreakAfter=
!!f&&p.test(f),b.isEmpty=b.xMin===b.xMax||b.yMin===b.yMax||k.test(f));b.isWhitespace||b.isEmpty||O++;if(W&&h&&!b.isWhitespace&&c+g+ca>l&&m){if(T.glyphAt(m-1).glyphObj.canBreakAfter){var r=new e;ca=-c}else for(;m--;)if(0===m&&"break-word"===C){r=new e;ca=-c;break}else if(T.glyphAt(m).glyphObj.canBreakAfter){r=T.splitAt(m+1);m=r.glyphAt(0).x;ca-=m;for(let a=r.count;a--;)r.glyphAt(a).x-=m;break}r&&(T.isSoftWrapped=!0,T=r,da.push(T),R=l)}r=T.glyphAt(T.count);r.glyphObj=b;r.x=c+ca;r.width=g;r.charIndex=
d;"\n"===f&&(T=new e,da.push(T),ca=-(c+g+n*t)+v)});da.forEach(a=>{for(let b=a.count;b--;){let {glyphObj:c,x:d,width:e}=a.glyphAt(b);if(!c.isWhitespace){a.width=d+e;a.width>R&&(R=a.width);break}}});let aa=0,ea=0;E&&("number"===typeof E?aa=-E:"string"===typeof E&&(aa=-R*("left"===E?0:"center"===E?.5:"right"===E?1:c(E))));if(J)if("number"===typeof J)ea=-J;else if("string"===typeof J){let a=da.length*r;ea="top"===J?0:"top-baseline"===J?-Z:"middle"===J?a/2:"bottom"===J?a:"bottom-baseline"===J?a-Y+Q*S:
c(J)*a}if(!A){let c=g.getEmbeddingLevels(a,q);w=new Uint16Array(O);x=new Float32Array(2*O);G={};H=[Infinity,Infinity,-Infinity,-Infinity];K=[];let d=Z;P&&(F=new Float32Array(3*a.length));I&&(D=new Uint8Array(3*O));let e=0,f=-1,h=-1,k,m;da.forEach((n,t)=>{let {count:l,width:p}=n;if(0<l){t=0;for(var q=l;q--&&n.glyphAt(q).glyphObj.isWhitespace;)t++;var v=q=0;if("center"===u)q=(R-p)/2;else if("right"===u)q=R-p;else if("justify"===u&&n.isSoftWrapped){v=0;for(var y=l-t;y--;)n.glyphAt(y).glyphObj.isWhitespace&&
v++;v=(R-p)/v}if(v||q){y=0;for(var A=0;A<l;A++){var z=n.glyphAt(A),C=z.glyphObj;z.x+=q+y;0!==v&&C.isWhitespace&&A<l-t&&(y+=v,z.width+=v)}}q=g.getReorderSegments(a,c,n.glyphAt(0).charIndex,n.glyphAt(n.count-1).charIndex);for(v=0;v<q.length;v++){let [a,b]=q[v];y=Infinity;A=-Infinity;for(z=0;z<l;z++)if(n.glyphAt(z).charIndex>=a){for(C=z;z<l;z++){var E=n.glyphAt(z);if(E.charIndex>b)break;z<l-t&&(y=Math.min(y,E.x),A=Math.max(A,E.x+E.width))}for(;C<z;C++)E=n.glyphAt(C),E.x=A-(E.x+E.width-y);break}}let r;
t=a=>r=a;for(q=0;q<l;q++){A=n.glyphAt(q);r=A.glyphObj;v=r.index;(y=c.levels[A.charIndex]&1)&&(z=g.getMirroredCharacter(a[A.charIndex]))&&b.forEachGlyph(z,0,0,t);if(P){({charIndex:z}=A);C=A.x+aa;E=A.x+A.width+aa;F[3*z]=y?E:C;F[3*z+1]=y?C:E;for(F[3*z+2]=d+ha+ea;1<z-f;)F[3*(f+1)]=F[3*f],F[3*(f+1)+1]=F[3*f+1],F[3*(f+1)+2]=F[3*f+2],f++;f=z}if(I)for({charIndex:y}=A;y>h;)h++,I.hasOwnProperty(h)&&(m=I[h]);if(!r.isWhitespace&&!r.isEmpty){y=e++;G[v]||(G[v]={path:r.path,pathBounds:[r.xMin,r.yMin,r.xMax,r.yMax]});
C=A.x+aa;E=d+ea;x[2*y]=C;x[2*y+1]=E;A=C+r.xMin*S;z=E+r.yMin*S;C+=r.xMax*S;E+=r.yMax*S;A<H[0]&&(H[0]=A);z<H[1]&&(H[1]=z);C>H[2]&&(H[2]=C);E>H[3]&&(H[3]=E);0===y%B&&(k={start:y,end:y,rect:[Infinity,Infinity,-Infinity,-Infinity]},K.push(k));k.end++;let a=k.rect;A<a[0]&&(a[0]=A);z<a[1]&&(a[1]=z);C>a[2]&&(a[2]=C);E>a[3]&&(a[3]=E);w[y]=v;I&&(v=3*y,D[v]=m>>16&255,D[v+1]=m>>8&255,D[v+2]=m&255)}}}d-=r})}m.typesetting=d()-va;L({glyphIds:w,glyphPositions:x,glyphData:G,caretPositions:F,caretHeight:fa,glyphColors:D,
chunkedBounds:K,fontSize:t,unitsPerEm:X,ascender:N*S,descender:Q*S,lineHeight:r,topBaseline:Z,blockBounds:[aa,ea-da.length*r,aa+R,ea],visibleBounds:H,timings:m})})}function c(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):NaN;return isNaN(a)?0:a/100}function d(){return(self.performance||Date).now()}function e(){this.data=[]}let {defaultFontURL:f}=v,h=Object.create(null),k=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,
p=/[\s\-\u007C\u00AD\u2010\u2012-\u2014\u2027\u2056\u2E17\u2E40]/,q=["glyphObj","x","width","charIndex"];e.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/q.length)},glyphAt(a){let b=e.flyweight;b.data=this.data;b.index=a;return b},splitAt(a){let b=new e;b.data=this.data.splice(a*q.length);return b}};e.flyweight=q.reduce((a,b,c,d)=>{Object.defineProperty(a,b,{get(){return this.data[this.index*q.length+c]},set(a){this.data[this.index*q.length+c]=a}});return a},{data:null,
index:0});return{typeset:a,measure:function(b,c){a(b,a=>{let [b,d,e,f]=a.blockBounds;c({width:e-b,height:f-d})},{metricsOnly:!0})},loadFont:b}},P["default"]],init(l,g,v,u){({defaultFontURL:l}=l);return v(g,u(),{defaultFontURL:l})}});let wa=function(){const l={};let g=0;return function(...v){const u="TroikaTextSDFGenerator_"+g++%4;let b=l[u];b||(b=l[u]={workerModule:N.defineWorkerModule({name:u,workerId:u,dependencies:[W,ra,qa],init(a,b,d){const {sdfExponent:c,sdfMargin:f}=a;return d(b,{sdfExponent:c,
sdfMargin:f})},getTransferables(a){return[a.textureData.buffer]}}),requests:0,idleTimer:null});b.requests++;clearTimeout(b.idleTimer);return b.workerModule(...v).then(a=>{0===--b.requests&&(b.idleTimer=setTimeout(()=>{N.terminateWorker(u)},2E3));return a})}}(),ua=N.defineWorkerModule({name:"Typesetter",dependencies:[P,N.ThenableWorkerModule],init(l,g){return function(v){const u=new g;l.typeset(v,u.resolve);return u}},getTransferables(l){const g=[l.glyphPositions.buffer,l.glyphIds.buffer];l.caretPositions&&
g.push(l.caretPositions.buffer);return g}}),oa=(()=>{function l(a){let b=u[a];b||(b=u[a]=(new y.PlaneBufferGeometry(1,1,a,a)).translate(.5,.5,0));return b}function g(a,b,d,e){const c=a.getAttribute(b);d?c&&c.array.length===d.length?(c.array.set(d),c.needsUpdate=!0):(a.setAttribute(b,new y.InstancedBufferAttribute(d,e)),delete a._maxInstanceCount,a.dispose()):c&&a.deleteAttribute(b)}function v(a,b){a[a.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=b}const u={};new y.Vector3;
class b extends y.InstancedBufferGeometry{constructor(){super();this.detail=1;this.curveRadius=0;this.groups=[{start:0,count:Infinity,materialIndex:0},{start:0,count:Infinity,materialIndex:1}];this.boundingSphere=new y.Sphere;this.boundingBox=new y.Box3}computeBoundingSphere(){}computeBoundingBox(){}set detail(a){if(a!==this._detail){this._detail=a;if("number"!==typeof a||1>a)a=1;let b=l(a);["position","normal","uv"].forEach(a=>{this.attributes[a]=b.attributes[a].clone()});this.setIndex(b.getIndex().clone())}}get detail(){return this._detail}set curveRadius(a){a!==
this._curveRadius&&(this._curveRadius=a,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(a,b,d,e,f){g(this,"aTroikaGlyphBounds",a,4);g(this,"aTroikaGlyphIndex",b,1);g(this,"aTroikaGlyphColor",f,3);this._blockBounds=d;this._chunkedBounds=e;v(this,b.length);this._updateBounds()}_updateBounds(){const a=this._blockBounds;if(a){const {curveRadius:c,boundingBox:f}=this;if(c){const {PI:e,floor:g,min:l,max:q,sin:u,cos:m}=Math;var b=e/2,d=2*e;const t=Math.abs(c),n=a[0]/t,r=a[2]/
t,v=g((n+b)/d)!==g((r+b)/d)?-t:l(u(n)*t,u(r)*t);b=g((n-b)/d)!==g((r-b)/d)?t:q(u(n)*t,u(r)*t);d=g((n+e)/d)!==g((r+e)/d)?2*t:q(t-m(n)*t,t-m(r)*t);f.min.set(v,a[1],0>c?-d:0);f.max.set(b,a[3],0>c?0:d)}else f.min.set(a[0],a[1],0),f.max.set(a[2],a[3],0);f.getBoundingSphere(this.boundingSphere)}}applyClipRect(a){let b=this.getAttribute("aTroikaGlyphIndex").count,d=this._chunkedBounds;if(d)for(let c=d.length;c--;){b=d[c].end;let e=d[c].rect;if(e[1]<a.w&&e[3]>a.y&&e[0]<a.z&&e[2]>a.x)break}v(this,b)}}b.prototype.setAttribute||
(b.prototype.setAttribute=function(a,b){this.attributes[a]=b;return this});return b})();Z=(()=>{function l(a){return Array.isArray(a)?a[0]:a}const g=new y.MeshBasicMaterial({color:16777215,side:y.DoubleSide,transparent:!0}),v=new y.Matrix4,u=new y.Vector3,b=new y.Vector3,a=[],c=new y.Vector3;let d=()=>{const a=new y.Mesh(new y.PlaneBufferGeometry(1,1),g);d=()=>a;return a},e=()=>{const a=new y.Mesh(new y.PlaneBufferGeometry(1,1,32,1),g);e=()=>a;return a};const f={type:"syncstart"},h={type:"synccomplete"},
k="font fontSize letterSpacing lineHeight maxWidth overflowWrap text direction textAlign textIndent whiteSpace anchorX anchorY colorRanges sdfGlyphSize".split(" "),p=k.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class q extends y.Mesh{constructor(){super(new oa,null);this.text="";this.curveRadius=this.anchorY=this.anchorX=0;this.direction="auto";this.font=null;this.fontSize=.1;this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;
this.overflowWrap="normal";this.textAlign="left";this.textIndent=0;this.whiteSpace="normal";this.colorRanges=this.color=this.material=null;this.outlineColor=this.outlineWidth=0;this.outlineOpacity=1;this.strokeWidth=this.outlineOffsetY=this.outlineOffsetX=this.outlineBlur=0;this.strokeColor=8421504;this.fillOpacity=this.strokeOpacity=1;this.depthOffset=0;this.clipRect=null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.sdfGlyphSize=null;this.debugSDF=!1}sync(a){this._needsSync&&(this._needsSync=
!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(a):(this._isSyncing=!0,this.dispatchEvent(f),ha({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,
sdfGlyphSize:this.sdfGlyphSize},b=>{this._isSyncing=!1;this._textRenderInfo=b;this.geometry.updateGlyphs(b.glyphBounds,b.glyphAtlasIndices,b.blockBounds,b.chunkedBounds,b.glyphColors);const c=this._queuedSyncs;c&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{c.forEach(a=>a&&a())}));this.dispatchEvent(h);a&&a()})))}onBeforeRender(a,b,c,d,e,f){this.sync();e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||
null}get material(){let a=this._derivedMaterial;const b=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=g.clone());a&&a.baseMaterial===b||(a=this._derivedMaterial=ma(b),b.addEventListener("dispose",function r(){b.removeEventListener("dispose",r);a.dispose()}));if(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let b=a._outlineMtl;b||(b=a._outlineMtl=Object.create(a,{id:{value:a.id+.1}}),b.isTextOutlineMaterial=!0,b.depthWrite=!1,b.map=null,a.addEventListener("dispose",
function G(){a.removeEventListener("dispose",G);b.dispose()}));return[b,a]}return a}set material(a){a&&a.isTroikaTextMaterial?(this._derivedMaterial=a,this._baseMaterial=a.baseMaterial):this._baseMaterial=a}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(a){this.geometry.detail=a}get curveRadius(){return this.geometry.curveRadius}set curveRadius(a){this.geometry.curveRadius=a}get customDepthMaterial(){return l(this.material).getDepthMaterial()}get customDistanceMaterial(){return l(this.material).getDistanceMaterial()}_prepareForRender(a){var d=
a.isTextOutlineMaterial,e=a.uniforms,f=this.textRenderInfo;if(f){const {sdfTexture:a,blockBounds:b}=f;e.uTroikaSDFTexture.value=a;e.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height);e.uTroikaSDFGlyphSize.value=f.sdfGlyphSize;e.uTroikaSDFExponent.value=f.sdfExponent;e.uTroikaTotalBounds.value.fromArray(b);e.uTroikaUseGlyphColors.value=!d&&!!f.glyphColors;let c=f=0,h=0,k;let m=0,l=0;if(d){let {outlineWidth:a,outlineOffsetX:b,outlineOffsetY:d,outlineBlur:e,outlineOpacity:g}=this;f=this._parsePercent(a)||
0;c=Math.max(0,this._parsePercent(e)||0);k=g;m=this._parsePercent(b)||0;l=this._parsePercent(d)||0}else{if(h=Math.max(0,this._parsePercent(this.strokeWidth)||0)){var g=this.strokeColor;e.uTroikaStrokeColor.value.set(null==g?8421504:g);g=this.strokeOpacity;null==g&&(g=1)}k=this.fillOpacity}e.uTroikaDistanceOffset.value=f;e.uTroikaPositionOffset.value.set(m,l);e.uTroikaBlurRadius.value=c;e.uTroikaStrokeWidth.value=h;e.uTroikaStrokeOpacity.value=g;e.uTroikaFillOpacity.value=null==k?1:k;e.uTroikaCurveRadius.value=
this.curveRadius||0;(f=this.clipRect)&&Array.isArray(f)&&4===f.length?e.uTroikaClipRect.value.fromArray(f):(f=100*(this.fontSize||.1),e.uTroikaClipRect.value.set(b[0]-f,b[1]-f,b[2]+f,b[3]+f));this.geometry.applyClipRect(e.uTroikaClipRect.value)}e.uTroikaSDFDebug.value=!!this.debugSDF;a.polygonOffset=!!this.depthOffset;a.polygonOffsetFactor=a.polygonOffsetUnits=this.depthOffset||0;d=d?this.outlineColor||0:this.color;null==d?delete a.color:(f=a.hasOwnProperty("color")?a.color:a.color=new y.Color,(d!==
f._input||"object"===typeof d)&&f.set(f._input=d));d=this.orientation||"+x+y";if(d!==a._orientation){e=e.uTroikaOrient.value;d=d.replace(/[^-+xyz]/g,"");if(f="+x+y"!==d&&d.match(/^([-+])([xyz])([-+])([xyz])$/)){let [,a,d,g,h]=f;u.set(0,0,0)[d]="-"===a?1:-1;b.set(0,0,0)[h]="-"===g?-1:1;v.lookAt(c,u.cross(b),b);e.setFromMatrix4(v)}else e.identity();a._orientation=d}}_parsePercent(a){"string"===typeof a&&(a=(a=a.match(/^(-?[\d.]+)%$/))?parseFloat(a[1]):NaN,a=(isNaN(a)?0:a/100)*this.fontSize);return a}localPositionToTextCoords(a,
b=new y.Vector2){b.copy(a);const c=this.curveRadius;c&&(b.x=Math.atan2(a.x,Math.abs(c)-Math.abs(a.z))*Math.abs(c));return b}worldPositionToTextCoords(a,b=new y.Vector2){u.copy(a);return this.localPositionToTextCoords(this.worldToLocal(u),b)}raycast(b,c){const {textRenderInfo:f,curveRadius:g}=this;if(f){const h=f.blockBounds,k=g?e():d(),l=k.geometry,{position:m,uv:n}=l.attributes;for(let a=0;a<n.count;a++){let b=h[0]+n.getX(a)*(h[2]-h[0]);const c=h[1]+n.getY(a)*(h[3]-h[1]);let d=0;g&&(d=g-Math.cos(b/
g)*g,b=Math.sin(b/g)*g);m.setXYZ(a,b,c,d)}l.boundingSphere=this.geometry.boundingSphere;l.boundingBox=this.geometry.boundingBox;k.matrixWorld=this.matrixWorld;k.material.side=this.material.side;a.length=0;k.raycast(b,a);for(b=0;b<a.length;b++)a[b].object=this,c.push(a[b])}}copy(a){const b=this.geometry;super.copy(a);this.geometry=b;p.forEach(b=>{this[b]=a[b]});return this}clone(){return(new this.constructor).copy(this)}}k.forEach(a=>{const b="_private_"+a;Object.defineProperty(q.prototype,a,{get(){return this[b]},
set(a){a!==this[b]&&(this[b]=a,this._needsSync=!0)}})});let w=!1;Object.defineProperty(q.prototype,"anchor",{get(){return this._deprecated_anchor},set(a){this._deprecated_anchor=a;w||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),w=!0);Array.isArray(a)?(this.anchorX=`${100*(+a[0]||0)}%`,this.anchorY=`${100*(+a[1]||0)}%`):this.anchorX=this.anchorY=0}});return q})();let pa=new WeakMap,na=new WeakMap;C.GlyphsGeometry=oa;C.Text=Z;C.configureTextBuilder=function(l){ka?
console.warn("configureTextBuilder called after first font request; will be ignored."):la(W,l)};C.createTextDerivedMaterial=ma;C.dumpSDFTextures=function(){Object.keys(X).forEach(l=>{let g=X[l],v=document.createElement("canvas"),{width:u,height:b,data:a}=g.sdfTexture.image;v.width=u;v.height=b;let c=new ImageData(new Uint8ClampedArray(a),u,b);v.getContext("2d").putImageData(c,0,0);console.log(l,g,v.toDataURL());console.log("%c.",`
      background: url(${v.toDataURL()});
      background-size: ${u}px ${b}px;
      color: transparent;
      font-size: 0;
      line-height: ${b}px;
      padding-left: ${u}px;
    `)})};C.getCaretAtPoint=function(l,g,v){let u=null,{caretHeight:b}=l;l=xa(l);let a=Infinity;l.forEach((c,d)=>{Math.abs(v-(d+b/2))<Math.abs(v-(a+b/2))&&(a=d)});l.get(a).forEach(a=>{if(!u||Math.abs(g-a.x)<Math.abs(g-u.x))u=a});return u};C.getSelectionRects=function(l,g,v){var u;if(l){if((u=pa.get(l))&&u.start===g&&u.end===v)return u.rects;let {caretPositions:f,caretHeight:h}=l;v<g&&(u=g,g=v,v=u);g=Math.max(g,0);v=Math.min(v,f.length+1);u=[];var b=null;for(var a=g;a<v;a++){var c=f[3*a],d=f[3*a+1],
e=Math.min(c,d);c=Math.max(c,d);d=f[3*a+2];if(!b||d!==b.bottom||e>b.right||c<b.left)b={left:Infinity,right:-Infinity,bottom:d,top:d+h},u.push(b);b.left=Math.min(e,b.left);b.right=Math.max(c,b.right)}u.sort((a,b)=>b.bottom-a.bottom||a.left-b.left);for(b=u.length-1;0<b--;)a=u[b],e=u[b+1],a.bottom===e.bottom&&a.left<=e.right&&a.right>=e.left&&(e.left=Math.min(e.left,a.left),e.right=Math.max(e.right,a.right),u.splice(b,1));pa.set(l,{start:g,end:v,rects:u})}return u};C.preloadFont=function({font:l,characters:g,
sdfGlyphSize:v},u){g=Array.isArray(g)?g.join("\n"):""+g;ha({font:l,sdfGlyphSize:v,text:g},u)};C.typesetterWorkerModule=P;Object.defineProperty(C,"__esModule",{value:!0})})
