{"ast":null,"code":"import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Object3D, Raycaster, Vector3, Quaternion, Euler, Matrix4, Color, MeshBasicMaterial, DoubleSide, LineBasicMaterial, CylinderGeometry, BoxGeometry, BufferGeometry, Float32BufferAttribute, Mesh, Line, OctahedronGeometry, PlaneGeometry, TorusGeometry, SphereGeometry } from 'three';\n\nclass TransformControls extends Object3D {\n  // events\n  constructor(camera, domElement) {\n    super();\n\n    _defineProperty(this, \"isTransformControls\", true);\n\n    _defineProperty(this, \"visible\", false);\n\n    _defineProperty(this, \"domElement\", void 0);\n\n    _defineProperty(this, \"raycaster\", new Raycaster());\n\n    _defineProperty(this, \"gizmo\", void 0);\n\n    _defineProperty(this, \"plane\", void 0);\n\n    _defineProperty(this, \"tempVector\", new Vector3());\n\n    _defineProperty(this, \"tempVector2\", new Vector3());\n\n    _defineProperty(this, \"tempQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"unit\", {\n      X: new Vector3(1, 0, 0),\n      Y: new Vector3(0, 1, 0),\n      Z: new Vector3(0, 0, 1)\n    });\n\n    _defineProperty(this, \"pointStart\", new Vector3());\n\n    _defineProperty(this, \"pointEnd\", new Vector3());\n\n    _defineProperty(this, \"offset\", new Vector3());\n\n    _defineProperty(this, \"rotationAxis\", new Vector3());\n\n    _defineProperty(this, \"startNorm\", new Vector3());\n\n    _defineProperty(this, \"endNorm\", new Vector3());\n\n    _defineProperty(this, \"rotationAngle\", 0);\n\n    _defineProperty(this, \"cameraPosition\", new Vector3());\n\n    _defineProperty(this, \"cameraQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"cameraScale\", new Vector3());\n\n    _defineProperty(this, \"parentPosition\", new Vector3());\n\n    _defineProperty(this, \"parentQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"parentQuaternionInv\", new Quaternion());\n\n    _defineProperty(this, \"parentScale\", new Vector3());\n\n    _defineProperty(this, \"worldPositionStart\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternionStart\", new Quaternion());\n\n    _defineProperty(this, \"worldScaleStart\", new Vector3());\n\n    _defineProperty(this, \"worldPosition\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"worldQuaternionInv\", new Quaternion());\n\n    _defineProperty(this, \"worldScale\", new Vector3());\n\n    _defineProperty(this, \"eye\", new Vector3());\n\n    _defineProperty(this, \"positionStart\", new Vector3());\n\n    _defineProperty(this, \"quaternionStart\", new Quaternion());\n\n    _defineProperty(this, \"scaleStart\", new Vector3());\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"object\", void 0);\n\n    _defineProperty(this, \"enabled\", true);\n\n    _defineProperty(this, \"axis\", null);\n\n    _defineProperty(this, \"mode\", 'translate');\n\n    _defineProperty(this, \"translationSnap\", null);\n\n    _defineProperty(this, \"rotationSnap\", null);\n\n    _defineProperty(this, \"scaleSnap\", null);\n\n    _defineProperty(this, \"space\", 'world');\n\n    _defineProperty(this, \"size\", 1);\n\n    _defineProperty(this, \"dragging\", false);\n\n    _defineProperty(this, \"showX\", true);\n\n    _defineProperty(this, \"showY\", true);\n\n    _defineProperty(this, \"showZ\", true);\n\n    _defineProperty(this, \"changeEvent\", {\n      type: 'change'\n    });\n\n    _defineProperty(this, \"mouseDownEvent\", {\n      type: 'mouseDown'\n    });\n\n    _defineProperty(this, \"mouseUpEvent\", {\n      type: 'mouseUp',\n      mode: this.mode\n    });\n\n    _defineProperty(this, \"objectChangeEvent\", {\n      type: 'objectChange'\n    });\n\n    _defineProperty(this, \"intersectObjectWithRay\", (object, raycaster, includeInvisible) => {\n      const allIntersections = raycaster.intersectObject(object, true);\n\n      for (let i = 0; i < allIntersections.length; i++) {\n        if (allIntersections[i].object.visible || includeInvisible) {\n          return allIntersections[i];\n        }\n      }\n\n      return false;\n    });\n\n    _defineProperty(this, \"attach\", object => {\n      this.object = object;\n      this.visible = true;\n      return this;\n    });\n\n    _defineProperty(this, \"detach\", () => {\n      this.object = undefined;\n      this.visible = false;\n      this.axis = null;\n      return this;\n    });\n\n    _defineProperty(this, \"updateMatrixWorld\", () => {\n      if (this.object !== undefined) {\n        this.object.updateMatrixWorld();\n\n        if (this.object.parent === null) {\n          console.error('TransformControls: The attached 3D object must be a part of the scene graph.');\n        } else {\n          this.object.parent.matrixWorld.decompose(this.parentPosition, this.parentQuaternion, this.parentScale);\n        }\n\n        this.object.matrixWorld.decompose(this.worldPosition, this.worldQuaternion, this.worldScale);\n        this.parentQuaternionInv.copy(this.parentQuaternion).invert();\n        this.worldQuaternionInv.copy(this.worldQuaternion).invert();\n      }\n\n      this.camera.updateMatrixWorld();\n      this.camera.matrixWorld.decompose(this.cameraPosition, this.cameraQuaternion, this.cameraScale);\n      this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize();\n      super.updateMatrixWorld();\n    });\n\n    _defineProperty(this, \"pointerHover\", pointer => {\n      if (this.object === undefined || this.dragging === true) return;\n      this.raycaster.setFromCamera(pointer, this.camera);\n      const intersect = this.intersectObjectWithRay(this.gizmo.picker[this.mode], this.raycaster);\n\n      if (intersect) {\n        this.axis = intersect.object.name;\n      } else {\n        this.axis = null;\n      }\n    });\n\n    _defineProperty(this, \"pointerDown\", pointer => {\n      if (this.object === undefined || this.dragging === true || pointer.button !== 0) return;\n\n      if (this.axis !== null) {\n        this.raycaster.setFromCamera(pointer, this.camera);\n        const planeIntersect = this.intersectObjectWithRay(this.plane, this.raycaster, true);\n\n        if (planeIntersect) {\n          let space = this.space;\n\n          if (this.mode === 'scale') {\n            space = 'local';\n          } else if (this.axis === 'E' || this.axis === 'XYZE' || this.axis === 'XYZ') {\n            space = 'world';\n          }\n\n          if (space === 'local' && this.mode === 'rotate') {\n            const snap = this.rotationSnap;\n            if (this.axis === 'X' && snap) this.object.rotation.x = Math.round(this.object.rotation.x / snap) * snap;\n            if (this.axis === 'Y' && snap) this.object.rotation.y = Math.round(this.object.rotation.y / snap) * snap;\n            if (this.axis === 'Z' && snap) this.object.rotation.z = Math.round(this.object.rotation.z / snap) * snap;\n          }\n\n          this.object.updateMatrixWorld();\n\n          if (this.object.parent) {\n            this.object.parent.updateMatrixWorld();\n          }\n\n          this.positionStart.copy(this.object.position);\n          this.quaternionStart.copy(this.object.quaternion);\n          this.scaleStart.copy(this.object.scale);\n          this.object.matrixWorld.decompose(this.worldPositionStart, this.worldQuaternionStart, this.worldScaleStart);\n          this.pointStart.copy(planeIntersect.point).sub(this.worldPositionStart);\n        }\n\n        this.dragging = true;\n        this.mouseDownEvent.type = this.mode;\n        this.dispatchEvent(this.mouseDownEvent);\n      }\n    });\n\n    _defineProperty(this, \"pointerMove\", pointer => {\n      const axis = this.axis;\n      const mode = this.mode;\n      const object = this.object;\n      let space = this.space;\n\n      if (mode === 'scale') {\n        space = 'local';\n      } else if (axis === 'E' || axis === 'XYZE' || axis === 'XYZ') {\n        space = 'world';\n      }\n\n      if (object === undefined || axis === null || this.dragging === false || pointer.button !== -1) return;\n      this.raycaster.setFromCamera(pointer, this.camera);\n      const planeIntersect = this.intersectObjectWithRay(this.plane, this.raycaster, true);\n      if (!planeIntersect) return;\n      this.pointEnd.copy(planeIntersect.point).sub(this.worldPositionStart);\n\n      if (mode === 'translate') {\n        // Apply translate\n        this.offset.copy(this.pointEnd).sub(this.pointStart);\n\n        if (space === 'local' && axis !== 'XYZ') {\n          this.offset.applyQuaternion(this.worldQuaternionInv);\n        }\n\n        if (axis.indexOf('X') === -1) this.offset.x = 0;\n        if (axis.indexOf('Y') === -1) this.offset.y = 0;\n        if (axis.indexOf('Z') === -1) this.offset.z = 0;\n\n        if (space === 'local' && axis !== 'XYZ') {\n          this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale);\n        } else {\n          this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale);\n        }\n\n        object.position.copy(this.offset).add(this.positionStart); // Apply translation snap\n\n        if (this.translationSnap) {\n          if (space === 'local') {\n            object.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert());\n\n            if (axis.search('X') !== -1) {\n              object.position.x = Math.round(object.position.x / this.translationSnap) * this.translationSnap;\n            }\n\n            if (axis.search('Y') !== -1) {\n              object.position.y = Math.round(object.position.y / this.translationSnap) * this.translationSnap;\n            }\n\n            if (axis.search('Z') !== -1) {\n              object.position.z = Math.round(object.position.z / this.translationSnap) * this.translationSnap;\n            }\n\n            object.position.applyQuaternion(this.quaternionStart);\n          }\n\n          if (space === 'world') {\n            if (object.parent) {\n              object.position.add(this.tempVector.setFromMatrixPosition(object.parent.matrixWorld));\n            }\n\n            if (axis.search('X') !== -1) {\n              object.position.x = Math.round(object.position.x / this.translationSnap) * this.translationSnap;\n            }\n\n            if (axis.search('Y') !== -1) {\n              object.position.y = Math.round(object.position.y / this.translationSnap) * this.translationSnap;\n            }\n\n            if (axis.search('Z') !== -1) {\n              object.position.z = Math.round(object.position.z / this.translationSnap) * this.translationSnap;\n            }\n\n            if (object.parent) {\n              object.position.sub(this.tempVector.setFromMatrixPosition(object.parent.matrixWorld));\n            }\n          }\n        }\n      } else if (mode === 'scale') {\n        if (axis.search('XYZ') !== -1) {\n          let d = this.pointEnd.length() / this.pointStart.length();\n          if (this.pointEnd.dot(this.pointStart) < 0) d *= -1;\n          this.tempVector2.set(d, d, d);\n        } else {\n          this.tempVector.copy(this.pointStart);\n          this.tempVector2.copy(this.pointEnd);\n          this.tempVector.applyQuaternion(this.worldQuaternionInv);\n          this.tempVector2.applyQuaternion(this.worldQuaternionInv);\n          this.tempVector2.divide(this.tempVector);\n\n          if (axis.search('X') === -1) {\n            this.tempVector2.x = 1;\n          }\n\n          if (axis.search('Y') === -1) {\n            this.tempVector2.y = 1;\n          }\n\n          if (axis.search('Z') === -1) {\n            this.tempVector2.z = 1;\n          }\n        } // Apply scale\n\n\n        object.scale.copy(this.scaleStart).multiply(this.tempVector2);\n\n        if (this.scaleSnap && this.object) {\n          if (axis.search('X') !== -1) {\n            this.object.scale.x = Math.round(object.scale.x / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n          }\n\n          if (axis.search('Y') !== -1) {\n            object.scale.y = Math.round(object.scale.y / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n          }\n\n          if (axis.search('Z') !== -1) {\n            object.scale.z = Math.round(object.scale.z / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n          }\n        }\n      } else if (mode === 'rotate') {\n        this.offset.copy(this.pointEnd).sub(this.pointStart);\n        const ROTATION_SPEED = 20 / this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));\n\n        if (axis === 'E') {\n          this.rotationAxis.copy(this.eye);\n          this.rotationAngle = this.pointEnd.angleTo(this.pointStart);\n          this.startNorm.copy(this.pointStart).normalize();\n          this.endNorm.copy(this.pointEnd).normalize();\n          this.rotationAngle *= this.endNorm.cross(this.startNorm).dot(this.eye) < 0 ? 1 : -1;\n        } else if (axis === 'XYZE') {\n          this.rotationAxis.copy(this.offset).cross(this.eye).normalize();\n          this.rotationAngle = this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye)) * ROTATION_SPEED;\n        } else if (axis === 'X' || axis === 'Y' || axis === 'Z') {\n          this.rotationAxis.copy(this.unit[axis]);\n          this.tempVector.copy(this.unit[axis]);\n\n          if (space === 'local') {\n            this.tempVector.applyQuaternion(this.worldQuaternion);\n          }\n\n          this.rotationAngle = this.offset.dot(this.tempVector.cross(this.eye).normalize()) * ROTATION_SPEED;\n        } // Apply rotation snap\n\n\n        if (this.rotationSnap) {\n          this.rotationAngle = Math.round(this.rotationAngle / this.rotationSnap) * this.rotationSnap;\n        } // Apply rotate\n\n\n        if (space === 'local' && axis !== 'E' && axis !== 'XYZE') {\n          object.quaternion.copy(this.quaternionStart);\n          object.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis, this.rotationAngle)).normalize();\n        } else {\n          this.rotationAxis.applyQuaternion(this.parentQuaternionInv);\n          object.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis, this.rotationAngle));\n          object.quaternion.multiply(this.quaternionStart).normalize();\n        }\n      }\n\n      this.dispatchEvent(this.changeEvent);\n      this.dispatchEvent(this.objectChangeEvent);\n    });\n\n    _defineProperty(this, \"pointerUp\", pointer => {\n      if (pointer.button !== 0) return;\n\n      if (this.dragging && this.axis !== null) {\n        this.mouseUpEvent.mode = this.mode;\n        this.dispatchEvent(this.mouseUpEvent);\n      }\n\n      this.dragging = false;\n      this.axis = null;\n    });\n\n    _defineProperty(this, \"getPointer\", event => {\n      var _this$domElement$owne;\n\n      if (this.domElement && (_this$domElement$owne = this.domElement.ownerDocument) !== null && _this$domElement$owne !== void 0 && _this$domElement$owne.pointerLockElement) {\n        return {\n          x: 0,\n          y: 0,\n          button: event.button\n        };\n      } else {\n        var _this$domElement;\n\n        const pointer = event.changedTouches ? event.changedTouches[0] : event;\n        const rect = (_this$domElement = this.domElement) === null || _this$domElement === void 0 ? void 0 : _this$domElement.getBoundingClientRect();\n        return {\n          x: (pointer.clientX - rect.left) / rect.width * 2 - 1,\n          y: -(pointer.clientY - rect.top) / rect.height * 2 + 1,\n          button: event.button\n        };\n      }\n    });\n\n    _defineProperty(this, \"onPointerHover\", event => {\n      if (!this.enabled) return;\n\n      switch (event.pointerType) {\n        case 'mouse':\n        case 'pen':\n          this.pointerHover(this.getPointer(event));\n          break;\n      }\n    });\n\n    _defineProperty(this, \"onPointerDown\", event => {\n      var _this$domElement$owne2;\n\n      if (!this.enabled) return;\n      this.domElement.style.touchAction = 'none'; // disable touch scroll\n\n      (_this$domElement$owne2 = this.domElement.ownerDocument) === null || _this$domElement$owne2 === void 0 ? void 0 : _this$domElement$owne2.addEventListener('pointermove', this.onPointerMove);\n      this.pointerHover(this.getPointer(event));\n      this.pointerDown(this.getPointer(event));\n    });\n\n    _defineProperty(this, \"onPointerMove\", event => {\n      if (!this.enabled) return;\n      this.pointerMove(this.getPointer(event));\n    });\n\n    _defineProperty(this, \"onPointerUp\", event => {\n      var _this$domElement$owne3;\n\n      if (!this.enabled) return;\n      this.domElement.style.touchAction = '';\n      (_this$domElement$owne3 = this.domElement.ownerDocument) === null || _this$domElement$owne3 === void 0 ? void 0 : _this$domElement$owne3.removeEventListener('pointermove', this.onPointerMove);\n      this.pointerUp(this.getPointer(event));\n    });\n\n    _defineProperty(this, \"getMode\", () => this.mode);\n\n    _defineProperty(this, \"setMode\", mode => {\n      this.mode = mode;\n    });\n\n    _defineProperty(this, \"setTranslationSnap\", translationSnap => {\n      this.translationSnap = translationSnap;\n    });\n\n    _defineProperty(this, \"setRotationSnap\", rotationSnap => {\n      this.rotationSnap = rotationSnap;\n    });\n\n    _defineProperty(this, \"setScaleSnap\", scaleSnap => {\n      this.scaleSnap = scaleSnap;\n    });\n\n    _defineProperty(this, \"setSize\", size => {\n      this.size = size;\n    });\n\n    _defineProperty(this, \"setSpace\", space => {\n      this.space = space;\n    });\n\n    _defineProperty(this, \"update\", () => {\n      console.warn('THREE.TransformControls: update function has no more functionality and therefore has been deprecated.');\n    });\n\n    _defineProperty(this, \"dispose\", () => {\n      var _this$domElement$owne4, _this$domElement$owne5;\n\n      this.domElement.removeEventListener('pointerdown', this.onPointerDown);\n      this.domElement.removeEventListener('pointermove', this.onPointerHover);\n      (_this$domElement$owne4 = this.domElement.ownerDocument) === null || _this$domElement$owne4 === void 0 ? void 0 : _this$domElement$owne4.removeEventListener('pointermove', this.onPointerMove);\n      (_this$domElement$owne5 = this.domElement.ownerDocument) === null || _this$domElement$owne5 === void 0 ? void 0 : _this$domElement$owne5.removeEventListener('pointerup', this.onPointerUp);\n      this.traverse(child => {\n        const mesh = child;\n\n        if (mesh.geometry) {\n          mesh.geometry.dispose();\n        }\n\n        if (mesh.material) {\n          mesh.material.dispose();\n        }\n      });\n    });\n\n    if (domElement === undefined) {\n      console.warn('THREE.TransformControls: The second parameter \"domElement\" is now mandatory.');\n      this.domElement = document;\n    }\n\n    this.domElement = domElement;\n    this.camera = camera;\n    this.gizmo = new TransformControlsGizmo();\n    this.add(this.gizmo);\n    this.plane = new TransformControlsPlane();\n    this.add(this.plane); // Defined getter, setter and store for a property\n\n    const defineProperty = (propName, defaultValue) => {\n      let propValue = defaultValue;\n      Object.defineProperty(this, propName, {\n        get: function () {\n          return propValue !== undefined ? propValue : defaultValue;\n        },\n        set: function (value) {\n          if (propValue !== value) {\n            propValue = value;\n            this.plane[propName] = value;\n            this.gizmo[propName] = value;\n            this.dispatchEvent({\n              type: propName + '-changed',\n              value: value\n            });\n            this.dispatchEvent(this.changeEvent);\n          }\n        }\n      }); //@ts-ignore\n\n      this[propName] = defaultValue; // @ts-ignore\n\n      this.plane[propName] = defaultValue; // @ts-ignore\n\n      this.gizmo[propName] = defaultValue;\n    };\n\n    defineProperty('camera', this.camera);\n    defineProperty('object', this.object);\n    defineProperty('enabled', this.enabled);\n    defineProperty('axis', this.axis);\n    defineProperty('mode', this.mode);\n    defineProperty('translationSnap', this.translationSnap);\n    defineProperty('rotationSnap', this.rotationSnap);\n    defineProperty('scaleSnap', this.scaleSnap);\n    defineProperty('space', this.space);\n    defineProperty('size', this.size);\n    defineProperty('dragging', this.dragging);\n    defineProperty('showX', this.showX);\n    defineProperty('showY', this.showY);\n    defineProperty('showZ', this.showZ);\n    defineProperty('worldPosition', this.worldPosition);\n    defineProperty('worldPositionStart', this.worldPositionStart);\n    defineProperty('worldQuaternion', this.worldQuaternion);\n    defineProperty('worldQuaternionStart', this.worldQuaternionStart);\n    defineProperty('cameraPosition', this.cameraPosition);\n    defineProperty('cameraQuaternion', this.cameraQuaternion);\n    defineProperty('pointStart', this.pointStart);\n    defineProperty('pointEnd', this.pointEnd);\n    defineProperty('rotationAxis', this.rotationAxis);\n    defineProperty('rotationAngle', this.rotationAngle);\n    defineProperty('eye', this.eye);\n    {\n      domElement.addEventListener('pointerdown', this.onPointerDown);\n      domElement.addEventListener('pointermove', this.onPointerHover);\n      this.domElement.ownerDocument.addEventListener('pointerup', this.onPointerUp);\n    }\n  }\n\n}\n\nclass TransformControlsGizmo extends Object3D {\n  // these are set from parent class TransformControls\n  constructor() {\n    super();\n\n    _defineProperty(this, \"isTransformControlsGizmo\", true);\n\n    _defineProperty(this, \"type\", 'TransformControlsGizmo');\n\n    _defineProperty(this, \"tempVector\", new Vector3(0, 0, 0));\n\n    _defineProperty(this, \"tempEuler\", new Euler());\n\n    _defineProperty(this, \"alignVector\", new Vector3(0, 1, 0));\n\n    _defineProperty(this, \"zeroVector\", new Vector3(0, 0, 0));\n\n    _defineProperty(this, \"lookAtMatrix\", new Matrix4());\n\n    _defineProperty(this, \"tempQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"tempQuaternion2\", new Quaternion());\n\n    _defineProperty(this, \"identityQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"unitX\", new Vector3(1, 0, 0));\n\n    _defineProperty(this, \"unitY\", new Vector3(0, 1, 0));\n\n    _defineProperty(this, \"unitZ\", new Vector3(0, 0, 1));\n\n    _defineProperty(this, \"gizmo\", void 0);\n\n    _defineProperty(this, \"picker\", void 0);\n\n    _defineProperty(this, \"helper\", void 0);\n\n    _defineProperty(this, \"rotationAxis\", new Vector3());\n\n    _defineProperty(this, \"cameraPosition\", new Vector3());\n\n    _defineProperty(this, \"worldPositionStart\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternionStart\", new Quaternion());\n\n    _defineProperty(this, \"worldPosition\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"eye\", new Vector3());\n\n    _defineProperty(this, \"camera\", null);\n\n    _defineProperty(this, \"enabled\", true);\n\n    _defineProperty(this, \"axis\", null);\n\n    _defineProperty(this, \"mode\", 'translate');\n\n    _defineProperty(this, \"space\", 'world');\n\n    _defineProperty(this, \"size\", 1);\n\n    _defineProperty(this, \"dragging\", false);\n\n    _defineProperty(this, \"showX\", true);\n\n    _defineProperty(this, \"showY\", true);\n\n    _defineProperty(this, \"showZ\", true);\n\n    _defineProperty(this, \"updateMatrixWorld\", () => {\n      let space = this.space;\n\n      if (this.mode === 'scale') {\n        space = 'local'; // scale always oriented to local rotation\n      }\n\n      const quaternion = space === 'local' ? this.worldQuaternion : this.identityQuaternion; // Show only gizmos for current transform mode\n\n      this.gizmo['translate'].visible = this.mode === 'translate';\n      this.gizmo['rotate'].visible = this.mode === 'rotate';\n      this.gizmo['scale'].visible = this.mode === 'scale';\n      this.helper['translate'].visible = this.mode === 'translate';\n      this.helper['rotate'].visible = this.mode === 'rotate';\n      this.helper['scale'].visible = this.mode === 'scale';\n      let handles = [];\n      handles = handles.concat(this.picker[this.mode].children);\n      handles = handles.concat(this.gizmo[this.mode].children);\n      handles = handles.concat(this.helper[this.mode].children);\n\n      for (let i = 0; i < handles.length; i++) {\n        const handle = handles[i]; // hide aligned to camera\n\n        handle.visible = true;\n        handle.rotation.set(0, 0, 0);\n        handle.position.copy(this.worldPosition);\n        let factor;\n\n        if (this.camera.isOrthographicCamera) {\n          factor = (this.camera.top - this.camera.bottom) / this.camera.zoom;\n        } else {\n          factor = this.worldPosition.distanceTo(this.cameraPosition) * Math.min(1.9 * Math.tan(Math.PI * this.camera.fov / 360) / this.camera.zoom, 7);\n        }\n\n        handle.scale.set(1, 1, 1).multiplyScalar(factor * this.size / 7); // TODO: simplify helpers and consider decoupling from gizmo\n\n        if (handle.tag === 'helper') {\n          handle.visible = false;\n\n          if (handle.name === 'AXIS') {\n            handle.position.copy(this.worldPositionStart);\n            handle.visible = !!this.axis;\n\n            if (this.axis === 'X') {\n              this.tempQuaternion.setFromEuler(this.tempEuler.set(0, 0, 0));\n              handle.quaternion.copy(quaternion).multiply(this.tempQuaternion);\n\n              if (Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n                handle.visible = false;\n              }\n            }\n\n            if (this.axis === 'Y') {\n              this.tempQuaternion.setFromEuler(this.tempEuler.set(0, 0, Math.PI / 2));\n              handle.quaternion.copy(quaternion).multiply(this.tempQuaternion);\n\n              if (Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n                handle.visible = false;\n              }\n            }\n\n            if (this.axis === 'Z') {\n              this.tempQuaternion.setFromEuler(this.tempEuler.set(0, Math.PI / 2, 0));\n              handle.quaternion.copy(quaternion).multiply(this.tempQuaternion);\n\n              if (Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n                handle.visible = false;\n              }\n            }\n\n            if (this.axis === 'XYZE') {\n              this.tempQuaternion.setFromEuler(this.tempEuler.set(0, Math.PI / 2, 0));\n              this.alignVector.copy(this.rotationAxis);\n              handle.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector, this.alignVector, this.unitY));\n              handle.quaternion.multiply(this.tempQuaternion);\n              handle.visible = this.dragging;\n            }\n\n            if (this.axis === 'E') {\n              handle.visible = false;\n            }\n          } else if (handle.name === 'START') {\n            handle.position.copy(this.worldPositionStart);\n            handle.visible = this.dragging;\n          } else if (handle.name === 'END') {\n            handle.position.copy(this.worldPosition);\n            handle.visible = this.dragging;\n          } else if (handle.name === 'DELTA') {\n            handle.position.copy(this.worldPositionStart);\n            handle.quaternion.copy(this.worldQuaternionStart);\n            this.tempVector.set(1e-10, 1e-10, 1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1);\n            this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert());\n            handle.scale.copy(this.tempVector);\n            handle.visible = this.dragging;\n          } else {\n            handle.quaternion.copy(quaternion);\n\n            if (this.dragging) {\n              handle.position.copy(this.worldPositionStart);\n            } else {\n              handle.position.copy(this.worldPosition);\n            }\n\n            if (this.axis) {\n              handle.visible = this.axis.search(handle.name) !== -1;\n            }\n          } // If updating helper, skip rest of the loop\n\n\n          continue;\n        } // Align handles to current local or world rotation\n\n\n        handle.quaternion.copy(quaternion);\n\n        if (this.mode === 'translate' || this.mode === 'scale') {\n          // Hide translate and scale axis facing the camera\n          const AXIS_HIDE_TRESHOLD = 0.99;\n          const PLANE_HIDE_TRESHOLD = 0.2;\n          const AXIS_FLIP_TRESHOLD = 0.0;\n\n          if (handle.name === 'X' || handle.name === 'XYZX') {\n            if (Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'Y' || handle.name === 'XYZY') {\n            if (Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'Z' || handle.name === 'XYZZ') {\n            if (Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'XY') {\n            if (Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'YZ') {\n            if (Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'XZ') {\n            if (Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          } // Flip translate and scale axis ocluded behind another axis\n\n\n          if (handle.name.search('X') !== -1) {\n            if (this.alignVector.copy(this.unitX).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n              if (handle.tag === 'fwd') {\n                handle.visible = false;\n              } else {\n                handle.scale.x *= -1;\n              }\n            } else if (handle.tag === 'bwd') {\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name.search('Y') !== -1) {\n            if (this.alignVector.copy(this.unitY).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n              if (handle.tag === 'fwd') {\n                handle.visible = false;\n              } else {\n                handle.scale.y *= -1;\n              }\n            } else if (handle.tag === 'bwd') {\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name.search('Z') !== -1) {\n            if (this.alignVector.copy(this.unitZ).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n              if (handle.tag === 'fwd') {\n                handle.visible = false;\n              } else {\n                handle.scale.z *= -1;\n              }\n            } else if (handle.tag === 'bwd') {\n              handle.visible = false;\n            }\n          }\n        } else if (this.mode === 'rotate') {\n          // Align handles to current local or world rotation\n          this.tempQuaternion2.copy(quaternion);\n          this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(quaternion).invert());\n\n          if (handle.name.search('E') !== -1) {\n            handle.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye, this.zeroVector, this.unitY));\n          }\n\n          if (handle.name === 'X') {\n            this.tempQuaternion.setFromAxisAngle(this.unitX, Math.atan2(-this.alignVector.y, this.alignVector.z));\n            this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2, this.tempQuaternion);\n            handle.quaternion.copy(this.tempQuaternion);\n          }\n\n          if (handle.name === 'Y') {\n            this.tempQuaternion.setFromAxisAngle(this.unitY, Math.atan2(this.alignVector.x, this.alignVector.z));\n            this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2, this.tempQuaternion);\n            handle.quaternion.copy(this.tempQuaternion);\n          }\n\n          if (handle.name === 'Z') {\n            this.tempQuaternion.setFromAxisAngle(this.unitZ, Math.atan2(this.alignVector.y, this.alignVector.x));\n            this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2, this.tempQuaternion);\n            handle.quaternion.copy(this.tempQuaternion);\n          }\n        } // Hide disabled axes\n\n\n        handle.visible = handle.visible && (handle.name.indexOf('X') === -1 || this.showX);\n        handle.visible = handle.visible && (handle.name.indexOf('Y') === -1 || this.showY);\n        handle.visible = handle.visible && (handle.name.indexOf('Z') === -1 || this.showZ);\n        handle.visible = handle.visible && (handle.name.indexOf('E') === -1 || this.showX && this.showY && this.showZ); // highlight selected axis\n        //@ts-ignore\n\n        handle.material.tempOpacity = handle.material.tempOpacity || handle.material.opacity; //@ts-ignore\n\n        handle.material.tempColor = handle.material.tempColor || handle.material.color.clone(); //@ts-ignore\n\n        handle.material.color.copy(handle.material.tempColor); //@ts-ignore\n\n        handle.material.opacity = handle.material.tempOpacity;\n\n        if (!this.enabled) {\n          //@ts-ignore\n          handle.material.opacity *= 0.5; //@ts-ignore\n\n          handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n        } else if (this.axis) {\n          if (handle.name === this.axis) {\n            //@ts-ignore\n            handle.material.opacity = 1.0; //@ts-ignore\n\n            handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n          } else if (this.axis.split('').some(function (a) {\n            return handle.name === a;\n          })) {\n            //@ts-ignore\n            handle.material.opacity = 1.0; //@ts-ignore\n\n            handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n          } else {\n            //@ts-ignore\n            handle.material.opacity *= 0.25; //@ts-ignore\n\n            handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n          }\n        }\n      }\n\n      super.updateMatrixWorld();\n    });\n\n    const gizmoMaterial = new MeshBasicMaterial({\n      depthTest: false,\n      depthWrite: false,\n      transparent: true,\n      side: DoubleSide,\n      fog: false,\n      toneMapped: false\n    });\n    const gizmoLineMaterial = new LineBasicMaterial({\n      depthTest: false,\n      depthWrite: false,\n      transparent: true,\n      linewidth: 1,\n      fog: false,\n      toneMapped: false\n    }); // Make unique material for each axis/color\n\n    const matInvisible = gizmoMaterial.clone();\n    matInvisible.opacity = 0.15;\n    const matHelper = gizmoMaterial.clone();\n    matHelper.opacity = 0.33;\n    const matRed = gizmoMaterial.clone();\n    matRed.color.set(0xff0000);\n    const matGreen = gizmoMaterial.clone();\n    matGreen.color.set(0x00ff00);\n    const matBlue = gizmoMaterial.clone();\n    matBlue.color.set(0x0000ff);\n    const matWhiteTransparent = gizmoMaterial.clone();\n    matWhiteTransparent.opacity = 0.25;\n    const matYellowTransparent = matWhiteTransparent.clone();\n    matYellowTransparent.color.set(0xffff00);\n    const matCyanTransparent = matWhiteTransparent.clone();\n    matCyanTransparent.color.set(0x00ffff);\n    const matMagentaTransparent = matWhiteTransparent.clone();\n    matMagentaTransparent.color.set(0xff00ff);\n    const matYellow = gizmoMaterial.clone();\n    matYellow.color.set(0xffff00);\n    const matLineRed = gizmoLineMaterial.clone();\n    matLineRed.color.set(0xff0000);\n    const matLineGreen = gizmoLineMaterial.clone();\n    matLineGreen.color.set(0x00ff00);\n    const matLineBlue = gizmoLineMaterial.clone();\n    matLineBlue.color.set(0x0000ff);\n    const matLineCyan = gizmoLineMaterial.clone();\n    matLineCyan.color.set(0x00ffff);\n    const matLineMagenta = gizmoLineMaterial.clone();\n    matLineMagenta.color.set(0xff00ff);\n    const matLineYellow = gizmoLineMaterial.clone();\n    matLineYellow.color.set(0xffff00);\n    const matLineGray = gizmoLineMaterial.clone();\n    matLineGray.color.set(0x787878);\n    const matLineYellowTransparent = matLineYellow.clone();\n    matLineYellowTransparent.opacity = 0.25; // reusable geometry\n\n    const arrowGeometry = new CylinderGeometry(0, 0.05, 0.2, 12, 1, false);\n    const scaleHandleGeometry = new BoxGeometry(0.125, 0.125, 0.125);\n    const lineGeometry = new BufferGeometry();\n    lineGeometry.setAttribute('position', new Float32BufferAttribute([0, 0, 0, 1, 0, 0], 3));\n\n    const CircleGeometry = (radius, arc) => {\n      const geometry = new BufferGeometry();\n      const vertices = [];\n\n      for (let i = 0; i <= 64 * arc; ++i) {\n        vertices.push(0, Math.cos(i / 32 * Math.PI) * radius, Math.sin(i / 32 * Math.PI) * radius);\n      }\n\n      geometry.setAttribute('position', new Float32BufferAttribute(vertices, 3));\n      return geometry;\n    }; // Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n\n    const TranslateHelperGeometry = () => {\n      const geometry = new BufferGeometry();\n      geometry.setAttribute('position', new Float32BufferAttribute([0, 0, 0, 1, 1, 1], 3));\n      return geometry;\n    }; // Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n\n    const gizmoTranslate = {\n      X: [[new Mesh(arrowGeometry, matRed), [1, 0, 0], [0, 0, -Math.PI / 2], null, 'fwd'], [new Mesh(arrowGeometry, matRed), [1, 0, 0], [0, 0, Math.PI / 2], null, 'bwd'], [new Line(lineGeometry, matLineRed)]],\n      Y: [[new Mesh(arrowGeometry, matGreen), [0, 1, 0], null, null, 'fwd'], [new Mesh(arrowGeometry, matGreen), [0, 1, 0], [Math.PI, 0, 0], null, 'bwd'], [new Line(lineGeometry, matLineGreen), null, [0, 0, Math.PI / 2]]],\n      Z: [[new Mesh(arrowGeometry, matBlue), [0, 0, 1], [Math.PI / 2, 0, 0], null, 'fwd'], [new Mesh(arrowGeometry, matBlue), [0, 0, 1], [-Math.PI / 2, 0, 0], null, 'bwd'], [new Line(lineGeometry, matLineBlue), null, [0, -Math.PI / 2, 0]]],\n      XYZ: [[new Mesh(new OctahedronGeometry(0.1, 0), matWhiteTransparent.clone()), [0, 0, 0], [0, 0, 0]]],\n      XY: [[new Mesh(new PlaneGeometry(0.295, 0.295), matYellowTransparent.clone()), [0.15, 0.15, 0]], [new Line(lineGeometry, matLineYellow), [0.18, 0.3, 0], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineYellow), [0.3, 0.18, 0], [0, 0, Math.PI / 2], [0.125, 1, 1]]],\n      YZ: [[new Mesh(new PlaneGeometry(0.295, 0.295), matCyanTransparent.clone()), [0, 0.15, 0.15], [0, Math.PI / 2, 0]], [new Line(lineGeometry, matLineCyan), [0, 0.18, 0.3], [0, 0, Math.PI / 2], [0.125, 1, 1]], [new Line(lineGeometry, matLineCyan), [0, 0.3, 0.18], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n      XZ: [[new Mesh(new PlaneGeometry(0.295, 0.295), matMagentaTransparent.clone()), [0.15, 0, 0.15], [-Math.PI / 2, 0, 0]], [new Line(lineGeometry, matLineMagenta), [0.18, 0, 0.3], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineMagenta), [0.3, 0, 0.18], [0, -Math.PI / 2, 0], [0.125, 1, 1]]]\n    };\n    const pickerTranslate = {\n      X: [[new Mesh(new CylinderGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0.6, 0, 0], [0, 0, -Math.PI / 2]]],\n      Y: [[new Mesh(new CylinderGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0, 0.6, 0]]],\n      Z: [[new Mesh(new CylinderGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0, 0, 0.6], [Math.PI / 2, 0, 0]]],\n      XYZ: [[new Mesh(new OctahedronGeometry(0.2, 0), matInvisible)]],\n      XY: [[new Mesh(new PlaneGeometry(0.4, 0.4), matInvisible), [0.2, 0.2, 0]]],\n      YZ: [[new Mesh(new PlaneGeometry(0.4, 0.4), matInvisible), [0, 0.2, 0.2], [0, Math.PI / 2, 0]]],\n      XZ: [[new Mesh(new PlaneGeometry(0.4, 0.4), matInvisible), [0.2, 0, 0.2], [-Math.PI / 2, 0, 0]]]\n    };\n    const helperTranslate = {\n      START: [[new Mesh(new OctahedronGeometry(0.01, 2), matHelper), null, null, null, 'helper']],\n      END: [[new Mesh(new OctahedronGeometry(0.01, 2), matHelper), null, null, null, 'helper']],\n      DELTA: [[new Line(TranslateHelperGeometry(), matHelper), null, null, null, 'helper']],\n      X: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']],\n      Y: [[new Line(lineGeometry, matHelper.clone()), [0, -1e3, 0], [0, 0, Math.PI / 2], [1e6, 1, 1], 'helper']],\n      Z: [[new Line(lineGeometry, matHelper.clone()), [0, 0, -1e3], [0, -Math.PI / 2, 0], [1e6, 1, 1], 'helper']]\n    };\n    const gizmoRotate = {\n      X: [[new Line(CircleGeometry(1, 0.5), matLineRed)], [new Mesh(new OctahedronGeometry(0.04, 0), matRed), [0, 0, 0.99], null, [1, 3, 1]]],\n      Y: [[new Line(CircleGeometry(1, 0.5), matLineGreen), null, [0, 0, -Math.PI / 2]], [new Mesh(new OctahedronGeometry(0.04, 0), matGreen), [0, 0, 0.99], null, [3, 1, 1]]],\n      Z: [[new Line(CircleGeometry(1, 0.5), matLineBlue), null, [0, Math.PI / 2, 0]], [new Mesh(new OctahedronGeometry(0.04, 0), matBlue), [0.99, 0, 0], null, [1, 3, 1]]],\n      E: [[new Line(CircleGeometry(1.25, 1), matLineYellowTransparent), null, [0, Math.PI / 2, 0]], [new Mesh(new CylinderGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [1.17, 0, 0], [0, 0, -Math.PI / 2], [1, 1, 0.001]], [new Mesh(new CylinderGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [-1.17, 0, 0], [0, 0, Math.PI / 2], [1, 1, 0.001]], [new Mesh(new CylinderGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [0, -1.17, 0], [Math.PI, 0, 0], [1, 1, 0.001]], [new Mesh(new CylinderGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [0, 1.17, 0], [0, 0, 0], [1, 1, 0.001]]],\n      XYZE: [[new Line(CircleGeometry(1, 1), matLineGray), null, [0, Math.PI / 2, 0]]]\n    };\n    const helperRotate = {\n      AXIS: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']]\n    };\n    const pickerRotate = {\n      X: [[new Mesh(new TorusGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [0, -Math.PI / 2, -Math.PI / 2]]],\n      Y: [[new Mesh(new TorusGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [Math.PI / 2, 0, 0]]],\n      Z: [[new Mesh(new TorusGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [0, 0, -Math.PI / 2]]],\n      E: [[new Mesh(new TorusGeometry(1.25, 0.1, 2, 24), matInvisible)]],\n      XYZE: [[new Mesh(new SphereGeometry(0.7, 10, 8), matInvisible)]]\n    };\n    const gizmoScale = {\n      X: [[new Mesh(scaleHandleGeometry, matRed), [0.8, 0, 0], [0, 0, -Math.PI / 2]], [new Line(lineGeometry, matLineRed), null, null, [0.8, 1, 1]]],\n      Y: [[new Mesh(scaleHandleGeometry, matGreen), [0, 0.8, 0]], [new Line(lineGeometry, matLineGreen), null, [0, 0, Math.PI / 2], [0.8, 1, 1]]],\n      Z: [[new Mesh(scaleHandleGeometry, matBlue), [0, 0, 0.8], [Math.PI / 2, 0, 0]], [new Line(lineGeometry, matLineBlue), null, [0, -Math.PI / 2, 0], [0.8, 1, 1]]],\n      XY: [[new Mesh(scaleHandleGeometry, matYellowTransparent), [0.85, 0.85, 0], null, [2, 2, 0.2]], [new Line(lineGeometry, matLineYellow), [0.855, 0.98, 0], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineYellow), [0.98, 0.855, 0], [0, 0, Math.PI / 2], [0.125, 1, 1]]],\n      YZ: [[new Mesh(scaleHandleGeometry, matCyanTransparent), [0, 0.85, 0.85], null, [0.2, 2, 2]], [new Line(lineGeometry, matLineCyan), [0, 0.855, 0.98], [0, 0, Math.PI / 2], [0.125, 1, 1]], [new Line(lineGeometry, matLineCyan), [0, 0.98, 0.855], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n      XZ: [[new Mesh(scaleHandleGeometry, matMagentaTransparent), [0.85, 0, 0.85], null, [2, 0.2, 2]], [new Line(lineGeometry, matLineMagenta), [0.855, 0, 0.98], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineMagenta), [0.98, 0, 0.855], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n      XYZX: [[new Mesh(new BoxGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [1.1, 0, 0]]],\n      XYZY: [[new Mesh(new BoxGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [0, 1.1, 0]]],\n      XYZZ: [[new Mesh(new BoxGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [0, 0, 1.1]]]\n    };\n    const pickerScale = {\n      X: [[new Mesh(new CylinderGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0.5, 0, 0], [0, 0, -Math.PI / 2]]],\n      Y: [[new Mesh(new CylinderGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0, 0.5, 0]]],\n      Z: [[new Mesh(new CylinderGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0, 0, 0.5], [Math.PI / 2, 0, 0]]],\n      XY: [[new Mesh(scaleHandleGeometry, matInvisible), [0.85, 0.85, 0], null, [3, 3, 0.2]]],\n      YZ: [[new Mesh(scaleHandleGeometry, matInvisible), [0, 0.85, 0.85], null, [0.2, 3, 3]]],\n      XZ: [[new Mesh(scaleHandleGeometry, matInvisible), [0.85, 0, 0.85], null, [3, 0.2, 3]]],\n      XYZX: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.2), matInvisible), [1.1, 0, 0]]],\n      XYZY: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.2), matInvisible), [0, 1.1, 0]]],\n      XYZZ: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.2), matInvisible), [0, 0, 1.1]]]\n    };\n    const helperScale = {\n      X: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']],\n      Y: [[new Line(lineGeometry, matHelper.clone()), [0, -1e3, 0], [0, 0, Math.PI / 2], [1e6, 1, 1], 'helper']],\n      Z: [[new Line(lineGeometry, matHelper.clone()), [0, 0, -1e3], [0, -Math.PI / 2, 0], [1e6, 1, 1], 'helper']]\n    }; // Creates an Object3D with gizmos described in custom hierarchy definition.\n    // this is nearly impossible to Type so i'm leaving it\n\n    const setupGizmo = gizmoMap => {\n      const gizmo = new Object3D();\n\n      for (let name in gizmoMap) {\n        for (let i = gizmoMap[name].length; i--;) {\n          const object = gizmoMap[name][i][0].clone();\n          const position = gizmoMap[name][i][1];\n          const rotation = gizmoMap[name][i][2];\n          const scale = gizmoMap[name][i][3];\n          const tag = gizmoMap[name][i][4]; // name and tag properties are essential for picking and updating logic.\n\n          object.name = name; // @ts-ignore\n\n          object.tag = tag;\n\n          if (position) {\n            object.position.set(position[0], position[1], position[2]);\n          }\n\n          if (rotation) {\n            object.rotation.set(rotation[0], rotation[1], rotation[2]);\n          }\n\n          if (scale) {\n            object.scale.set(scale[0], scale[1], scale[2]);\n          }\n\n          object.updateMatrix();\n          const tempGeometry = object.geometry.clone();\n          tempGeometry.applyMatrix4(object.matrix);\n          object.geometry = tempGeometry;\n          object.renderOrder = Infinity;\n          object.position.set(0, 0, 0);\n          object.rotation.set(0, 0, 0);\n          object.scale.set(1, 1, 1);\n          gizmo.add(object);\n        }\n      }\n\n      return gizmo;\n    };\n\n    this.gizmo = {};\n    this.picker = {};\n    this.helper = {};\n    this.add(this.gizmo['translate'] = setupGizmo(gizmoTranslate));\n    this.add(this.gizmo['rotate'] = setupGizmo(gizmoRotate));\n    this.add(this.gizmo['scale'] = setupGizmo(gizmoScale));\n    this.add(this.picker['translate'] = setupGizmo(pickerTranslate));\n    this.add(this.picker['rotate'] = setupGizmo(pickerRotate));\n    this.add(this.picker['scale'] = setupGizmo(pickerScale));\n    this.add(this.helper['translate'] = setupGizmo(helperTranslate));\n    this.add(this.helper['rotate'] = setupGizmo(helperRotate));\n    this.add(this.helper['scale'] = setupGizmo(helperScale)); // Pickers should be hidden always\n\n    this.picker['translate'].visible = false;\n    this.picker['rotate'].visible = false;\n    this.picker['scale'].visible = false;\n  } // updateMatrixWorld will update transformations and appearance of individual handles\n\n\n}\n\nclass TransformControlsPlane extends Mesh {\n  constructor() {\n    super(new PlaneGeometry(100000, 100000, 2, 2), new MeshBasicMaterial({\n      visible: false,\n      wireframe: true,\n      side: DoubleSide,\n      transparent: true,\n      opacity: 0.1,\n      toneMapped: false\n    }));\n\n    _defineProperty(this, \"isTransformControlsPlane\", true);\n\n    _defineProperty(this, \"type\", 'TransformControlsPlane');\n\n    _defineProperty(this, \"unitX\", new Vector3(1, 0, 0));\n\n    _defineProperty(this, \"unitY\", new Vector3(0, 1, 0));\n\n    _defineProperty(this, \"unitZ\", new Vector3(0, 0, 1));\n\n    _defineProperty(this, \"tempVector\", new Vector3());\n\n    _defineProperty(this, \"dirVector\", new Vector3());\n\n    _defineProperty(this, \"alignVector\", new Vector3());\n\n    _defineProperty(this, \"tempMatrix\", new Matrix4());\n\n    _defineProperty(this, \"identityQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"cameraQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"worldPosition\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"eye\", new Vector3());\n\n    _defineProperty(this, \"axis\", null);\n\n    _defineProperty(this, \"mode\", 'translate');\n\n    _defineProperty(this, \"space\", 'world');\n\n    _defineProperty(this, \"updateMatrixWorld\", () => {\n      let space = this.space;\n      this.position.copy(this.worldPosition);\n      if (this.mode === 'scale') space = 'local'; // scale always oriented to local rotation\n\n      this.unitX.set(1, 0, 0).applyQuaternion(space === 'local' ? this.worldQuaternion : this.identityQuaternion);\n      this.unitY.set(0, 1, 0).applyQuaternion(space === 'local' ? this.worldQuaternion : this.identityQuaternion);\n      this.unitZ.set(0, 0, 1).applyQuaternion(space === 'local' ? this.worldQuaternion : this.identityQuaternion); // Align the plane for current transform mode, axis and space.\n\n      this.alignVector.copy(this.unitY);\n\n      switch (this.mode) {\n        case 'translate':\n        case 'scale':\n          switch (this.axis) {\n            case 'X':\n              this.alignVector.copy(this.eye).cross(this.unitX);\n              this.dirVector.copy(this.unitX).cross(this.alignVector);\n              break;\n\n            case 'Y':\n              this.alignVector.copy(this.eye).cross(this.unitY);\n              this.dirVector.copy(this.unitY).cross(this.alignVector);\n              break;\n\n            case 'Z':\n              this.alignVector.copy(this.eye).cross(this.unitZ);\n              this.dirVector.copy(this.unitZ).cross(this.alignVector);\n              break;\n\n            case 'XY':\n              this.dirVector.copy(this.unitZ);\n              break;\n\n            case 'YZ':\n              this.dirVector.copy(this.unitX);\n              break;\n\n            case 'XZ':\n              this.alignVector.copy(this.unitZ);\n              this.dirVector.copy(this.unitY);\n              break;\n\n            case 'XYZ':\n            case 'E':\n              this.dirVector.set(0, 0, 0);\n              break;\n          }\n\n          break;\n\n        case 'rotate':\n        default:\n          // special case for rotate\n          this.dirVector.set(0, 0, 0);\n      }\n\n      if (this.dirVector.length() === 0) {\n        // If in rotate mode, make the plane parallel to camera\n        this.quaternion.copy(this.cameraQuaternion);\n      } else {\n        this.tempMatrix.lookAt(this.tempVector.set(0, 0, 0), this.dirVector, this.alignVector);\n        this.quaternion.setFromRotationMatrix(this.tempMatrix);\n      }\n\n      super.updateMatrixWorld();\n    });\n  }\n\n}\n\nexport { TransformControls, TransformControlsGizmo, TransformControlsPlane };","map":{"version":3,"sources":["/Users/dominiclee/Desktop/ethprojs/metaportalpublic/node_modules/three-stdlib/controls/TransformControls.js"],"names":["_defineProperty","Object3D","Raycaster","Vector3","Quaternion","Euler","Matrix4","Color","MeshBasicMaterial","DoubleSide","LineBasicMaterial","CylinderGeometry","BoxGeometry","BufferGeometry","Float32BufferAttribute","Mesh","Line","OctahedronGeometry","PlaneGeometry","TorusGeometry","SphereGeometry","TransformControls","constructor","camera","domElement","X","Y","Z","type","mode","object","raycaster","includeInvisible","allIntersections","intersectObject","i","length","visible","undefined","axis","updateMatrixWorld","parent","console","error","matrixWorld","decompose","parentPosition","parentQuaternion","parentScale","worldPosition","worldQuaternion","worldScale","parentQuaternionInv","copy","invert","worldQuaternionInv","cameraPosition","cameraQuaternion","cameraScale","eye","sub","normalize","pointer","dragging","setFromCamera","intersect","intersectObjectWithRay","gizmo","picker","name","button","planeIntersect","plane","space","snap","rotationSnap","rotation","x","Math","round","y","z","positionStart","position","quaternionStart","quaternion","scaleStart","scale","worldPositionStart","worldQuaternionStart","worldScaleStart","pointStart","point","mouseDownEvent","dispatchEvent","pointEnd","offset","applyQuaternion","indexOf","divide","add","translationSnap","tempQuaternion","search","tempVector","setFromMatrixPosition","d","dot","tempVector2","set","multiply","scaleSnap","ROTATION_SPEED","distanceTo","rotationAxis","rotationAngle","angleTo","startNorm","endNorm","cross","unit","setFromAxisAngle","changeEvent","objectChangeEvent","mouseUpEvent","event","_this$domElement$owne","ownerDocument","pointerLockElement","_this$domElement","changedTouches","rect","getBoundingClientRect","clientX","left","width","clientY","top","height","enabled","pointerType","pointerHover","getPointer","_this$domElement$owne2","style","touchAction","addEventListener","onPointerMove","pointerDown","pointerMove","_this$domElement$owne3","removeEventListener","pointerUp","size","warn","_this$domElement$owne4","_this$domElement$owne5","onPointerDown","onPointerHover","onPointerUp","traverse","child","mesh","geometry","dispose","material","document","TransformControlsGizmo","TransformControlsPlane","defineProperty","propName","defaultValue","propValue","Object","get","value","showX","showY","showZ","identityQuaternion","helper","handles","concat","children","handle","factor","isOrthographicCamera","bottom","zoom","min","tan","PI","fov","multiplyScalar","tag","setFromEuler","tempEuler","abs","alignVector","unitX","unitY","unitZ","setFromRotationMatrix","lookAtMatrix","lookAt","zeroVector","clone","AXIS_HIDE_TRESHOLD","PLANE_HIDE_TRESHOLD","AXIS_FLIP_TRESHOLD","tempQuaternion2","atan2","multiplyQuaternions","tempOpacity","opacity","tempColor","color","lerp","split","some","a","gizmoMaterial","depthTest","depthWrite","transparent","side","fog","toneMapped","gizmoLineMaterial","linewidth","matInvisible","matHelper","matRed","matGreen","matBlue","matWhiteTransparent","matYellowTransparent","matCyanTransparent","matMagentaTransparent","matYellow","matLineRed","matLineGreen","matLineBlue","matLineCyan","matLineMagenta","matLineYellow","matLineGray","matLineYellowTransparent","arrowGeometry","scaleHandleGeometry","lineGeometry","setAttribute","CircleGeometry","radius","arc","vertices","push","cos","sin","TranslateHelperGeometry","gizmoTranslate","XYZ","XY","YZ","XZ","pickerTranslate","helperTranslate","START","END","DELTA","gizmoRotate","E","XYZE","helperRotate","AXIS","pickerRotate","gizmoScale","XYZX","XYZY","XYZZ","pickerScale","helperScale","setupGizmo","gizmoMap","updateMatrix","tempGeometry","applyMatrix4","matrix","renderOrder","Infinity","wireframe","dirVector","tempMatrix"],"mappings":"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","sourcesContent":["import _defineProperty from '@babel/runtime/helpers/esm/defineProperty';\nimport { Object3D, Raycaster, Vector3, Quaternion, Euler, Matrix4, Color, MeshBasicMaterial, DoubleSide, LineBasicMaterial, CylinderGeometry, BoxGeometry, BufferGeometry, Float32BufferAttribute, Mesh, Line, OctahedronGeometry, PlaneGeometry, TorusGeometry, SphereGeometry } from 'three';\n\nclass TransformControls extends Object3D {\n  // events\n  constructor(camera, domElement) {\n    super();\n\n    _defineProperty(this, \"isTransformControls\", true);\n\n    _defineProperty(this, \"visible\", false);\n\n    _defineProperty(this, \"domElement\", void 0);\n\n    _defineProperty(this, \"raycaster\", new Raycaster());\n\n    _defineProperty(this, \"gizmo\", void 0);\n\n    _defineProperty(this, \"plane\", void 0);\n\n    _defineProperty(this, \"tempVector\", new Vector3());\n\n    _defineProperty(this, \"tempVector2\", new Vector3());\n\n    _defineProperty(this, \"tempQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"unit\", {\n      X: new Vector3(1, 0, 0),\n      Y: new Vector3(0, 1, 0),\n      Z: new Vector3(0, 0, 1)\n    });\n\n    _defineProperty(this, \"pointStart\", new Vector3());\n\n    _defineProperty(this, \"pointEnd\", new Vector3());\n\n    _defineProperty(this, \"offset\", new Vector3());\n\n    _defineProperty(this, \"rotationAxis\", new Vector3());\n\n    _defineProperty(this, \"startNorm\", new Vector3());\n\n    _defineProperty(this, \"endNorm\", new Vector3());\n\n    _defineProperty(this, \"rotationAngle\", 0);\n\n    _defineProperty(this, \"cameraPosition\", new Vector3());\n\n    _defineProperty(this, \"cameraQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"cameraScale\", new Vector3());\n\n    _defineProperty(this, \"parentPosition\", new Vector3());\n\n    _defineProperty(this, \"parentQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"parentQuaternionInv\", new Quaternion());\n\n    _defineProperty(this, \"parentScale\", new Vector3());\n\n    _defineProperty(this, \"worldPositionStart\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternionStart\", new Quaternion());\n\n    _defineProperty(this, \"worldScaleStart\", new Vector3());\n\n    _defineProperty(this, \"worldPosition\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"worldQuaternionInv\", new Quaternion());\n\n    _defineProperty(this, \"worldScale\", new Vector3());\n\n    _defineProperty(this, \"eye\", new Vector3());\n\n    _defineProperty(this, \"positionStart\", new Vector3());\n\n    _defineProperty(this, \"quaternionStart\", new Quaternion());\n\n    _defineProperty(this, \"scaleStart\", new Vector3());\n\n    _defineProperty(this, \"camera\", void 0);\n\n    _defineProperty(this, \"object\", void 0);\n\n    _defineProperty(this, \"enabled\", true);\n\n    _defineProperty(this, \"axis\", null);\n\n    _defineProperty(this, \"mode\", 'translate');\n\n    _defineProperty(this, \"translationSnap\", null);\n\n    _defineProperty(this, \"rotationSnap\", null);\n\n    _defineProperty(this, \"scaleSnap\", null);\n\n    _defineProperty(this, \"space\", 'world');\n\n    _defineProperty(this, \"size\", 1);\n\n    _defineProperty(this, \"dragging\", false);\n\n    _defineProperty(this, \"showX\", true);\n\n    _defineProperty(this, \"showY\", true);\n\n    _defineProperty(this, \"showZ\", true);\n\n    _defineProperty(this, \"changeEvent\", {\n      type: 'change'\n    });\n\n    _defineProperty(this, \"mouseDownEvent\", {\n      type: 'mouseDown'\n    });\n\n    _defineProperty(this, \"mouseUpEvent\", {\n      type: 'mouseUp',\n      mode: this.mode\n    });\n\n    _defineProperty(this, \"objectChangeEvent\", {\n      type: 'objectChange'\n    });\n\n    _defineProperty(this, \"intersectObjectWithRay\", (object, raycaster, includeInvisible) => {\n      const allIntersections = raycaster.intersectObject(object, true);\n\n      for (let i = 0; i < allIntersections.length; i++) {\n        if (allIntersections[i].object.visible || includeInvisible) {\n          return allIntersections[i];\n        }\n      }\n\n      return false;\n    });\n\n    _defineProperty(this, \"attach\", object => {\n      this.object = object;\n      this.visible = true;\n      return this;\n    });\n\n    _defineProperty(this, \"detach\", () => {\n      this.object = undefined;\n      this.visible = false;\n      this.axis = null;\n      return this;\n    });\n\n    _defineProperty(this, \"updateMatrixWorld\", () => {\n      if (this.object !== undefined) {\n        this.object.updateMatrixWorld();\n\n        if (this.object.parent === null) {\n          console.error('TransformControls: The attached 3D object must be a part of the scene graph.');\n        } else {\n          this.object.parent.matrixWorld.decompose(this.parentPosition, this.parentQuaternion, this.parentScale);\n        }\n\n        this.object.matrixWorld.decompose(this.worldPosition, this.worldQuaternion, this.worldScale);\n        this.parentQuaternionInv.copy(this.parentQuaternion).invert();\n        this.worldQuaternionInv.copy(this.worldQuaternion).invert();\n      }\n\n      this.camera.updateMatrixWorld();\n      this.camera.matrixWorld.decompose(this.cameraPosition, this.cameraQuaternion, this.cameraScale);\n      this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize();\n      super.updateMatrixWorld();\n    });\n\n    _defineProperty(this, \"pointerHover\", pointer => {\n      if (this.object === undefined || this.dragging === true) return;\n      this.raycaster.setFromCamera(pointer, this.camera);\n      const intersect = this.intersectObjectWithRay(this.gizmo.picker[this.mode], this.raycaster);\n\n      if (intersect) {\n        this.axis = intersect.object.name;\n      } else {\n        this.axis = null;\n      }\n    });\n\n    _defineProperty(this, \"pointerDown\", pointer => {\n      if (this.object === undefined || this.dragging === true || pointer.button !== 0) return;\n\n      if (this.axis !== null) {\n        this.raycaster.setFromCamera(pointer, this.camera);\n        const planeIntersect = this.intersectObjectWithRay(this.plane, this.raycaster, true);\n\n        if (planeIntersect) {\n          let space = this.space;\n\n          if (this.mode === 'scale') {\n            space = 'local';\n          } else if (this.axis === 'E' || this.axis === 'XYZE' || this.axis === 'XYZ') {\n            space = 'world';\n          }\n\n          if (space === 'local' && this.mode === 'rotate') {\n            const snap = this.rotationSnap;\n            if (this.axis === 'X' && snap) this.object.rotation.x = Math.round(this.object.rotation.x / snap) * snap;\n            if (this.axis === 'Y' && snap) this.object.rotation.y = Math.round(this.object.rotation.y / snap) * snap;\n            if (this.axis === 'Z' && snap) this.object.rotation.z = Math.round(this.object.rotation.z / snap) * snap;\n          }\n\n          this.object.updateMatrixWorld();\n\n          if (this.object.parent) {\n            this.object.parent.updateMatrixWorld();\n          }\n\n          this.positionStart.copy(this.object.position);\n          this.quaternionStart.copy(this.object.quaternion);\n          this.scaleStart.copy(this.object.scale);\n          this.object.matrixWorld.decompose(this.worldPositionStart, this.worldQuaternionStart, this.worldScaleStart);\n          this.pointStart.copy(planeIntersect.point).sub(this.worldPositionStart);\n        }\n\n        this.dragging = true;\n        this.mouseDownEvent.type = this.mode;\n        this.dispatchEvent(this.mouseDownEvent);\n      }\n    });\n\n    _defineProperty(this, \"pointerMove\", pointer => {\n      const axis = this.axis;\n      const mode = this.mode;\n      const object = this.object;\n      let space = this.space;\n\n      if (mode === 'scale') {\n        space = 'local';\n      } else if (axis === 'E' || axis === 'XYZE' || axis === 'XYZ') {\n        space = 'world';\n      }\n\n      if (object === undefined || axis === null || this.dragging === false || pointer.button !== -1) return;\n      this.raycaster.setFromCamera(pointer, this.camera);\n      const planeIntersect = this.intersectObjectWithRay(this.plane, this.raycaster, true);\n      if (!planeIntersect) return;\n      this.pointEnd.copy(planeIntersect.point).sub(this.worldPositionStart);\n\n      if (mode === 'translate') {\n        // Apply translate\n        this.offset.copy(this.pointEnd).sub(this.pointStart);\n\n        if (space === 'local' && axis !== 'XYZ') {\n          this.offset.applyQuaternion(this.worldQuaternionInv);\n        }\n\n        if (axis.indexOf('X') === -1) this.offset.x = 0;\n        if (axis.indexOf('Y') === -1) this.offset.y = 0;\n        if (axis.indexOf('Z') === -1) this.offset.z = 0;\n\n        if (space === 'local' && axis !== 'XYZ') {\n          this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale);\n        } else {\n          this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale);\n        }\n\n        object.position.copy(this.offset).add(this.positionStart); // Apply translation snap\n\n        if (this.translationSnap) {\n          if (space === 'local') {\n            object.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert());\n\n            if (axis.search('X') !== -1) {\n              object.position.x = Math.round(object.position.x / this.translationSnap) * this.translationSnap;\n            }\n\n            if (axis.search('Y') !== -1) {\n              object.position.y = Math.round(object.position.y / this.translationSnap) * this.translationSnap;\n            }\n\n            if (axis.search('Z') !== -1) {\n              object.position.z = Math.round(object.position.z / this.translationSnap) * this.translationSnap;\n            }\n\n            object.position.applyQuaternion(this.quaternionStart);\n          }\n\n          if (space === 'world') {\n            if (object.parent) {\n              object.position.add(this.tempVector.setFromMatrixPosition(object.parent.matrixWorld));\n            }\n\n            if (axis.search('X') !== -1) {\n              object.position.x = Math.round(object.position.x / this.translationSnap) * this.translationSnap;\n            }\n\n            if (axis.search('Y') !== -1) {\n              object.position.y = Math.round(object.position.y / this.translationSnap) * this.translationSnap;\n            }\n\n            if (axis.search('Z') !== -1) {\n              object.position.z = Math.round(object.position.z / this.translationSnap) * this.translationSnap;\n            }\n\n            if (object.parent) {\n              object.position.sub(this.tempVector.setFromMatrixPosition(object.parent.matrixWorld));\n            }\n          }\n        }\n      } else if (mode === 'scale') {\n        if (axis.search('XYZ') !== -1) {\n          let d = this.pointEnd.length() / this.pointStart.length();\n          if (this.pointEnd.dot(this.pointStart) < 0) d *= -1;\n          this.tempVector2.set(d, d, d);\n        } else {\n          this.tempVector.copy(this.pointStart);\n          this.tempVector2.copy(this.pointEnd);\n          this.tempVector.applyQuaternion(this.worldQuaternionInv);\n          this.tempVector2.applyQuaternion(this.worldQuaternionInv);\n          this.tempVector2.divide(this.tempVector);\n\n          if (axis.search('X') === -1) {\n            this.tempVector2.x = 1;\n          }\n\n          if (axis.search('Y') === -1) {\n            this.tempVector2.y = 1;\n          }\n\n          if (axis.search('Z') === -1) {\n            this.tempVector2.z = 1;\n          }\n        } // Apply scale\n\n\n        object.scale.copy(this.scaleStart).multiply(this.tempVector2);\n\n        if (this.scaleSnap && this.object) {\n          if (axis.search('X') !== -1) {\n            this.object.scale.x = Math.round(object.scale.x / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n          }\n\n          if (axis.search('Y') !== -1) {\n            object.scale.y = Math.round(object.scale.y / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n          }\n\n          if (axis.search('Z') !== -1) {\n            object.scale.z = Math.round(object.scale.z / this.scaleSnap) * this.scaleSnap || this.scaleSnap;\n          }\n        }\n      } else if (mode === 'rotate') {\n        this.offset.copy(this.pointEnd).sub(this.pointStart);\n        const ROTATION_SPEED = 20 / this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));\n\n        if (axis === 'E') {\n          this.rotationAxis.copy(this.eye);\n          this.rotationAngle = this.pointEnd.angleTo(this.pointStart);\n          this.startNorm.copy(this.pointStart).normalize();\n          this.endNorm.copy(this.pointEnd).normalize();\n          this.rotationAngle *= this.endNorm.cross(this.startNorm).dot(this.eye) < 0 ? 1 : -1;\n        } else if (axis === 'XYZE') {\n          this.rotationAxis.copy(this.offset).cross(this.eye).normalize();\n          this.rotationAngle = this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye)) * ROTATION_SPEED;\n        } else if (axis === 'X' || axis === 'Y' || axis === 'Z') {\n          this.rotationAxis.copy(this.unit[axis]);\n          this.tempVector.copy(this.unit[axis]);\n\n          if (space === 'local') {\n            this.tempVector.applyQuaternion(this.worldQuaternion);\n          }\n\n          this.rotationAngle = this.offset.dot(this.tempVector.cross(this.eye).normalize()) * ROTATION_SPEED;\n        } // Apply rotation snap\n\n\n        if (this.rotationSnap) {\n          this.rotationAngle = Math.round(this.rotationAngle / this.rotationSnap) * this.rotationSnap;\n        } // Apply rotate\n\n\n        if (space === 'local' && axis !== 'E' && axis !== 'XYZE') {\n          object.quaternion.copy(this.quaternionStart);\n          object.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis, this.rotationAngle)).normalize();\n        } else {\n          this.rotationAxis.applyQuaternion(this.parentQuaternionInv);\n          object.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis, this.rotationAngle));\n          object.quaternion.multiply(this.quaternionStart).normalize();\n        }\n      }\n\n      this.dispatchEvent(this.changeEvent);\n      this.dispatchEvent(this.objectChangeEvent);\n    });\n\n    _defineProperty(this, \"pointerUp\", pointer => {\n      if (pointer.button !== 0) return;\n\n      if (this.dragging && this.axis !== null) {\n        this.mouseUpEvent.mode = this.mode;\n        this.dispatchEvent(this.mouseUpEvent);\n      }\n\n      this.dragging = false;\n      this.axis = null;\n    });\n\n    _defineProperty(this, \"getPointer\", event => {\n      var _this$domElement$owne;\n\n      if (this.domElement && (_this$domElement$owne = this.domElement.ownerDocument) !== null && _this$domElement$owne !== void 0 && _this$domElement$owne.pointerLockElement) {\n        return {\n          x: 0,\n          y: 0,\n          button: event.button\n        };\n      } else {\n        var _this$domElement;\n\n        const pointer = event.changedTouches ? event.changedTouches[0] : event;\n        const rect = (_this$domElement = this.domElement) === null || _this$domElement === void 0 ? void 0 : _this$domElement.getBoundingClientRect();\n        return {\n          x: (pointer.clientX - rect.left) / rect.width * 2 - 1,\n          y: -(pointer.clientY - rect.top) / rect.height * 2 + 1,\n          button: event.button\n        };\n      }\n    });\n\n    _defineProperty(this, \"onPointerHover\", event => {\n      if (!this.enabled) return;\n\n      switch (event.pointerType) {\n        case 'mouse':\n        case 'pen':\n          this.pointerHover(this.getPointer(event));\n          break;\n      }\n    });\n\n    _defineProperty(this, \"onPointerDown\", event => {\n      var _this$domElement$owne2;\n\n      if (!this.enabled) return;\n      this.domElement.style.touchAction = 'none'; // disable touch scroll\n\n      (_this$domElement$owne2 = this.domElement.ownerDocument) === null || _this$domElement$owne2 === void 0 ? void 0 : _this$domElement$owne2.addEventListener('pointermove', this.onPointerMove);\n      this.pointerHover(this.getPointer(event));\n      this.pointerDown(this.getPointer(event));\n    });\n\n    _defineProperty(this, \"onPointerMove\", event => {\n      if (!this.enabled) return;\n      this.pointerMove(this.getPointer(event));\n    });\n\n    _defineProperty(this, \"onPointerUp\", event => {\n      var _this$domElement$owne3;\n\n      if (!this.enabled) return;\n      this.domElement.style.touchAction = '';\n      (_this$domElement$owne3 = this.domElement.ownerDocument) === null || _this$domElement$owne3 === void 0 ? void 0 : _this$domElement$owne3.removeEventListener('pointermove', this.onPointerMove);\n      this.pointerUp(this.getPointer(event));\n    });\n\n    _defineProperty(this, \"getMode\", () => this.mode);\n\n    _defineProperty(this, \"setMode\", mode => {\n      this.mode = mode;\n    });\n\n    _defineProperty(this, \"setTranslationSnap\", translationSnap => {\n      this.translationSnap = translationSnap;\n    });\n\n    _defineProperty(this, \"setRotationSnap\", rotationSnap => {\n      this.rotationSnap = rotationSnap;\n    });\n\n    _defineProperty(this, \"setScaleSnap\", scaleSnap => {\n      this.scaleSnap = scaleSnap;\n    });\n\n    _defineProperty(this, \"setSize\", size => {\n      this.size = size;\n    });\n\n    _defineProperty(this, \"setSpace\", space => {\n      this.space = space;\n    });\n\n    _defineProperty(this, \"update\", () => {\n      console.warn('THREE.TransformControls: update function has no more functionality and therefore has been deprecated.');\n    });\n\n    _defineProperty(this, \"dispose\", () => {\n      var _this$domElement$owne4, _this$domElement$owne5;\n\n      this.domElement.removeEventListener('pointerdown', this.onPointerDown);\n      this.domElement.removeEventListener('pointermove', this.onPointerHover);\n      (_this$domElement$owne4 = this.domElement.ownerDocument) === null || _this$domElement$owne4 === void 0 ? void 0 : _this$domElement$owne4.removeEventListener('pointermove', this.onPointerMove);\n      (_this$domElement$owne5 = this.domElement.ownerDocument) === null || _this$domElement$owne5 === void 0 ? void 0 : _this$domElement$owne5.removeEventListener('pointerup', this.onPointerUp);\n      this.traverse(child => {\n        const mesh = child;\n\n        if (mesh.geometry) {\n          mesh.geometry.dispose();\n        }\n\n        if (mesh.material) {\n          mesh.material.dispose();\n        }\n      });\n    });\n\n    if (domElement === undefined) {\n      console.warn('THREE.TransformControls: The second parameter \"domElement\" is now mandatory.');\n      this.domElement = document;\n    }\n\n    this.domElement = domElement;\n    this.camera = camera;\n    this.gizmo = new TransformControlsGizmo();\n    this.add(this.gizmo);\n    this.plane = new TransformControlsPlane();\n    this.add(this.plane); // Defined getter, setter and store for a property\n\n    const defineProperty = (propName, defaultValue) => {\n      let propValue = defaultValue;\n      Object.defineProperty(this, propName, {\n        get: function () {\n          return propValue !== undefined ? propValue : defaultValue;\n        },\n        set: function (value) {\n          if (propValue !== value) {\n            propValue = value;\n            this.plane[propName] = value;\n            this.gizmo[propName] = value;\n            this.dispatchEvent({\n              type: propName + '-changed',\n              value: value\n            });\n            this.dispatchEvent(this.changeEvent);\n          }\n        }\n      }); //@ts-ignore\n\n      this[propName] = defaultValue; // @ts-ignore\n\n      this.plane[propName] = defaultValue; // @ts-ignore\n\n      this.gizmo[propName] = defaultValue;\n    };\n\n    defineProperty('camera', this.camera);\n    defineProperty('object', this.object);\n    defineProperty('enabled', this.enabled);\n    defineProperty('axis', this.axis);\n    defineProperty('mode', this.mode);\n    defineProperty('translationSnap', this.translationSnap);\n    defineProperty('rotationSnap', this.rotationSnap);\n    defineProperty('scaleSnap', this.scaleSnap);\n    defineProperty('space', this.space);\n    defineProperty('size', this.size);\n    defineProperty('dragging', this.dragging);\n    defineProperty('showX', this.showX);\n    defineProperty('showY', this.showY);\n    defineProperty('showZ', this.showZ);\n    defineProperty('worldPosition', this.worldPosition);\n    defineProperty('worldPositionStart', this.worldPositionStart);\n    defineProperty('worldQuaternion', this.worldQuaternion);\n    defineProperty('worldQuaternionStart', this.worldQuaternionStart);\n    defineProperty('cameraPosition', this.cameraPosition);\n    defineProperty('cameraQuaternion', this.cameraQuaternion);\n    defineProperty('pointStart', this.pointStart);\n    defineProperty('pointEnd', this.pointEnd);\n    defineProperty('rotationAxis', this.rotationAxis);\n    defineProperty('rotationAngle', this.rotationAngle);\n    defineProperty('eye', this.eye);\n    {\n      domElement.addEventListener('pointerdown', this.onPointerDown);\n      domElement.addEventListener('pointermove', this.onPointerHover);\n      this.domElement.ownerDocument.addEventListener('pointerup', this.onPointerUp);\n    }\n  }\n\n}\n\nclass TransformControlsGizmo extends Object3D {\n  // these are set from parent class TransformControls\n  constructor() {\n    super();\n\n    _defineProperty(this, \"isTransformControlsGizmo\", true);\n\n    _defineProperty(this, \"type\", 'TransformControlsGizmo');\n\n    _defineProperty(this, \"tempVector\", new Vector3(0, 0, 0));\n\n    _defineProperty(this, \"tempEuler\", new Euler());\n\n    _defineProperty(this, \"alignVector\", new Vector3(0, 1, 0));\n\n    _defineProperty(this, \"zeroVector\", new Vector3(0, 0, 0));\n\n    _defineProperty(this, \"lookAtMatrix\", new Matrix4());\n\n    _defineProperty(this, \"tempQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"tempQuaternion2\", new Quaternion());\n\n    _defineProperty(this, \"identityQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"unitX\", new Vector3(1, 0, 0));\n\n    _defineProperty(this, \"unitY\", new Vector3(0, 1, 0));\n\n    _defineProperty(this, \"unitZ\", new Vector3(0, 0, 1));\n\n    _defineProperty(this, \"gizmo\", void 0);\n\n    _defineProperty(this, \"picker\", void 0);\n\n    _defineProperty(this, \"helper\", void 0);\n\n    _defineProperty(this, \"rotationAxis\", new Vector3());\n\n    _defineProperty(this, \"cameraPosition\", new Vector3());\n\n    _defineProperty(this, \"worldPositionStart\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternionStart\", new Quaternion());\n\n    _defineProperty(this, \"worldPosition\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"eye\", new Vector3());\n\n    _defineProperty(this, \"camera\", null);\n\n    _defineProperty(this, \"enabled\", true);\n\n    _defineProperty(this, \"axis\", null);\n\n    _defineProperty(this, \"mode\", 'translate');\n\n    _defineProperty(this, \"space\", 'world');\n\n    _defineProperty(this, \"size\", 1);\n\n    _defineProperty(this, \"dragging\", false);\n\n    _defineProperty(this, \"showX\", true);\n\n    _defineProperty(this, \"showY\", true);\n\n    _defineProperty(this, \"showZ\", true);\n\n    _defineProperty(this, \"updateMatrixWorld\", () => {\n      let space = this.space;\n\n      if (this.mode === 'scale') {\n        space = 'local'; // scale always oriented to local rotation\n      }\n\n      const quaternion = space === 'local' ? this.worldQuaternion : this.identityQuaternion; // Show only gizmos for current transform mode\n\n      this.gizmo['translate'].visible = this.mode === 'translate';\n      this.gizmo['rotate'].visible = this.mode === 'rotate';\n      this.gizmo['scale'].visible = this.mode === 'scale';\n      this.helper['translate'].visible = this.mode === 'translate';\n      this.helper['rotate'].visible = this.mode === 'rotate';\n      this.helper['scale'].visible = this.mode === 'scale';\n      let handles = [];\n      handles = handles.concat(this.picker[this.mode].children);\n      handles = handles.concat(this.gizmo[this.mode].children);\n      handles = handles.concat(this.helper[this.mode].children);\n\n      for (let i = 0; i < handles.length; i++) {\n        const handle = handles[i]; // hide aligned to camera\n\n        handle.visible = true;\n        handle.rotation.set(0, 0, 0);\n        handle.position.copy(this.worldPosition);\n        let factor;\n\n        if (this.camera.isOrthographicCamera) {\n          factor = (this.camera.top - this.camera.bottom) / this.camera.zoom;\n        } else {\n          factor = this.worldPosition.distanceTo(this.cameraPosition) * Math.min(1.9 * Math.tan(Math.PI * this.camera.fov / 360) / this.camera.zoom, 7);\n        }\n\n        handle.scale.set(1, 1, 1).multiplyScalar(factor * this.size / 7); // TODO: simplify helpers and consider decoupling from gizmo\n\n        if (handle.tag === 'helper') {\n          handle.visible = false;\n\n          if (handle.name === 'AXIS') {\n            handle.position.copy(this.worldPositionStart);\n            handle.visible = !!this.axis;\n\n            if (this.axis === 'X') {\n              this.tempQuaternion.setFromEuler(this.tempEuler.set(0, 0, 0));\n              handle.quaternion.copy(quaternion).multiply(this.tempQuaternion);\n\n              if (Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n                handle.visible = false;\n              }\n            }\n\n            if (this.axis === 'Y') {\n              this.tempQuaternion.setFromEuler(this.tempEuler.set(0, 0, Math.PI / 2));\n              handle.quaternion.copy(quaternion).multiply(this.tempQuaternion);\n\n              if (Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n                handle.visible = false;\n              }\n            }\n\n            if (this.axis === 'Z') {\n              this.tempQuaternion.setFromEuler(this.tempEuler.set(0, Math.PI / 2, 0));\n              handle.quaternion.copy(quaternion).multiply(this.tempQuaternion);\n\n              if (Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(quaternion).dot(this.eye)) > 0.9) {\n                handle.visible = false;\n              }\n            }\n\n            if (this.axis === 'XYZE') {\n              this.tempQuaternion.setFromEuler(this.tempEuler.set(0, Math.PI / 2, 0));\n              this.alignVector.copy(this.rotationAxis);\n              handle.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector, this.alignVector, this.unitY));\n              handle.quaternion.multiply(this.tempQuaternion);\n              handle.visible = this.dragging;\n            }\n\n            if (this.axis === 'E') {\n              handle.visible = false;\n            }\n          } else if (handle.name === 'START') {\n            handle.position.copy(this.worldPositionStart);\n            handle.visible = this.dragging;\n          } else if (handle.name === 'END') {\n            handle.position.copy(this.worldPosition);\n            handle.visible = this.dragging;\n          } else if (handle.name === 'DELTA') {\n            handle.position.copy(this.worldPositionStart);\n            handle.quaternion.copy(this.worldQuaternionStart);\n            this.tempVector.set(1e-10, 1e-10, 1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1);\n            this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert());\n            handle.scale.copy(this.tempVector);\n            handle.visible = this.dragging;\n          } else {\n            handle.quaternion.copy(quaternion);\n\n            if (this.dragging) {\n              handle.position.copy(this.worldPositionStart);\n            } else {\n              handle.position.copy(this.worldPosition);\n            }\n\n            if (this.axis) {\n              handle.visible = this.axis.search(handle.name) !== -1;\n            }\n          } // If updating helper, skip rest of the loop\n\n\n          continue;\n        } // Align handles to current local or world rotation\n\n\n        handle.quaternion.copy(quaternion);\n\n        if (this.mode === 'translate' || this.mode === 'scale') {\n          // Hide translate and scale axis facing the camera\n          const AXIS_HIDE_TRESHOLD = 0.99;\n          const PLANE_HIDE_TRESHOLD = 0.2;\n          const AXIS_FLIP_TRESHOLD = 0.0;\n\n          if (handle.name === 'X' || handle.name === 'XYZX') {\n            if (Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'Y' || handle.name === 'XYZY') {\n            if (Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'Z' || handle.name === 'XYZZ') {\n            if (Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(quaternion).dot(this.eye)) > AXIS_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'XY') {\n            if (Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'YZ') {\n            if (Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name === 'XZ') {\n            if (Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(quaternion).dot(this.eye)) < PLANE_HIDE_TRESHOLD) {\n              handle.scale.set(1e-10, 1e-10, 1e-10);\n              handle.visible = false;\n            }\n          } // Flip translate and scale axis ocluded behind another axis\n\n\n          if (handle.name.search('X') !== -1) {\n            if (this.alignVector.copy(this.unitX).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n              if (handle.tag === 'fwd') {\n                handle.visible = false;\n              } else {\n                handle.scale.x *= -1;\n              }\n            } else if (handle.tag === 'bwd') {\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name.search('Y') !== -1) {\n            if (this.alignVector.copy(this.unitY).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n              if (handle.tag === 'fwd') {\n                handle.visible = false;\n              } else {\n                handle.scale.y *= -1;\n              }\n            } else if (handle.tag === 'bwd') {\n              handle.visible = false;\n            }\n          }\n\n          if (handle.name.search('Z') !== -1) {\n            if (this.alignVector.copy(this.unitZ).applyQuaternion(quaternion).dot(this.eye) < AXIS_FLIP_TRESHOLD) {\n              if (handle.tag === 'fwd') {\n                handle.visible = false;\n              } else {\n                handle.scale.z *= -1;\n              }\n            } else if (handle.tag === 'bwd') {\n              handle.visible = false;\n            }\n          }\n        } else if (this.mode === 'rotate') {\n          // Align handles to current local or world rotation\n          this.tempQuaternion2.copy(quaternion);\n          this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(quaternion).invert());\n\n          if (handle.name.search('E') !== -1) {\n            handle.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye, this.zeroVector, this.unitY));\n          }\n\n          if (handle.name === 'X') {\n            this.tempQuaternion.setFromAxisAngle(this.unitX, Math.atan2(-this.alignVector.y, this.alignVector.z));\n            this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2, this.tempQuaternion);\n            handle.quaternion.copy(this.tempQuaternion);\n          }\n\n          if (handle.name === 'Y') {\n            this.tempQuaternion.setFromAxisAngle(this.unitY, Math.atan2(this.alignVector.x, this.alignVector.z));\n            this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2, this.tempQuaternion);\n            handle.quaternion.copy(this.tempQuaternion);\n          }\n\n          if (handle.name === 'Z') {\n            this.tempQuaternion.setFromAxisAngle(this.unitZ, Math.atan2(this.alignVector.y, this.alignVector.x));\n            this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2, this.tempQuaternion);\n            handle.quaternion.copy(this.tempQuaternion);\n          }\n        } // Hide disabled axes\n\n\n        handle.visible = handle.visible && (handle.name.indexOf('X') === -1 || this.showX);\n        handle.visible = handle.visible && (handle.name.indexOf('Y') === -1 || this.showY);\n        handle.visible = handle.visible && (handle.name.indexOf('Z') === -1 || this.showZ);\n        handle.visible = handle.visible && (handle.name.indexOf('E') === -1 || this.showX && this.showY && this.showZ); // highlight selected axis\n        //@ts-ignore\n\n        handle.material.tempOpacity = handle.material.tempOpacity || handle.material.opacity; //@ts-ignore\n\n        handle.material.tempColor = handle.material.tempColor || handle.material.color.clone(); //@ts-ignore\n\n        handle.material.color.copy(handle.material.tempColor); //@ts-ignore\n\n        handle.material.opacity = handle.material.tempOpacity;\n\n        if (!this.enabled) {\n          //@ts-ignore\n          handle.material.opacity *= 0.5; //@ts-ignore\n\n          handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n        } else if (this.axis) {\n          if (handle.name === this.axis) {\n            //@ts-ignore\n            handle.material.opacity = 1.0; //@ts-ignore\n\n            handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n          } else if (this.axis.split('').some(function (a) {\n            return handle.name === a;\n          })) {\n            //@ts-ignore\n            handle.material.opacity = 1.0; //@ts-ignore\n\n            handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n          } else {\n            //@ts-ignore\n            handle.material.opacity *= 0.25; //@ts-ignore\n\n            handle.material.color.lerp(new Color(1, 1, 1), 0.5);\n          }\n        }\n      }\n\n      super.updateMatrixWorld();\n    });\n\n    const gizmoMaterial = new MeshBasicMaterial({\n      depthTest: false,\n      depthWrite: false,\n      transparent: true,\n      side: DoubleSide,\n      fog: false,\n      toneMapped: false\n    });\n    const gizmoLineMaterial = new LineBasicMaterial({\n      depthTest: false,\n      depthWrite: false,\n      transparent: true,\n      linewidth: 1,\n      fog: false,\n      toneMapped: false\n    }); // Make unique material for each axis/color\n\n    const matInvisible = gizmoMaterial.clone();\n    matInvisible.opacity = 0.15;\n    const matHelper = gizmoMaterial.clone();\n    matHelper.opacity = 0.33;\n    const matRed = gizmoMaterial.clone();\n    matRed.color.set(0xff0000);\n    const matGreen = gizmoMaterial.clone();\n    matGreen.color.set(0x00ff00);\n    const matBlue = gizmoMaterial.clone();\n    matBlue.color.set(0x0000ff);\n    const matWhiteTransparent = gizmoMaterial.clone();\n    matWhiteTransparent.opacity = 0.25;\n    const matYellowTransparent = matWhiteTransparent.clone();\n    matYellowTransparent.color.set(0xffff00);\n    const matCyanTransparent = matWhiteTransparent.clone();\n    matCyanTransparent.color.set(0x00ffff);\n    const matMagentaTransparent = matWhiteTransparent.clone();\n    matMagentaTransparent.color.set(0xff00ff);\n    const matYellow = gizmoMaterial.clone();\n    matYellow.color.set(0xffff00);\n    const matLineRed = gizmoLineMaterial.clone();\n    matLineRed.color.set(0xff0000);\n    const matLineGreen = gizmoLineMaterial.clone();\n    matLineGreen.color.set(0x00ff00);\n    const matLineBlue = gizmoLineMaterial.clone();\n    matLineBlue.color.set(0x0000ff);\n    const matLineCyan = gizmoLineMaterial.clone();\n    matLineCyan.color.set(0x00ffff);\n    const matLineMagenta = gizmoLineMaterial.clone();\n    matLineMagenta.color.set(0xff00ff);\n    const matLineYellow = gizmoLineMaterial.clone();\n    matLineYellow.color.set(0xffff00);\n    const matLineGray = gizmoLineMaterial.clone();\n    matLineGray.color.set(0x787878);\n    const matLineYellowTransparent = matLineYellow.clone();\n    matLineYellowTransparent.opacity = 0.25; // reusable geometry\n\n    const arrowGeometry = new CylinderGeometry(0, 0.05, 0.2, 12, 1, false);\n    const scaleHandleGeometry = new BoxGeometry(0.125, 0.125, 0.125);\n    const lineGeometry = new BufferGeometry();\n    lineGeometry.setAttribute('position', new Float32BufferAttribute([0, 0, 0, 1, 0, 0], 3));\n\n    const CircleGeometry = (radius, arc) => {\n      const geometry = new BufferGeometry();\n      const vertices = [];\n\n      for (let i = 0; i <= 64 * arc; ++i) {\n        vertices.push(0, Math.cos(i / 32 * Math.PI) * radius, Math.sin(i / 32 * Math.PI) * radius);\n      }\n\n      geometry.setAttribute('position', new Float32BufferAttribute(vertices, 3));\n      return geometry;\n    }; // Special geometry for transform helper. If scaled with position vector it spans from [0,0,0] to position\n\n\n    const TranslateHelperGeometry = () => {\n      const geometry = new BufferGeometry();\n      geometry.setAttribute('position', new Float32BufferAttribute([0, 0, 0, 1, 1, 1], 3));\n      return geometry;\n    }; // Gizmo definitions - custom hierarchy definitions for setupGizmo() function\n\n\n    const gizmoTranslate = {\n      X: [[new Mesh(arrowGeometry, matRed), [1, 0, 0], [0, 0, -Math.PI / 2], null, 'fwd'], [new Mesh(arrowGeometry, matRed), [1, 0, 0], [0, 0, Math.PI / 2], null, 'bwd'], [new Line(lineGeometry, matLineRed)]],\n      Y: [[new Mesh(arrowGeometry, matGreen), [0, 1, 0], null, null, 'fwd'], [new Mesh(arrowGeometry, matGreen), [0, 1, 0], [Math.PI, 0, 0], null, 'bwd'], [new Line(lineGeometry, matLineGreen), null, [0, 0, Math.PI / 2]]],\n      Z: [[new Mesh(arrowGeometry, matBlue), [0, 0, 1], [Math.PI / 2, 0, 0], null, 'fwd'], [new Mesh(arrowGeometry, matBlue), [0, 0, 1], [-Math.PI / 2, 0, 0], null, 'bwd'], [new Line(lineGeometry, matLineBlue), null, [0, -Math.PI / 2, 0]]],\n      XYZ: [[new Mesh(new OctahedronGeometry(0.1, 0), matWhiteTransparent.clone()), [0, 0, 0], [0, 0, 0]]],\n      XY: [[new Mesh(new PlaneGeometry(0.295, 0.295), matYellowTransparent.clone()), [0.15, 0.15, 0]], [new Line(lineGeometry, matLineYellow), [0.18, 0.3, 0], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineYellow), [0.3, 0.18, 0], [0, 0, Math.PI / 2], [0.125, 1, 1]]],\n      YZ: [[new Mesh(new PlaneGeometry(0.295, 0.295), matCyanTransparent.clone()), [0, 0.15, 0.15], [0, Math.PI / 2, 0]], [new Line(lineGeometry, matLineCyan), [0, 0.18, 0.3], [0, 0, Math.PI / 2], [0.125, 1, 1]], [new Line(lineGeometry, matLineCyan), [0, 0.3, 0.18], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n      XZ: [[new Mesh(new PlaneGeometry(0.295, 0.295), matMagentaTransparent.clone()), [0.15, 0, 0.15], [-Math.PI / 2, 0, 0]], [new Line(lineGeometry, matLineMagenta), [0.18, 0, 0.3], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineMagenta), [0.3, 0, 0.18], [0, -Math.PI / 2, 0], [0.125, 1, 1]]]\n    };\n    const pickerTranslate = {\n      X: [[new Mesh(new CylinderGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0.6, 0, 0], [0, 0, -Math.PI / 2]]],\n      Y: [[new Mesh(new CylinderGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0, 0.6, 0]]],\n      Z: [[new Mesh(new CylinderGeometry(0.2, 0, 1, 4, 1, false), matInvisible), [0, 0, 0.6], [Math.PI / 2, 0, 0]]],\n      XYZ: [[new Mesh(new OctahedronGeometry(0.2, 0), matInvisible)]],\n      XY: [[new Mesh(new PlaneGeometry(0.4, 0.4), matInvisible), [0.2, 0.2, 0]]],\n      YZ: [[new Mesh(new PlaneGeometry(0.4, 0.4), matInvisible), [0, 0.2, 0.2], [0, Math.PI / 2, 0]]],\n      XZ: [[new Mesh(new PlaneGeometry(0.4, 0.4), matInvisible), [0.2, 0, 0.2], [-Math.PI / 2, 0, 0]]]\n    };\n    const helperTranslate = {\n      START: [[new Mesh(new OctahedronGeometry(0.01, 2), matHelper), null, null, null, 'helper']],\n      END: [[new Mesh(new OctahedronGeometry(0.01, 2), matHelper), null, null, null, 'helper']],\n      DELTA: [[new Line(TranslateHelperGeometry(), matHelper), null, null, null, 'helper']],\n      X: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']],\n      Y: [[new Line(lineGeometry, matHelper.clone()), [0, -1e3, 0], [0, 0, Math.PI / 2], [1e6, 1, 1], 'helper']],\n      Z: [[new Line(lineGeometry, matHelper.clone()), [0, 0, -1e3], [0, -Math.PI / 2, 0], [1e6, 1, 1], 'helper']]\n    };\n    const gizmoRotate = {\n      X: [[new Line(CircleGeometry(1, 0.5), matLineRed)], [new Mesh(new OctahedronGeometry(0.04, 0), matRed), [0, 0, 0.99], null, [1, 3, 1]]],\n      Y: [[new Line(CircleGeometry(1, 0.5), matLineGreen), null, [0, 0, -Math.PI / 2]], [new Mesh(new OctahedronGeometry(0.04, 0), matGreen), [0, 0, 0.99], null, [3, 1, 1]]],\n      Z: [[new Line(CircleGeometry(1, 0.5), matLineBlue), null, [0, Math.PI / 2, 0]], [new Mesh(new OctahedronGeometry(0.04, 0), matBlue), [0.99, 0, 0], null, [1, 3, 1]]],\n      E: [[new Line(CircleGeometry(1.25, 1), matLineYellowTransparent), null, [0, Math.PI / 2, 0]], [new Mesh(new CylinderGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [1.17, 0, 0], [0, 0, -Math.PI / 2], [1, 1, 0.001]], [new Mesh(new CylinderGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [-1.17, 0, 0], [0, 0, Math.PI / 2], [1, 1, 0.001]], [new Mesh(new CylinderGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [0, -1.17, 0], [Math.PI, 0, 0], [1, 1, 0.001]], [new Mesh(new CylinderGeometry(0.03, 0, 0.15, 4, 1, false), matLineYellowTransparent), [0, 1.17, 0], [0, 0, 0], [1, 1, 0.001]]],\n      XYZE: [[new Line(CircleGeometry(1, 1), matLineGray), null, [0, Math.PI / 2, 0]]]\n    };\n    const helperRotate = {\n      AXIS: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']]\n    };\n    const pickerRotate = {\n      X: [[new Mesh(new TorusGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [0, -Math.PI / 2, -Math.PI / 2]]],\n      Y: [[new Mesh(new TorusGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [Math.PI / 2, 0, 0]]],\n      Z: [[new Mesh(new TorusGeometry(1, 0.1, 4, 24), matInvisible), [0, 0, 0], [0, 0, -Math.PI / 2]]],\n      E: [[new Mesh(new TorusGeometry(1.25, 0.1, 2, 24), matInvisible)]],\n      XYZE: [[new Mesh(new SphereGeometry(0.7, 10, 8), matInvisible)]]\n    };\n    const gizmoScale = {\n      X: [[new Mesh(scaleHandleGeometry, matRed), [0.8, 0, 0], [0, 0, -Math.PI / 2]], [new Line(lineGeometry, matLineRed), null, null, [0.8, 1, 1]]],\n      Y: [[new Mesh(scaleHandleGeometry, matGreen), [0, 0.8, 0]], [new Line(lineGeometry, matLineGreen), null, [0, 0, Math.PI / 2], [0.8, 1, 1]]],\n      Z: [[new Mesh(scaleHandleGeometry, matBlue), [0, 0, 0.8], [Math.PI / 2, 0, 0]], [new Line(lineGeometry, matLineBlue), null, [0, -Math.PI / 2, 0], [0.8, 1, 1]]],\n      XY: [[new Mesh(scaleHandleGeometry, matYellowTransparent), [0.85, 0.85, 0], null, [2, 2, 0.2]], [new Line(lineGeometry, matLineYellow), [0.855, 0.98, 0], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineYellow), [0.98, 0.855, 0], [0, 0, Math.PI / 2], [0.125, 1, 1]]],\n      YZ: [[new Mesh(scaleHandleGeometry, matCyanTransparent), [0, 0.85, 0.85], null, [0.2, 2, 2]], [new Line(lineGeometry, matLineCyan), [0, 0.855, 0.98], [0, 0, Math.PI / 2], [0.125, 1, 1]], [new Line(lineGeometry, matLineCyan), [0, 0.98, 0.855], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n      XZ: [[new Mesh(scaleHandleGeometry, matMagentaTransparent), [0.85, 0, 0.85], null, [2, 0.2, 2]], [new Line(lineGeometry, matLineMagenta), [0.855, 0, 0.98], null, [0.125, 1, 1]], [new Line(lineGeometry, matLineMagenta), [0.98, 0, 0.855], [0, -Math.PI / 2, 0], [0.125, 1, 1]]],\n      XYZX: [[new Mesh(new BoxGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [1.1, 0, 0]]],\n      XYZY: [[new Mesh(new BoxGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [0, 1.1, 0]]],\n      XYZZ: [[new Mesh(new BoxGeometry(0.125, 0.125, 0.125), matWhiteTransparent.clone()), [0, 0, 1.1]]]\n    };\n    const pickerScale = {\n      X: [[new Mesh(new CylinderGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0.5, 0, 0], [0, 0, -Math.PI / 2]]],\n      Y: [[new Mesh(new CylinderGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0, 0.5, 0]]],\n      Z: [[new Mesh(new CylinderGeometry(0.2, 0, 0.8, 4, 1, false), matInvisible), [0, 0, 0.5], [Math.PI / 2, 0, 0]]],\n      XY: [[new Mesh(scaleHandleGeometry, matInvisible), [0.85, 0.85, 0], null, [3, 3, 0.2]]],\n      YZ: [[new Mesh(scaleHandleGeometry, matInvisible), [0, 0.85, 0.85], null, [0.2, 3, 3]]],\n      XZ: [[new Mesh(scaleHandleGeometry, matInvisible), [0.85, 0, 0.85], null, [3, 0.2, 3]]],\n      XYZX: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.2), matInvisible), [1.1, 0, 0]]],\n      XYZY: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.2), matInvisible), [0, 1.1, 0]]],\n      XYZZ: [[new Mesh(new BoxGeometry(0.2, 0.2, 0.2), matInvisible), [0, 0, 1.1]]]\n    };\n    const helperScale = {\n      X: [[new Line(lineGeometry, matHelper.clone()), [-1e3, 0, 0], null, [1e6, 1, 1], 'helper']],\n      Y: [[new Line(lineGeometry, matHelper.clone()), [0, -1e3, 0], [0, 0, Math.PI / 2], [1e6, 1, 1], 'helper']],\n      Z: [[new Line(lineGeometry, matHelper.clone()), [0, 0, -1e3], [0, -Math.PI / 2, 0], [1e6, 1, 1], 'helper']]\n    }; // Creates an Object3D with gizmos described in custom hierarchy definition.\n    // this is nearly impossible to Type so i'm leaving it\n\n    const setupGizmo = gizmoMap => {\n      const gizmo = new Object3D();\n\n      for (let name in gizmoMap) {\n        for (let i = gizmoMap[name].length; i--;) {\n          const object = gizmoMap[name][i][0].clone();\n          const position = gizmoMap[name][i][1];\n          const rotation = gizmoMap[name][i][2];\n          const scale = gizmoMap[name][i][3];\n          const tag = gizmoMap[name][i][4]; // name and tag properties are essential for picking and updating logic.\n\n          object.name = name; // @ts-ignore\n\n          object.tag = tag;\n\n          if (position) {\n            object.position.set(position[0], position[1], position[2]);\n          }\n\n          if (rotation) {\n            object.rotation.set(rotation[0], rotation[1], rotation[2]);\n          }\n\n          if (scale) {\n            object.scale.set(scale[0], scale[1], scale[2]);\n          }\n\n          object.updateMatrix();\n          const tempGeometry = object.geometry.clone();\n          tempGeometry.applyMatrix4(object.matrix);\n          object.geometry = tempGeometry;\n          object.renderOrder = Infinity;\n          object.position.set(0, 0, 0);\n          object.rotation.set(0, 0, 0);\n          object.scale.set(1, 1, 1);\n          gizmo.add(object);\n        }\n      }\n\n      return gizmo;\n    };\n\n    this.gizmo = {};\n    this.picker = {};\n    this.helper = {};\n    this.add(this.gizmo['translate'] = setupGizmo(gizmoTranslate));\n    this.add(this.gizmo['rotate'] = setupGizmo(gizmoRotate));\n    this.add(this.gizmo['scale'] = setupGizmo(gizmoScale));\n    this.add(this.picker['translate'] = setupGizmo(pickerTranslate));\n    this.add(this.picker['rotate'] = setupGizmo(pickerRotate));\n    this.add(this.picker['scale'] = setupGizmo(pickerScale));\n    this.add(this.helper['translate'] = setupGizmo(helperTranslate));\n    this.add(this.helper['rotate'] = setupGizmo(helperRotate));\n    this.add(this.helper['scale'] = setupGizmo(helperScale)); // Pickers should be hidden always\n\n    this.picker['translate'].visible = false;\n    this.picker['rotate'].visible = false;\n    this.picker['scale'].visible = false;\n  } // updateMatrixWorld will update transformations and appearance of individual handles\n\n\n}\n\nclass TransformControlsPlane extends Mesh {\n  constructor() {\n    super(new PlaneGeometry(100000, 100000, 2, 2), new MeshBasicMaterial({\n      visible: false,\n      wireframe: true,\n      side: DoubleSide,\n      transparent: true,\n      opacity: 0.1,\n      toneMapped: false\n    }));\n\n    _defineProperty(this, \"isTransformControlsPlane\", true);\n\n    _defineProperty(this, \"type\", 'TransformControlsPlane');\n\n    _defineProperty(this, \"unitX\", new Vector3(1, 0, 0));\n\n    _defineProperty(this, \"unitY\", new Vector3(0, 1, 0));\n\n    _defineProperty(this, \"unitZ\", new Vector3(0, 0, 1));\n\n    _defineProperty(this, \"tempVector\", new Vector3());\n\n    _defineProperty(this, \"dirVector\", new Vector3());\n\n    _defineProperty(this, \"alignVector\", new Vector3());\n\n    _defineProperty(this, \"tempMatrix\", new Matrix4());\n\n    _defineProperty(this, \"identityQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"cameraQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"worldPosition\", new Vector3());\n\n    _defineProperty(this, \"worldQuaternion\", new Quaternion());\n\n    _defineProperty(this, \"eye\", new Vector3());\n\n    _defineProperty(this, \"axis\", null);\n\n    _defineProperty(this, \"mode\", 'translate');\n\n    _defineProperty(this, \"space\", 'world');\n\n    _defineProperty(this, \"updateMatrixWorld\", () => {\n      let space = this.space;\n      this.position.copy(this.worldPosition);\n      if (this.mode === 'scale') space = 'local'; // scale always oriented to local rotation\n\n      this.unitX.set(1, 0, 0).applyQuaternion(space === 'local' ? this.worldQuaternion : this.identityQuaternion);\n      this.unitY.set(0, 1, 0).applyQuaternion(space === 'local' ? this.worldQuaternion : this.identityQuaternion);\n      this.unitZ.set(0, 0, 1).applyQuaternion(space === 'local' ? this.worldQuaternion : this.identityQuaternion); // Align the plane for current transform mode, axis and space.\n\n      this.alignVector.copy(this.unitY);\n\n      switch (this.mode) {\n        case 'translate':\n        case 'scale':\n          switch (this.axis) {\n            case 'X':\n              this.alignVector.copy(this.eye).cross(this.unitX);\n              this.dirVector.copy(this.unitX).cross(this.alignVector);\n              break;\n\n            case 'Y':\n              this.alignVector.copy(this.eye).cross(this.unitY);\n              this.dirVector.copy(this.unitY).cross(this.alignVector);\n              break;\n\n            case 'Z':\n              this.alignVector.copy(this.eye).cross(this.unitZ);\n              this.dirVector.copy(this.unitZ).cross(this.alignVector);\n              break;\n\n            case 'XY':\n              this.dirVector.copy(this.unitZ);\n              break;\n\n            case 'YZ':\n              this.dirVector.copy(this.unitX);\n              break;\n\n            case 'XZ':\n              this.alignVector.copy(this.unitZ);\n              this.dirVector.copy(this.unitY);\n              break;\n\n            case 'XYZ':\n            case 'E':\n              this.dirVector.set(0, 0, 0);\n              break;\n          }\n\n          break;\n\n        case 'rotate':\n        default:\n          // special case for rotate\n          this.dirVector.set(0, 0, 0);\n      }\n\n      if (this.dirVector.length() === 0) {\n        // If in rotate mode, make the plane parallel to camera\n        this.quaternion.copy(this.cameraQuaternion);\n      } else {\n        this.tempMatrix.lookAt(this.tempVector.set(0, 0, 0), this.dirVector, this.alignVector);\n        this.quaternion.setFromRotationMatrix(this.tempMatrix);\n      }\n\n      super.updateMatrixWorld();\n    });\n  }\n\n}\n\nexport { TransformControls, TransformControlsGizmo, TransformControlsPlane };\n"]},"metadata":{},"sourceType":"module"}