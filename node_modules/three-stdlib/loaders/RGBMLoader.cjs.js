"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("three");class r extends e.DataTextureLoader{loadCubemap(r,t,n,a){const i=new e.CubeTexture;let f=0;const o=this;function d(e){o.load(r[e],(function(r){i.images[e]=r,f++,6===f&&(i.needsUpdate=!0,t&&t(i))}),void 0,a)}for(let e=0;e<r.length;++e)d(e);return i.encoding=e.RGBM7Encoding,i.format=e.RGBAFormat,i.minFilter=e.LinearFilter,i.generateMipmaps=!1,i}parse(r){const t=i.decode(r),n=i.toRGBA8(t)[0];return{width:t.width,height:t.height,data:new Uint8Array(n),format:e.RGBAFormat,type:e.UnsignedByteType,flipY:!0,encoding:e.RGBM7Encoding}}}var t,n,a,i={};i.toRGBA8=function(e){var r=e.width,t=e.height;if(null==e.tabs.acTL)return[i.toRGBA8.decodeImage(e.data,r,t,e).buffer];var n=[];null==e.frames[0].data&&(e.frames[0].data=e.data);for(var a=r*t*4,f=new Uint8Array(a),o=new Uint8Array(a),d=new Uint8Array(a),s=0;s<e.frames.length;s++){var c=e.frames[s],l=c.rect.x,u=c.rect.y,v=c.rect.width,h=c.rect.height,p=i.toRGBA8.decodeImage(c.data,v,h,e);if(0!=s)for(var b=0;b<a;b++)d[b]=f[b];if(0==c.blend?i._copyTile(p,v,h,f,r,t,l,u,0):1==c.blend&&i._copyTile(p,v,h,f,r,t,l,u,1),n.push(f.buffer.slice(0)),0==c.dispose);else if(1==c.dispose)i._copyTile(o,v,h,f,r,t,l,u,0);else if(2==c.dispose)for(b=0;b<a;b++)f[b]=d[b]}return n},i.toRGBA8.decodeImage=function(e,r,t,n){var a=r*t,f=i.decode._getBPP(n),o=Math.ceil(r*f/8),d=new Uint8Array(4*a),s=new Uint32Array(d.buffer),c=n.ctype,l=n.depth,u=i._bin.readUshort;if(6==c){var v=a<<2;if(8==l)for(var h=0;h<v;h+=4)d[h]=e[h],d[h+1]=e[h+1],d[h+2]=e[h+2],d[h+3]=e[h+3];if(16==l)for(h=0;h<v;h++)d[h]=e[h<<1]}else if(2==c){var p=n.tabs.tRNS;if(null==p){if(8==l)for(h=0;h<a;h++){var b=3*h;s[h]=255<<24|e[b+2]<<16|e[b+1]<<8|e[b]}if(16==l)for(h=0;h<a;h++){b=6*h;s[h]=255<<24|e[b+4]<<16|e[b+2]<<8|e[b]}}else{var g=p[0],w=p[1],y=p[2];if(8==l)for(h=0;h<a;h++){var _=h<<2;b=3*h;s[h]=255<<24|e[b+2]<<16|e[b+1]<<8|e[b],e[b]==g&&e[b+1]==w&&e[b+2]==y&&(d[_+3]=0)}if(16==l)for(h=0;h<a;h++){_=h<<2,b=6*h;s[h]=255<<24|e[b+4]<<16|e[b+2]<<8|e[b],u(e,b)==g&&u(e,b+2)==w&&u(e,b+4)==y&&(d[_+3]=0)}}}else if(3==c){var m=n.tabs.PLTE,A=n.tabs.tRNS,U=A?A.length:0;if(1==l)for(var H=0;H<t;H++){var I=H*o,R=H*r;for(h=0;h<r;h++){_=R+h<<2;var T=3*(B=e[I+(h>>3)]>>7-((7&h)<<0)&1);d[_]=m[T],d[_+1]=m[T+1],d[_+2]=m[T+2],d[_+3]=B<U?A[B]:255}}if(2==l)for(H=0;H<t;H++)for(I=H*o,R=H*r,h=0;h<r;h++){_=R+h<<2,T=3*(B=e[I+(h>>2)]>>6-((3&h)<<1)&3);d[_]=m[T],d[_+1]=m[T+1],d[_+2]=m[T+2],d[_+3]=B<U?A[B]:255}if(4==l)for(H=0;H<t;H++)for(I=H*o,R=H*r,h=0;h<r;h++){_=R+h<<2,T=3*(B=e[I+(h>>1)]>>4-((1&h)<<2)&15);d[_]=m[T],d[_+1]=m[T+1],d[_+2]=m[T+2],d[_+3]=B<U?A[B]:255}if(8==l)for(h=0;h<a;h++){var B;_=h<<2,T=3*(B=e[h]);d[_]=m[T],d[_+1]=m[T+1],d[_+2]=m[T+2],d[_+3]=B<U?A[B]:255}}else if(4==c){if(8==l)for(h=0;h<a;h++){_=h<<2;var C=e[S=h<<1];d[_]=C,d[_+1]=C,d[_+2]=C,d[_+3]=e[S+1]}if(16==l)for(h=0;h<a;h++){var S;_=h<<2,C=e[S=h<<2];d[_]=C,d[_+1]=C,d[_+2]=C,d[_+3]=e[S+2]}}else if(0==c)for(g=n.tabs.tRNS?n.tabs.tRNS:-1,H=0;H<t;H++){var M=H*o,P=H*r;if(1==l)for(var G=0;G<r;G++){var x=(C=255*(e[M+(G>>>3)]>>>7-(7&G)&1))==255*g?0:255;s[P+G]=x<<24|C<<16|C<<8|C}else if(2==l)for(G=0;G<r;G++){x=(C=85*(e[M+(G>>>2)]>>>6-((3&G)<<1)&3))==85*g?0:255;s[P+G]=x<<24|C<<16|C<<8|C}else if(4==l)for(G=0;G<r;G++){x=(C=17*(e[M+(G>>>1)]>>>4-((1&G)<<2)&15))==17*g?0:255;s[P+G]=x<<24|C<<16|C<<8|C}else if(8==l)for(G=0;G<r;G++){x=(C=e[M+G])==g?0:255;s[P+G]=x<<24|C<<16|C<<8|C}else if(16==l)for(G=0;G<r;G++){C=e[M+(G<<1)],x=u(e,M+(G<<h))==g?0:255;s[P+G]=x<<24|C<<16|C<<8|C}}return d},i.decode=function(e){for(var r,t=new Uint8Array(e),n=8,a=i._bin,f=a.readUshort,o=a.readUint,d={tabs:{},frames:[]},s=new Uint8Array(t.length),c=0,l=0,u=[137,80,78,71,13,10,26,10],v=0;v<8;v++)if(t[v]!=u[v])throw"The input is not a PNG file!";for(;n<t.length;){var h=a.readUint(t,n);n+=4;var p=a.readASCII(t,n,4);if(n+=4,"IHDR"==p)i.decode._IHDR(t,n,d);else if("CgBI"==p)d.tabs[p]=t.slice(n,n+4);else if("IDAT"==p){for(v=0;v<h;v++)s[c+v]=t[n+v];c+=h}else if("acTL"==p)d.tabs[p]={num_frames:o(t,n),num_plays:o(t,n+4)},r=new Uint8Array(t.length);else if("fcTL"==p){var b;if(0!=l)(b=d.frames[d.frames.length-1]).data=i.decode._decompress(d,r.slice(0,l),b.rect.width,b.rect.height),l=0;var g={x:o(t,n+12),y:o(t,n+16),width:o(t,n+4),height:o(t,n+8)},w=f(t,n+22);w=f(t,n+20)/(0==w?100:w);var y={rect:g,delay:Math.round(1e3*w),dispose:t[n+24],blend:t[n+25]};d.frames.push(y)}else if("fdAT"==p){for(v=0;v<h-4;v++)r[l+v]=t[n+v+4];l+=h-4}else if("pHYs"==p)d.tabs[p]=[a.readUint(t,n),a.readUint(t,n+4),t[n+8]];else if("cHRM"==p){d.tabs[p]=[];for(v=0;v<8;v++)d.tabs[p].push(a.readUint(t,n+4*v))}else if("tEXt"==p||"zTXt"==p){null==d.tabs[p]&&(d.tabs[p]={});var _=a.nextZero(t,n),m=a.readASCII(t,n,_-n),A=n+h-_-1;if("tEXt"==p)R=a.readASCII(t,_+1,A);else{var U=i.decode._inflate(t.slice(_+2,_+2+A));R=a.readUTF8(U,0,U.length)}d.tabs[p][m]=R}else if("iTXt"==p){null==d.tabs[p]&&(d.tabs[p]={});_=0;var H=n;_=a.nextZero(t,H);m=a.readASCII(t,H,_-H);var I=t[H=_+1];H+=2,_=a.nextZero(t,H),a.readASCII(t,H,_-H),H=_+1,_=a.nextZero(t,H),a.readUTF8(t,H,_-H);var R;A=h-((H=_+1)-n);if(0==I)R=a.readUTF8(t,H,A);else{U=i.decode._inflate(t.slice(H,H+A));R=a.readUTF8(U,0,U.length)}d.tabs[p][m]=R}else if("PLTE"==p)d.tabs[p]=a.readBytes(t,n,h);else if("hIST"==p){var T=d.tabs.PLTE.length/3;d.tabs[p]=[];for(v=0;v<T;v++)d.tabs[p].push(f(t,n+2*v))}else if("tRNS"==p)3==d.ctype?d.tabs[p]=a.readBytes(t,n,h):0==d.ctype?d.tabs[p]=f(t,n):2==d.ctype&&(d.tabs[p]=[f(t,n),f(t,n+2),f(t,n+4)]);else if("gAMA"==p)d.tabs[p]=a.readUint(t,n)/1e5;else if("sRGB"==p)d.tabs[p]=t[n];else if("bKGD"==p)0==d.ctype||4==d.ctype?d.tabs[p]=[f(t,n)]:2==d.ctype||6==d.ctype?d.tabs[p]=[f(t,n),f(t,n+2),f(t,n+4)]:3==d.ctype&&(d.tabs[p]=t[n]);else if("IEND"==p)break;n+=h,a.readUint(t,n),n+=4}0!=l&&((b=d.frames[d.frames.length-1]).data=i.decode._decompress(d,r.slice(0,l),b.rect.width,b.rect.height),l=0);return d.data=i.decode._decompress(d,s,d.width,d.height),delete d.compress,delete d.interlace,delete d.filter,d},i.decode._decompress=function(e,r,t,n){var a=i.decode._getBPP(e),f=Math.ceil(t*a/8),o=new Uint8Array((f+1+e.interlace)*n);return r=e.tabs.CgBI?i.inflateRaw(r,o):i.decode._inflate(r,o),0==e.interlace?r=i.decode._filterZero(r,e,0,t,n):1==e.interlace&&(r=i.decode._readInterlace(r,e)),r},i.decode._inflate=function(e,r){return i.inflateRaw(new Uint8Array(e.buffer,2,e.length-6),r)},i.inflateRaw=((a={}).H={},a.H.N=function(e,r){var t,n,i=Uint8Array,f=0,o=0,d=0,s=0,c=0,l=0,u=0,v=0,h=0;if(3==e[0]&&0==e[1])return r||new i(0);var p=a.H,b=p.b,g=p.e,w=p.R,y=p.n,_=p.A,m=p.Z,A=p.m,U=null==r;for(U&&(r=new i(e.length>>>2<<5));0==f;)if(f=b(e,h,1),o=b(e,h+1,2),h+=3,0!=o){if(U&&(r=a.H.W(r,v+(1<<17))),1==o&&(t=A.J,n=A.h,l=511,u=31),2==o){d=g(e,h,5)+257,s=g(e,h+5,5)+1,c=g(e,h+10,4)+4,h+=14;for(var H=1,I=0;I<38;I+=2)A.Q[I]=0,A.Q[I+1]=0;for(I=0;I<c;I++){var R=g(e,h+3*I,3);A.Q[1+(A.X[I]<<1)]=R,R>H&&(H=R)}h+=3*c,y(A.Q,H),_(A.Q,H,A.u),t=A.w,n=A.d,h=w(A.u,(1<<H)-1,d+s,e,h,A.v);var T=p.V(A.v,0,d,A.C);l=(1<<T)-1;var B=p.V(A.v,d,s,A.D);u=(1<<B)-1,y(A.C,T),_(A.C,T,t),y(A.D,B),_(A.D,B,n)}for(;;){var C=t[m(e,h)&l];h+=15&C;var S=C>>>4;if(S>>>8==0)r[v++]=S;else{if(256==S)break;var M=v+S-254;if(S>264){var P=A.q[S-257];M=v+(P>>>3)+g(e,h,7&P),h+=7&P}var G=n[m(e,h)&u];h+=15&G;var x=G>>>4,D=A.c[x],Z=(D>>>4)+b(e,h,15&D);for(h+=15&D;v<M;)r[v]=r[v++-Z],r[v]=r[v++-Z],r[v]=r[v++-Z],r[v]=r[v++-Z];v=M}}}else{0!=(7&h)&&(h+=8-(7&h));var F=4+(h>>>3),L=e[F-4]|e[F-3]<<8;U&&(r=a.H.W(r,v+L)),r.set(new i(e.buffer,e.byteOffset+F,L),v),h=F+L<<3,v+=L}return r.length==v?r:r.slice(0,v)},a.H.W=function(e,r){var t=e.length;if(r<=t)return e;var n=new Uint8Array(t<<1);return n.set(e,0),n},a.H.R=function(e,r,t,n,i,f){for(var o=a.H.e,d=a.H.Z,s=0;s<t;){var c=e[d(n,i)&r];i+=15&c;var l=c>>>4;if(l<=15)f[s]=l,s++;else{var u=0,v=0;16==l?(v=3+o(n,i,2),i+=2,u=f[s-1]):17==l?(v=3+o(n,i,3),i+=3):18==l&&(v=11+o(n,i,7),i+=7);for(var h=s+v;s<h;)f[s]=u,s++}}return i},a.H.V=function(e,r,t,n){for(var a=0,i=0,f=n.length>>>1;i<t;){var o=e[i+r];n[i<<1]=0,n[1+(i<<1)]=o,o>a&&(a=o),i++}for(;i<f;)n[i<<1]=0,n[1+(i<<1)]=0,i++;return a},a.H.n=function(e,r){for(var t,n,i,f,o=a.H.m,d=e.length,s=o.j,c=0;c<=r;c++)s[c]=0;for(c=1;c<d;c+=2)s[e[c]]++;var l=o.K;for(t=0,s[0]=0,n=1;n<=r;n++)t=t+s[n-1]<<1,l[n]=t;for(i=0;i<d;i+=2)0!=(f=e[i+1])&&(e[i]=l[f],l[f]++)},a.H.A=function(e,r,t){for(var n=e.length,i=a.H.m.r,f=0;f<n;f+=2)if(0!=e[f+1])for(var o=f>>1,d=e[f+1],s=o<<4|d,c=r-d,l=e[f]<<c,u=l+(1<<c);l!=u;)t[i[l]>>>15-r]=s,l++},a.H.l=function(e,r){for(var t=a.H.m.r,n=15-r,i=0;i<e.length;i+=2){var f=e[i]<<r-e[i+1];e[i]=t[f]>>>n}},a.H.M=function(e,r,t){t<<=7&r;var n=r>>>3;e[n]|=t,e[n+1]|=t>>>8},a.H.I=function(e,r,t){t<<=7&r;var n=r>>>3;e[n]|=t,e[n+1]|=t>>>8,e[n+2]|=t>>>16},a.H.e=function(e,r,t){return(e[r>>>3]|e[1+(r>>>3)]<<8)>>>(7&r)&(1<<t)-1},a.H.b=function(e,r,t){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)&(1<<t)-1},a.H.Z=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)},a.H.i=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16|e[3+(r>>>3)]<<24)>>>(7&r)},a.H.m=(t=Uint16Array,n=Uint32Array,{K:new t(16),j:new t(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new t(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new n(32),J:new t(512),_:[],h:new t(32),$:[],w:new t(32768),C:[],v:[],d:new t(32768),D:[],u:new t(512),Q:[],r:new t(32768),s:new n(286),Y:new n(30),a:new n(19),t:new n(15e3),k:new t(65536),g:new t(32768)}),function(){for(var e=a.H.m,r=0;r<32768;r++){var t=r;t=(4278255360&(t=(4042322160&(t=(3435973836&(t=(2863311530&t)>>>1|(1431655765&t)<<1))>>>2|(858993459&t)<<2))>>>4|(252645135&t)<<4))>>>8|(16711935&t)<<8,e.r[r]=(t>>>16|t<<16)>>>17}function n(e,r,t){for(;0!=r--;)e.push(0,t)}for(r=0;r<32;r++)e.q[r]=e.S[r]<<3|e.T[r],e.c[r]=e.p[r]<<4|e.z[r];n(e._,144,8),n(e._,112,9),n(e._,24,7),n(e._,8,8),a.H.n(e._,9),a.H.A(e._,9,e.J),a.H.l(e._,9),n(e.$,32,5),a.H.n(e.$,5),a.H.A(e.$,5,e.h),a.H.l(e.$,5),n(e.Q,19,0),n(e.C,286,0),n(e.D,30,0),n(e.v,320,0)}(),a.H.N),i.decode._readInterlace=function(e,r){for(var t=r.width,n=r.height,a=i.decode._getBPP(r),f=a>>3,o=Math.ceil(t*a/8),d=new Uint8Array(n*o),s=0,c=[0,0,4,0,2,0,1],l=[0,4,0,2,0,1,0],u=[8,8,8,4,4,2,2],v=[8,8,4,4,2,2,1],h=0;h<7;){for(var p=u[h],b=v[h],g=0,w=0,y=c[h];y<n;)y+=p,w++;for(var _=l[h];_<t;)_+=b,g++;var m=Math.ceil(g*a/8);i.decode._filterZero(e,r,s,g,w);for(var A=0,U=c[h];U<n;){for(var H=l[h],I=s+A*m<<3;H<t;){var R;if(1==a)R=(R=e[I>>3])>>7-(7&I)&1,d[U*o+(H>>3)]|=R<<7-((7&H)<<0);if(2==a)R=(R=e[I>>3])>>6-(7&I)&3,d[U*o+(H>>2)]|=R<<6-((3&H)<<1);if(4==a)R=(R=e[I>>3])>>4-(7&I)&15,d[U*o+(H>>1)]|=R<<4-((1&H)<<2);if(a>=8)for(var T=U*o+H*f,B=0;B<f;B++)d[T+B]=e[(I>>3)+B];I+=a,H+=b}A++,U+=p}g*w!=0&&(s+=w*(1+m)),h+=1}return d},i.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},i.decode._filterZero=function(e,r,t,n,a){var f=i.decode._getBPP(r),o=Math.ceil(n*f/8),d=i.decode._paeth;f=Math.ceil(f/8);var s=0,c=1,l=e[t],u=0;if(l>1&&(e[t]=[0,0,1][l-2]),3==l)for(u=f;u<o;u++)e[u+1]=e[u+1]+(e[u+1-f]>>>1)&255;for(var v=0;v<a;v++)if(u=0,0==(l=e[(c=(s=t+v*o)+v+1)-1]))for(;u<o;u++)e[s+u]=e[c+u];else if(1==l){for(;u<f;u++)e[s+u]=e[c+u];for(;u<o;u++)e[s+u]=e[c+u]+e[s+u-f]}else if(2==l)for(;u<o;u++)e[s+u]=e[c+u]+e[s+u-o];else if(3==l){for(;u<f;u++)e[s+u]=e[c+u]+(e[s+u-o]>>>1);for(;u<o;u++)e[s+u]=e[c+u]+(e[s+u-o]+e[s+u-f]>>>1)}else{for(;u<f;u++)e[s+u]=e[c+u]+d(0,e[s+u-o],0);for(;u<o;u++)e[s+u]=e[c+u]+d(e[s+u-f],e[s+u-o],e[s+u-f-o])}return e},i.decode._paeth=function(e,r,t){var n=e+r-t,a=n-e,i=n-r,f=n-t;return a*a<=i*i&&a*a<=f*f?e:i*i<=f*f?r:t},i.decode._IHDR=function(e,r,t){var n=i._bin;t.width=n.readUint(e,r),r+=4,t.height=n.readUint(e,r),r+=4,t.depth=e[r],r++,t.ctype=e[r],r++,t.compress=e[r],r++,t.filter=e[r],r++,t.interlace=e[r],r++},i._bin={nextZero:function(e,r){for(;0!=e[r];)r++;return r},readUshort:function(e,r){return e[r]<<8|e[r+1]},writeUshort:function(e,r,t){e[r]=t>>8&255,e[r+1]=255&t},readUint:function(e,r){return 16777216*e[r]+(e[r+1]<<16|e[r+2]<<8|e[r+3])},writeUint:function(e,r,t){e[r]=t>>24&255,e[r+1]=t>>16&255,e[r+2]=t>>8&255,e[r+3]=255&t},readASCII:function(e,r,t){for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[r+a]);return n},writeASCII:function(e,r,t){for(var n=0;n<t.length;n++)e[r+n]=t.charCodeAt(n)},readBytes:function(e,r,t){for(var n=[],a=0;a<t;a++)n.push(e[r+a]);return n},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,r,t){for(var n,a="",f=0;f<t;f++)a+="%"+i._bin.pad(e[r+f].toString(16));try{n=decodeURIComponent(a)}catch(n){return i._bin.readASCII(e,r,t)}return n}},i._copyTile=function(e,r,t,n,a,i,f,o,d){for(var s=Math.min(r,a),c=Math.min(t,i),l=0,u=0,v=0;v<c;v++)for(var h=0;h<s;h++)if(f>=0&&o>=0?(l=v*r+h<<2,u=(o+v)*a+f+h<<2):(l=(-o+v)*r-f+h<<2,u=v*a+h<<2),0==d)n[u]=e[l],n[u+1]=e[l+1],n[u+2]=e[l+2],n[u+3]=e[l+3];else if(1==d){var p=e[l+3]*(1/255),b=e[l]*p,g=e[l+1]*p,w=e[l+2]*p,y=n[u+3]*(1/255),_=n[u]*y,m=n[u+1]*y,A=n[u+2]*y,U=1-p,H=p+y*U,I=0==H?0:1/H;n[u+3]=255*H,n[u+0]=(b+_*U)*I,n[u+1]=(g+m*U)*I,n[u+2]=(w+A*U)*I}else if(2==d){p=e[l+3],b=e[l],g=e[l+1],w=e[l+2],y=n[u+3],_=n[u],m=n[u+1],A=n[u+2];p==y&&b==_&&g==m&&w==A?(n[u]=0,n[u+1]=0,n[u+2]=0,n[u+3]=0):(n[u]=b,n[u+1]=g,n[u+2]=w,n[u+3]=p)}else if(3==d){p=e[l+3],b=e[l],g=e[l+1],w=e[l+2],y=n[u+3],_=n[u],m=n[u+1],A=n[u+2];if(p==y&&b==_&&g==m&&w==A)continue;if(p<220&&y>20)return!1}return!0},exports.RGBMLoader=r;
